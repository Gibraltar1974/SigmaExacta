<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>PDCA Cycle (Plan-Do-Check-Act) | Deming Wheel | Sigma Exacta</title>
    <link href="https://sigmaexacta.com/pdca" rel="canonical" />
    <meta
        content="Free online interactive PDCA (Plan-Do-Check-Act) tool to implement continuous improvement. Follow the Deming Wheel methodology for structured problem-solving and process optimization."
        name="description" />
    <meta
        content="SigmaExacta, Opensource, Free software, PDCA, Plan-Do-Check-Act, Deming Wheel, Deming Cycle, Shewhart Cycle, continuous improvement, quality management, free tool, W. Edwards Deming"
        name="keywords" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
    <link href="sigma-exacta-icon.jpg" rel="icon" type="image/jpeg" />
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;800&amp;display=swap" rel="stylesheet" />
    <link href="styles.css" rel="stylesheet" />
    <style>
        /* --- Estilos para la RUEDA ESTÁTICA (que es solo ilustrativa) --- */
        .pdca-wheel-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 2rem auto;
            max-width: 600px;
        }

        .pdca-wheel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            width: 100%;
            padding-top: 100%;
            border-radius: 50%;
            overflow: hidden;
            position: relative;
            border: 5px solid #555;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .pdca-quadrant {
            position: absolute;
            width: 50%;
            height: 50%;
            padding: 20px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #333;
            /* Cambiado de blanco a oscuro para mejor contraste */
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            /* Efectos 3D iniciales */
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.1);
            transform: translateZ(0);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        /* Efectos hover para cada cuadrante con sombreados, brillos y efecto 3D */
        .pdca-quadrant:hover {
            transform: translateZ(10px) scale(1.03);
            box-shadow:
                inset 0 0 30px rgba(255, 255, 255, 0.3),
                0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: 5;
            filter: brightness(1.1);
        }

        /* Colocación de cuadrantes con colores actualizados para coincidir con la tabla */
        .quadrant-plan {
            top: 0;
            left: 0;
            background-color: #eaf4ff;
            color: #333;
            /* Gradiente para efecto 3D */
            background: linear-gradient(135deg, #eaf4ff 0%, #c2e0ff 100%);
        }

        .quadrant-do {
            top: 0;
            right: 0;
            background-color: #ffe6cc;
            color: #333;
            background: linear-gradient(135deg, #ffe6cc 0%, #ffcc99 100%);
        }

        .quadrant-act {
            bottom: 0;
            left: 0;
            background-color: #f7e6ff;
            color: #333;
            background: linear-gradient(135deg, #f7e6ff 0%, #e6ccff 100%);
        }

        .quadrant-check {
            bottom: 0;
            right: 0;
            background-color: #eafbe7;
            color: #333;
            background: linear-gradient(135deg, #eafbe7 0%, #ccffcc 100%);
        }

        .pdca-quadrant h3 {
            margin: 0 0 10px 0;
            padding: 0;
            font-size: 1.5rem;
            font-weight: 800;
            border: none;
            color: inherit;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
            /* Reducida intensidad para mejor legibilidad */
            transition: all 0.3s ease;
        }

        .pdca-quadrant:hover h3 {
            transform: translateY(-3px);
            text-shadow: 1px 1px 4px rgba(0, 0, 0, 0.2);
        }

        .pdca-quadrant .fas {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #333;
            /* Iconos en color oscuro para mejor contraste */
            transition: all 0.3s ease;
        }

        .pdca-quadrant:hover .fas {
            transform: scale(1.2);
            filter: drop-shadow(0 2px 3px rgba(0, 0, 0, 0.2));
        }

        .pdca-quadrant span {
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .pdca-quadrant:hover span {
            transform: translateY(2px);
        }

        .pdca-wheel::after,
        .pdca-wheel::before {
            content: '';
            position: absolute;
            background: #555;
            z-index: 10;
        }

        .pdca-wheel::after {
            width: 5px;
            height: 100%;
            left: 50%;
            transform: translateX(-50%);
        }

        .pdca-wheel::before {
            height: 5px;
            width: 100%;
            top: 50%;
            transform: translateY(-50%);
        }

        .pdca-center-circle {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20%;
            height: 20%;
            min-width: 80px;
            min-height: 80px;
            background: white;
            border-radius: 50%;
            border: 5px solid #555;
            z-index: 11;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.8rem;
            color: #555;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        /* Animación de rotación para el ícono central - CORREGIDA */
        .pdca-center-circle i {
            animation: rotate 10s linear infinite;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
        }

        @keyframes rotate {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .pdca-center-circle:hover {
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
        }

        .pdca-center-circle:hover i {
            animation-duration: 5s;
            /* Acelera la rotación al hacer hover */
        }

        @media (max-width: 600px) {
            .pdca-quadrant {
                padding: 10px;
            }

            .pdca-quadrant h3 {
                font-size: 1.1rem;
            }

            .pdca-quadrant .fas {
                font-size: 1.5rem;
            }

            .pdca-center-circle {
                font-size: 1.2rem;
                min-width: 60px;
                min-height: 60px;
            }
        }

        /* --- Fin Estilos Rueda Estática --- */

        /* --- Estilos para el contenedor de resultados (Tabla de resumen) --- */
        #results-container {
            border: 2px solid var(--success-color);
            background-color: #f8fef8;
            border-radius: 8px;
            padding: 1.25rem;
            margin-top: 1.5rem;
            overflow-x: auto;
            /* Permite scroll en móvil si la tabla es grande */
        }

        #results-container h3 {
            color: var(--success-color);
            font-weight: 800;
            text-align: center;
            margin-bottom: 1rem;
        }

        /* Nuevo: Estilos para la tabla de resumen */
        .pdca-summary-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1.5rem;
            table-layout: fixed;
            /* Ayuda a controlar el ancho de las columnas */
        }

        .pdca-summary-table th,
        .pdca-summary-table td {
            padding: 12px;
            text-align: left;
            border: 1px solid #ddd;
            word-wrap: break-word;
        }

        .pdca-summary-table th {
            background-color: var(--primary-color);
            color: white;
            font-weight: 800;
            vertical-align: top;
            width: 15%;
            /* Ancho de la columna de la fase */
        }

        .pdca-summary-table td:nth-child(2) {
            font-weight: 600;
            width: 25%;
            /* Ancho de la columna de la categoría */
            background-color: #f1f1f1;
        }

        .pdca-summary-table td:nth-child(3) {
            width: 60%;
            /* Ancho de la columna de detalles */
            white-space: pre-wrap;
            /* Mantiene saltos de línea y formato del textarea */
            vertical-align: top;
        }

        .phase-row {
            background-color: #eaf4ff;
            /* Fondo claro para distinguir la fase principal */
            border-bottom: 3px solid var(--secondary-color);
        }

        .results-actions {
            margin-top: 1.25rem;
            padding-top: 1.25rem;
            border-top: 1px solid #eee;
            text-align: center;
        }

        /* --- FIN Estilos Resultados --- */

        /* Estilo AÑADIDO para el icono PDCA: tamaño y forma definidos */
        .main-tool-logo {
            width: 50px;
            height: 50px;
            border-radius: 18px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #fff;
            font-size: 1.8rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            flex-shrink: 0;
            margin-right: 15px;
        }

        .main-tool-logo[data-color='9'] {
            background-color: #7ed321;
        }

        /* Estilos generales de la página */
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            font-size: 16px;
        }

        body {
            background-color: #f5f7fa;
            font-family: 'Nunito', sans-serif;
            color: #333;
            margin: 0;
        }

        .main-content-wrapper {
            max-width: 100%;
            margin: 20px auto;
            padding: 1.25rem;
            box-sizing: border-box;
        }

        .header {
            margin-bottom: 1.25rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #ddd;
            text-align: center;
        }

        .header h1 {
            color: var(--primary-color);
            font-size: clamp(1.5rem, 4vw, 1.8rem);
            margin: 0.5rem 0;
            font-weight: 800;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
        }

        .header .header-subtitle {
            font-size: 1.1rem;
            color: #7f8c8d;
            margin: 0;
            font-weight: 400;
        }

        .content-block {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            background-color: white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .content-block h2 {
            font-size: 1.5em;
            margin-top: 0;
            margin-bottom: 1.25rem;
            color: var(--primary-color);
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: 0.6rem;
            font-weight: 800;
        }

        .content-block h2 .fas {
            margin-right: 0.75rem;
        }

        .instructions-box ul {
            margin: 0.6rem 0 0 0;
            padding-left: 1.25rem;
        }

        .instructions-box li {
            margin-bottom: 0.5rem;
            line-height: 1.6;
        }

        .cycle-step {
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 1.25rem;
            margin-bottom: 1.25rem;
            background-color: #fdfdfd;
        }

        .cycle-step h3 {
            font-size: 1.2em;
            margin-top: 0;
            margin-bottom: 1rem;
            color: var(--primary-color);
            border-bottom: 1px solid #eee;
            padding-bottom: 0.6rem;
            font-weight: 800;
        }

        .cycle-step h3 .fas {
            margin-right: 0.5rem;
        }

        .form-group {
            margin-bottom: 1.25rem;
        }

        label {
            color: var(--primary-color);
            font-weight: 600;
            display: block;
            margin-bottom: 0.5rem;
        }

        textarea {
            width: 100%;
            padding: 0.6rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            transition: border 0.3s, box-shadow 0.3s;
            font-size: 1rem;
            font-family: 'Nunito', sans-serif;
            min-height: 45px;
            resize: none;
            overflow-y: hidden;
            box-sizing: border-box;
        }

        textarea:focus,
        button:focus-visible {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        button {
            background-color: var(--secondary-color);
            color: white;
            padding: 0.7rem 1.25rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 1rem;
            transition: background-color 0.3s;
            font-family: 'Nunito', sans-serif;
            font-weight: 600;
        }

        .btn-success {
            background-color: var(--success-color);
        }

        .btn-success:hover {
            background-color: #219653;
        }

        .btn-warning {
            background-color: var(--warning-color);
        }

        .btn-warning:hover {
            background-color: #d4ac0d;
        }

        #generate-report-button {
            width: 100%;
            padding: 1rem;
            font-size: 1.2em;
            font-weight: bold;
            margin-top: 1.25rem;
            box-sizing: border-box;
        }

        #generate-report-button:hover {
            background-color: #2980b9;
        }

        .hidden {
            display: none;
        }

        footer[role="contentinfo"] {
            /* MODIFIED: Matched vave.html styles */
            padding: 2rem 1.25rem;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
            box-sizing: border-box;
            /* REMOVED: background-color, color, text-align */
        }

        .disclaimer-note {
            margin-top: 2rem;
            padding: 0 1rem;
            font-size: 0.8rem;
            color: #777;
            /* MODIFIED: Matched vave.html text color */
            max-width: 1400px;
            /* MODIFIED: Matched vave.html max-width */
            margin-left: auto;
            margin-right: auto;
            line-height: 1.6;
            /* MODIFIED: Matched vave.html line-height */
            text-align: left;
            /* ADDED: Matched vave.html justification */
        }
    </style>
</head>

<body>

    <div id="header-placeholder"></div>
    <main class="main-content-wrapper">
        <header class="header">
            <h1>
                <div class="main-tool-logo" data-color="9"><i class="fas fa-sync-alt"></i></div>
                Free Online Plan-Do-Check-Act (PDCA) Cycle Tool (Deming Wheel)
            </h1>
            <p class="header-subtitle">A structured four-phase model for continuous improvement and quality management.
            </p>
        </header>
        <div class="content-block">
            <h2><i class="fas fa-question-circle"></i> What is the PDCA Cycle?</h2>
            <p>The <strong>PDCA Cycle</strong> (Plan-Do-Check-Act), also known as the Deming Wheel or Shewhart Cycle, is
                a systematic, iterative four-stage approach for continuous improvement in processes and products. It
                provides a simple but powerful framework for solving problems, managing change, and implementing quality
                control.</p>
            <p>By repeatedly cycling through the four phases, organizations can refine their processes, identify root
                causes of problems, and create a culture of continuous learning and improvement.</p>
            <div class="pdca-wheel-container">
                <div class="pdca-wheel">
                    <div class="pdca-quadrant quadrant-plan">
                        <i class="fas fa-clipboard-list"></i>
                        <h3>1. Plan</h3>
                        <span>Identify goal &amp; plan action.</span>
                    </div>
                    <div class="pdca-quadrant quadrant-do">
                        <i class="fas fa-cogs"></i>
                        <h3>2. Do</h3>
                        <span>Implement the plan.</span>
                    </div>
                    <div class="pdca-quadrant quadrant-act">
                        <i class="fas fa-bullhorn"></i>
                        <h3>4. Act</h3>
                        <span>Standardize or adjust.</span>
                    </div>
                    <div class="pdca-quadrant quadrant-check">
                        <i class="fas fa-chart-line"></i>
                        <h3>3. Check</h3>
                        <span>Analyze the results.</span>
                    </div>
                    <div class="pdca-center-circle">
                        <i class="fas fa-sync-alt"></i>
                    </div>
                </div>
            </div>
        </div>
        <div class="content-block">
            <h2><i class="fas fa-history"></i> History &amp; Origin</h2>
            <p>The concept was originally developed by American physicist and statistician <strong>Walter A.
                    Shewhart</strong> in the 1920s, who is often called the "father of statistical quality control."
                Shewhart framed it as a three-step process of specification, production, and inspection for scientific
                learning.</p>
            <p>His mentee, <strong>Dr. W. Edwards Deming</strong>, modified and popularized the cycle in the 1950s,
                evolving it into the four-step "Plan-Do-Check-Act" model we know today. Deming strongly advocated for
                its use in Japan, where it became a cornerstone of the country's post-war industrial and manufacturing
                success, known as "Kaizen" (continuous improvement).</p>
        </div>
        <div class="content-block">
            <h2><i class="fas fa-tools"></i> How to Use This Tool</h2>
            <div class="instructions-box">
                <ul>
                    <li><strong>Load Example:</strong> Click "Load Example" to see a pre-filled PDCA cycle for a common
                        business problem.</li>
                    <li><strong>Follow the Steps:</strong> Document your own improvement project by filling in the
                        details for each of the four phases (Plan, Do, Check, Act).</li>
                    <li><strong>Generate Report:</strong> Click "Generate PDCA Report" to create a consolidated summary
                        of your cycle, displayed as a Deming Wheel.</li>
                    <li><strong>Export:</strong> Once the report is generated, you can export it to an Excel file for
                        documentation or to share with your team.</li>
                </ul>
            </div>
        </div>
        <div class="content-block">
            <h2><i class="fas fa-sync-alt"></i> PDCA Cycle Worksheet</h2>
            <div style="text-align: center; margin-bottom: 20px;">
                <button class="btn-success" onclick="loadExample()"><i class="fas fa-magic"></i> Load Example</button>
                <button class="btn-warning" onclick="resetTool()"><i class="fas fa-sync-alt"></i> Reset Tool</button>
            </div>
            <div class="cycle-step" id="step-1">
                <h3><i class="fas fa-clipboard-list"></i> Phase 1: Plan</h3>
                <div class="form-group"><label for="plan-problem">Problem/Opportunity Statement:</label><textarea
                        id="plan-problem"
                        placeholder="e.g., Customer support call times are too long, averaging 12 minutes."></textarea>
                </div>
                <div class="form-group"><label for="plan-goal">Goal/Hypothesis (What do you expect to
                        happen?):</label><textarea id="plan-goal"
                        placeholder="e.g., By implementing a new call script, we will reduce the average call time by 15% to 10 minutes or less within one month."></textarea>
                </div>
                <div class="form-group"><label for="plan-actions">Action Plan (What steps will you
                        take?):</label><textarea id="plan-actions"
                        placeholder="e.g., 1. Develop new script. 2. Train a pilot group of 5 agents. 3. Monitor their call times for 1 week."></textarea>
                </div>
            </div>
            <div class="cycle-step" id="step-2">
                <h3><i class="fas fa-cogs"></i> Phase 2: Do</h3>
                <div class="form-group"><label for="do-execution">What was executed? (Record actions
                        taken):</label><textarea id="do-execution"
                        placeholder="e.g., The new script was developed and deployed. Five agents from Team B were trained on the new script on Monday. They used the script for all calls from Tuesday to Friday."></textarea>
                </div>
                <div class="form-group"><label for="do-problems">What problems or unexpected observations
                        occurred?:</label><textarea id="do-problems"
                        placeholder="e.g., Some veteran agents initially resisted the change, finding the script too rigid. One part of the script for 'billing issues' was found to be confusing for customers."></textarea>
                </div>
            </div>
            <div class="cycle-step" id="step-3">
                <h3><i class="fas fa-chart-line"></i> Phase 3: Check</h3>
                <div class="form-group"><label for="check-data">Data &amp; Results (What did the metrics
                        show?):</label><textarea id="check-data"
                        placeholder="e.g., Average call time for the pilot group was 9.5 minutes, an 18% reduction. Customer satisfaction scores for the pilot group remained stable (no change)."></textarea>
                </div>
                <div class="form-group"><label for="check-analysis">Analysis (Did the results match the
                        hypothesis?):</label><textarea id="check-analysis"
                        placeholder="e.g., The results exceeded the goal. The script was effective in reducing call time without negatively impacting customer satisfaction. The confusing 'billing' section needs to be addressed."></textarea>
                </div>
            </div>
            <div class="cycle-step" id="step-4">
                <h3><i class="fas fa-bullhorn"></i> Phase 4: Act</h3>
                <div class="form-group"><label for="act-conclusions">Conclusions &amp; Learnings:</label><textarea
                        id="act-conclusions"
                        placeholder="e.g., The new script is a viable solution for reducing call times. Allowing for minor flexibility in the script could improve adoption among veteran agents."></textarea>
                </div>
                <div class="form-group"><label for="act-next">Next Steps (Standardize, Adjust, or begin a new
                        cycle?):</label><textarea id="act-next"
                        placeholder="e.g., 1. Adjust the 'billing issues' part of the script based on feedback. 2. Standardize the revised script and roll it out to all support agents. 3. Start a new PDCA cycle to improve the first-call resolution rate."></textarea>
                </div>
            </div>
            <button id="generate-report-button" onclick="generateReport()"><i class="fas fa-file-alt"></i> Generate PDCA
                Report</button>
            <div class="hidden" id="results-container"></div>
        </div>
    </main>
    <footer role="contentinfo">
        <div class="disclaimer-note">
            <p><strong>Disclaimer:</strong> The PDCA Cycle was developed by Walter A. Shewhart and later popularized by
                W. Edwards Deming. This tool is an independent implementation provided for educational and informational
                purposes only. It is not affiliated with, sponsored by, or endorsed by the estates of Deming or
                Shewhart, or their respective organizations. The effectiveness of the process depends on the user's
                application. Sigma Exacta and its creators are not liable for any damages or losses resulting from its
                use.</p>
        </div>
    </footer>
    <script>
        let cycleData = {};

        // Mover toda la lógica de inicialización aquí
        function initializePage() {
            // --- START: Lógica del Header (idéntica a index.html) ---
            const navToggle = document.getElementById('nav-toggle');
            const navMenu = document.getElementById('nav-menu');
            const toolsDropdownToggle = document.getElementById('tools-dropdown-toggle');
            const toolsDropdownMenu = document.getElementById('tools-dropdown-menu');
            const toolsDropdownContainer = document.getElementById('tools-dropdown-container');

            if (navToggle && navMenu) {
                navToggle.addEventListener('click', () => {
                    navMenu.classList.toggle('show-menu');
                    const icon = navToggle.querySelector('i');
                    icon.classList.toggle('fa-bars');
                    icon.classList.toggle('fa-times');

                    if (!navMenu.classList.contains('show-menu')) {
                        if (toolsDropdownMenu) toolsDropdownMenu.classList.remove('show-submenu');
                        if (toolsDropdownContainer) toolsDropdownContainer.classList.remove('active');
                    }
                });
            }

            if (toolsDropdownToggle && toolsDropdownMenu && toolsDropdownContainer) {
                toolsDropdownToggle.addEventListener('click', (event) => {
                    if (window.innerWidth <= 992) {
                        event.preventDefault();
                        toolsDropdownMenu.classList.toggle('show-submenu');
                        toolsDropdownContainer.classList.toggle('active');
                    }
                });
            }
            // --- END: Lógica del Header ---

            // Lógica específica de la página PDCA
            document.querySelectorAll('textarea').forEach(textarea => {
                textarea.addEventListener('input', function () { autoResizeTextarea(this); });
                autoResizeTextarea(textarea);
            });
        }

        // Cargar el header y luego inicializar la página
        fetch('header.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('header-placeholder').innerHTML = data;
                // Esperar un breve momento para que el DOM se actualice
                setTimeout(initializePage, 10);
            })
            .catch(error => {
                console.error('Error loading header:', error);
            });

        function autoResizeTextarea(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = (textarea.scrollHeight) + 'px';
        }

        function resetTool() {
            cycleData = {};
            document.querySelectorAll('textarea').forEach(el => {
                el.value = '';
                autoResizeTextarea(el);
            });
            document.getElementById('results-container').classList.add('hidden');
            document.getElementById('plan-problem').focus();
        }

        function loadExample() {
            resetTool();
            document.getElementById('plan-problem').value = "Customer support call times are too long, averaging 12 minutes, which leads to lower customer satisfaction and higher costs.";
            document.getElementById('plan-goal').value = "By implementing a new streamlined call script and providing targeted training, we will reduce the average call handling time by 15% (to 10.2 minutes or less) within one month, without decreasing the customer satisfaction score.";
            document.getElementById('plan-actions').value = "1. Analyze top 5 call reasons to create a streamlined script (Week 1).\n2. Select a pilot group of 5 agents for training (Week 2).\n3. Train the pilot group on the new script (Week 2).\n4. Monitor the pilot group's call times and CSAT scores for two weeks (Weeks 3-4).";
            document.getElementById('do-execution').value = "The script was developed and deployed. Five agents from Team B were trained on Monday of Week 3. They used the script for all their calls for the following two weeks. Call data was automatically logged by the CRM.";
            document.getElementById('do-problems').value = "Initial feedback from the pilot agents was that the script felt too rigid for complex, multi-issue calls. We allowed for minor deviations after the first week based on their feedback.";
            document.getElementById('check-data').value = "Results after two weeks:\n- Average call time for the pilot group was 9.5 minutes (an 18.75% reduction).\n- Average call time for the control group (rest of the team) was 11.8 minutes.\n- Customer Satisfaction (CSAT) scores for the pilot group increased by 2%.";
            document.getElementById('check-analysis').value = "The hypothesis was confirmed: the new script significantly reduced call times. The slight increase in CSAT suggests the script did not harm the customer experience and may have improved it due to faster resolution.";
            document.getElementById('act-conclusions').value = "The streamlined script is an effective method for reducing call handling time. The key learning is that while a script provides structure, a small degree of flexibility is necessary for experienced agents to handle complex cases effectively.";
            document.getElementById('act-next').value = "1. (Standardize) Roll out the revised, slightly more flexible script to all customer support agents, with mandatory training.\n2. (Adjust) Update the standard operating procedure (SOP) to reflect the new process.\n3. (New Cycle) Begin a new PDCA cycle to tackle the 'first-call resolution rate', which was identified as the next key improvement area during analysis.";

            document.querySelectorAll('textarea').forEach(textarea => autoResizeTextarea(textarea));
            document.getElementById('plan-problem').focus();
        }

        function generateReport() {
            cycleData = {
                plan: {
                    problem: document.getElementById('plan-problem').value,
                    goal: document.getElementById('plan-goal').value,
                    actions: document.getElementById('plan-actions').value
                },
                do: {
                    execution: document.getElementById('do-execution').value,
                    problems: document.getElementById('do-problems').value
                },
                check: {
                    data: document.getElementById('check-data').value,
                    analysis: document.getElementById('check-analysis').value
                },
                act: {
                    conclusions: document.getElementById('act-conclusions').value,
                    next: document.getElementById('act-next').value
                }
            };

            if (!cycleData.plan.problem && !cycleData.plan.goal) {
                alert('Please fill in at least the "Plan" phase to generate a report.');
                return;
            }
            displayResults();
        }

        // === FUNCIÓN CLAVE: displayResults actualizada para usar TABLA ===
        function displayResults() {
            const resultsDiv = document.getElementById('results-container');

            // Helper function to sanitize text
            function escapeHTML(str) {
                return str ? str.replace(/[&<>"']/g, function (m) {
                    return { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[m];
                }) : 'N/A';
            }

            let html = `<h3><i class="fas fa-check-circle"></i> PDCA Cycle Report Summary</h3>`;

            // Construir la tabla de resumen
            html += `<table class="pdca-summary-table">
            <thead>
                <tr>
                    <th>Phase</th>
                    <th>Category</th>
                    <th>Details</th>
                </tr>
            </thead>
            <tbody>
                <tr class="phase-row">
                    <td rowspan="3"><strong>1. PLAN</strong><br><i class="fas fa-clipboard-list"></i></td>
                    <td>Problem/Opportunity</td>
                    <td>${escapeHTML(cycleData.plan.problem)}</td>
                </tr>
                <tr>
                    <td>Goal/Hypothesis</td>
                    <td>${escapeHTML(cycleData.plan.goal)}</td>
                </tr>
                <tr>
                    <td>Action Plan</td>
                    <td>${escapeHTML(cycleData.plan.actions)}</td>
                </tr>

                <tr class="phase-row" style="background-color: #ffe6cc; border-bottom: 3px solid #e67e22;">
                    <td rowspan="2"><strong>2. DO</strong><br><i class="fas fa-cogs"></i></td>
                    <td>Execution Record</td>
                    <td>${escapeHTML(cycleData.do.execution)}</td>
                </tr>
                <tr>
                    <td>Problems/Observations</td>
                    <td>${escapeHTML(cycleData.do.problems)}</td>
                </tr>
                
                <tr class="phase-row" style="background-color: #eafbe7; border-bottom: 3px solid #2ecc71;">
                    <td rowspan="2"><strong>3. CHECK</strong><br><i class="fas fa-chart-line"></i></td>
                    <td>Data & Results</td>
                    <td>${escapeHTML(cycleData.check.data)}</td>
                </tr>
                <tr>
                    <td>Analysis</td>
                    <td>${escapeHTML(cycleData.check.analysis)}</td>
                </tr>

                <tr class="phase-row" style="background-color: #f7e6ff; border-bottom: 3px solid #9b59b6;">
                    <td rowspan="2"><strong>4. ACT</strong><br><i class="fas fa-bullhorn"></i></td>
                    <td>Conclusions/Learnings</td>
                    <td>${escapeHTML(cycleData.act.conclusions)}</td>
                </tr>
                <tr>
                    <td>Next Steps</td>
                    <td>${escapeHTML(cycleData.act.next)}</td>
                </tr>
            </tbody>
        </table>`;

            // Acciones
            html += `<div class="results-actions">
                    <button class="btn-success" onclick="exportToExcel()"><i class="fas fa-file-excel"></i> Export to Excel</button>
                 </div>`;

            resultsDiv.innerHTML = html;
            resultsDiv.classList.remove('hidden');
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
        }

        function exportToExcel() {
            if (Object.keys(cycleData).length === 0) {
                alert("No data to export. Please generate a report first.");
                return;
            }

            const wb = XLSX.utils.book_new();
            const ws_data = [];
            ws_data.push(["PDCA Cycle Report"]);
            ws_data.push(["Company: Sigma Exacta"]);
            ws_data.push([`Date: ${new Date().toLocaleDateString()}`]);
            ws_data.push([]);

            ws_data.push(["Phase", "Category", "Details"]);
            ws_data.push(["PLAN", "Problem/Opportunity", cycleData.plan.problem]);
            ws_data.push(["", "Goal/Hypothesis", cycleData.plan.goal]);
            ws_data.push(["", "Action Plan", cycleData.plan.actions]);
            ws_data.push([]);
            ws_data.push(["DO", "Execution Record", cycleData.do.execution]);
            ws_data.push(["", "Problems/Observations", cycleData.do.problems]);
            ws_data.push([]);
            ws_data.push(["CHECK", "Data & Results", cycleData.check.data]);
            ws_data.push(["", "Analysis", cycleData.check.analysis]);
            ws_data.push([]);
            ws_data.push(["ACT", "Conclusions", cycleData.act.conclusions]);
            ws_data.push(["", "Next Steps", cycleData.act.next]);

            const ws = XLSX.utils.aoa_to_sheet(ws_data);
            ws['!cols'] = [{ wch: 15 }, { wch: 25 }, { wch: 80 }];
            XLSX.utils.book_append_sheet(wb, ws, "PDCA Report");

            const dateStr = new Date().toISOString().slice(0, 10);
            XLSX.writeFile(wb, `PDCA_Report_Sigma_Exacta_${dateStr}.xlsx`);
        }
    </script>
</body>

</html>