<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="canonical" href="https://sigmaexacta.com/apqp-ppap" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Free Online Dynamic APQP/PPAP Planning Tool | Sigma Exacta</title>
    <meta name="description"
        content="Free dynamic APQP and PPAP planner to manage new product development projects. Track phases, tasks, and PPAP elements, generate Gantt charts, and export reports. Ideal for quality engineers and project managers.">
    <meta name="keywords"
        content="Open source, Free software, APQP, PPAP, AIAG, Automotive Industry Action Group, Quality Planning, Product Launch, Gantt Chart, Project Management, Quality Engineering, Project Planning, Milestones, SigmaExacta">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="sigma-exacta-icon.jpg" type="image/jpeg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;800&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="styles.css">

    <style>
        /* ESTILOS EXISTENTES (conservados) */
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --light-color: #f5f7fa;
            --border-color: #ddd;
            --status-pending: #fef9e7;
            --status-progress: #eaf2f8;
            --status-completed: #e8f8f5;
            --status-na: #f2f3f4;
            font-size: 16px;
        }

        *,
        *::before,
        *::after {
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Nunito', 'Segoe UI', Tahoma, sans-serif;
            margin: 0;
            padding: 0;
            color: #333;
            background-color: var(--light-color);
            line-height: 1.6;
        }

        img {
            max-width: 100%;
            height: auto;
        }

        .main-content-wrapper {
            padding: 1.25rem;
        }

        .header {
            text-align: center;
            margin-bottom: 1.25rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .header h1 {
            color: var(--primary-color);
            font-size: clamp(1.5rem, 4vw, 1.8rem);
            margin: 0.5rem 0;
            display: inline-flex;
            align-items: center;
            gap: 0.8rem;
            font-weight: 800;
        }

        .header .subtitle {
            font-size: 1.1rem;
            color: #555;
            margin-top: 0;
            margin-bottom: 0.6rem;
        }

        .button-group {
            display: flex;
            justify-content: center;
            gap: 0.6rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .section {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.25rem;
            background-color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .section-title {
            font-weight: 800;
            font-size: 1.3em;
            margin: 0 0 1rem 0;
            color: var(--primary-color);
            border-bottom: 1px solid #eee;
            padding-bottom: 0.6rem;
            display: flex;
            align-items: center;
            gap: 0.6rem;
        }

        .section p,
        .section li {
            line-height: 1.6;
            color: #333;
        }

        .section ul {
            padding-left: 1.25rem;
        }

        .infographic-flow {
            display: flex;
            justify-content: space-around;
            align-items: flex-start;
            margin-top: 1.5rem;
            text-align: center;
            flex-wrap: wrap;
        }

        .flow-step {
            flex: 1;
            min-width: 120px;
            max-width: 180px;
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f8f9fa;
            margin: 5px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .flow-step:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }

        .flow-step .fas {
            font-size: 1.8rem;
            color: var(--primary-color);
            margin-bottom: 0.6rem;
        }

        .flow-step strong {
            display: block;
            font-size: 1rem;
            color: var(--primary-color);
            min-height: 40px;
            font-weight: 600;
        }

        .flow-arrow {
            font-size: 2rem;
            color: var(--secondary-color);
            margin: 0 5px;
            align-self: center;
        }

        .grid-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.25rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--primary-color);
            font-weight: 600;
        }

        input,
        select,
        textarea {
            width: 100%;
            padding: 0.6rem;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 1rem;
            box-sizing: border-box;
            transition: border 0.3s, box-shadow 0.3s;
            font-family: 'Nunito', sans-serif;
        }

        input:focus,
        select:focus,
        textarea:focus,
        button:focus-visible {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            display: block;
            overflow-x: auto;
            white-space: nowrap;
        }

        th,
        td {
            text-align: left;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            vertical-align: middle;
            white-space: normal;
        }

        th {
            background-color: var(--primary-color);
            color: white;
            font-weight: 600;
        }

        tr:nth-child(even):not(.gantt-row) {
            background-color: #fdfdfd;
        }

        tr.task-row.status-pending {
            background-color: var(--status-pending);
        }

        tr.task-row.status-progress {
            background-color: var(--status-progress);
        }

        tr.task-row.status-completed {
            background-color: var(--status-completed);
        }

        tr.task-row.status-na {
            background-color: var(--status-na);
            text-decoration: line-through;
            color: #999;
        }

        details {
            border-radius: 8px;
            margin-bottom: 1rem;
            overflow: hidden;
            background: white;
            border: 1px solid #e0e0e0;
        }

        summary {
            font-size: 1.2em;
            font-weight: 800;
            color: var(--primary-color);
            padding: 1rem 1.25rem;
            cursor: pointer;
            background-color: #f8f9fa;
            list-style: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid transparent;
        }

        summary:hover {
            background-color: #f1f3f5;
        }

        .summary-title i {
            color: var(--secondary-color);
        }

        .toggle-icon::after {
            content: '+';
            font-size: 1.5em;
            font-weight: bold;
            transition: transform 0.2s;
            display: block;
        }

        details[open]>summary {
            border-bottom-color: var(--border-color);
        }

        details[open]>summary .toggle-icon::after {
            transform: rotate(45deg);
        }

        .phase-content {
            padding: 1.25rem;
        }

        .phase-description {
            font-style: italic;
            color: #555;
            margin-bottom: 1rem;
            padding: 0.6rem 1rem;
            background: #eaf2f8;
            border-left: 4px solid var(--secondary-color);
            border-radius: 4px;
        }

        .actions {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 2rem;
            padding-top: 1.25rem;
            border-top: 1px solid var(--border-color);
        }

        .button {
            color: white;
            padding: 0.7rem 1.25rem;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-family: 'Nunito', sans-serif;
            font-weight: 600;
        }

        .button.primary {
            background-color: var(--primary-color);
        }

        .button.success {
            background-color: var(--success-color);
        }

        .button.warning {
            background-color: var(--warning-color);
            color: #333;
        }

        .button.danger {
            background-color: var(--danger-color);
            font-size: 0.9em;
            padding: 5px 10px;
        }

        .button.secondary {
            background-color: #34495e;
        }

        .table-actions {
            margin-top: 1rem;
        }

        @media (max-width: 992px) {
            .infographic-flow {
                flex-direction: column;
                align-items: center;
            }

            .flow-arrow {
                transform: rotate(90deg);
                margin: 1rem 0;
            }
        }

        footer {
            padding: 2rem 1.25rem;
            text-align: center;
        }

        .disclaimer-note {
            margin-top: 2rem;
            padding: 0 1rem;
            font-size: 0.8rem;
            color: #777;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        /* REGLAS AÑADIDAS PARA FORZAR EL COLOR ROJIZO DEL LOGO Y EL ICONO BLANCO */
        .tool-logo[data-color="17"] {
            background-color: var(--danger-color);
        }

        .tool-logo {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            width: 35px;
            height: 35px;
            border-radius: 8px;
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
        }

        .tool-logo[data-color="17"] i {
            color: white;
        }

        /* ===== ESTILOS GANTT (conservados) ===== */
        #gantt-chart-container {
            overflow-x: auto;
            padding: 1rem;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            margin-top: 1rem;
            background: #fff;
        }

        .gantt-inner-container {
            position: relative;
            min-width: 900px;
        }

        .gantt-header {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 20px;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--border-color);
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .gantt-header-timeline {
            position: relative;
            height: 30px;
        }

        .gantt-month-marker {
            position: absolute;
            top: 0;
            height: 100%;
            border-left: 1px dashed #ccc;
            font-size: 0.8rem;
            color: #777;
            padding-left: 5px;
            display: flex;
            align-items: center;
        }

        .gantt-body {
            position: relative;
        }

        .gantt-row {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 20px;
            align-items: center;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            padding: 2px 0;
        }

        .gantt-label {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .gantt-bar-container {
            position: relative;
            height: 25px;
            background-color: #f0f0f0;
            border-radius: 4px;
        }

        .gantt-bar {
            position: absolute;
            height: 100%;
            border-radius: 4px;
            background-color: var(--secondary-color);
            opacity: 0.8;
            transition: background-color 0.3s;
        }

        .gantt-bar.completed {
            background-color: var(--success-color);
        }

        .gantt-bar.progress {
            background-color: var(--warning-color);
        }

        .gantt-bar:hover {
            opacity: 1;
        }

        /* ===== NUEVOS ESTILOS PARA TABS ===== */
        .tabs-container {
            background: #fff;
            border: 1px solid #e1e5e9;
            border-top: none;
            border-radius: 0 0 8px 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            width: 100%;
            max-width: 100%;
            overflow-x: hidden;
            position: relative;
            margin-bottom: 2rem;
            box-sizing: border-box;
        }

        .tabs-nav {
            display: flex;
            background-color: #f1f5f9;
            border-radius: 8px 8px 0 0;
            overflow-x: auto;
            border-bottom: 2px solid #3498db;
            margin-bottom: 0;
            margin-top: 0;
            scrollbar-width: none;
            -ms-overflow-style: none;
            width: 100%;
        }

        .tabs-nav::-webkit-scrollbar {
            display: none;
        }

        .tab-btn {
            padding: 1rem 1.5rem;
            border: none;
            background: none;
            cursor: pointer;
            font-weight: 700;
            color: #64748b;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            font-family: 'Nunito', sans-serif;
            font-size: 1rem;
            flex: 1;
            justify-content: center;
        }

        .tab-btn:hover {
            background-color: #e2e8f0;
            color: #2c3e50;
        }

        .tab-btn.active {
            background-color: #fff;
            color: #3498db;
            border-bottom-color: #3498db;
            border-radius: 8px 8px 0 0;
            margin-bottom: -2px;
            border-left: 1px solid #e1e5e9;
            border-right: 1px solid #e1e5e9;
            border-top: 1px solid #e1e5e9;
        }

        .wizard-tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
            width: 100%;
            box-sizing: border-box;
            max-width: 100%;
        }

        .wizard-tab-content.active {
            display: block;
            width: 100%;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(5px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .tab-content-wrapper {
            padding: 2rem;
            width: 100%;
            box-sizing: border-box;
            max-width: 100%;
        }

        /* Estilos para subtabs dentro de Project Setup */
        .subtabs-nav {
            display: flex;
            background-color: #edf2f7;
            border-radius: 6px 6px 0 0;
            overflow-x: auto;
            border-bottom: 2px solid #2c3e50;
            margin-bottom: 0;
            margin-top: 0;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .subtabs-nav::-webkit-scrollbar {
            display: none;
        }

        .subtab-btn {
            padding: 0.75rem 1rem;
            border: none;
            background: none;
            cursor: pointer;
            font-weight: 600;
            color: #4a5568;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            font-family: 'Nunito', sans-serif;
            font-size: 0.9rem;
        }

        .subtab-btn:hover {
            background-color: #e2e8f0;
            color: #2c3e50;
        }

        .subtab-btn.active {
            background-color: #fff;
            color: #2c3e50;
            border-bottom-color: #2c3e50;
            border-radius: 6px 6px 0 0;
            margin-bottom: -2px;
            border-left: 1px solid #cbd5e0;
            border-right: 1px solid #cbd5e0;
            border-top: 1px solid #cbd5e0;
        }

        .subtabs-container {
            background: #fff;
            border: 1px solid #cbd5e0;
            border-top: none;
            border-radius: 0 0 6px 6px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            width: 100%;
            overflow-x: hidden;
            position: relative;
            margin-bottom: 1.5rem;
        }

        .subtab-content {
            display: none;
            padding: 1.5rem;
            width: 100%;
            box-sizing: border-box;
        }

        .subtab-content.active {
            display: block;
        }

        /* Botones de exportación */
        .export-buttons {
            display: flex;
            gap: 10px;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .button.export-excel {
            background-color: #27ae60;
        }

        .button.export-image {
            background-color: #e67e22;
        }

        @media (max-width: 768px) {
            .tab-content-wrapper {
                padding: 1rem;
            }

            .tab-btn {
                padding: 0.75rem 0.5rem;
                font-size: 0.9rem;
            }

            .subtab-btn {
                padding: 0.6rem 0.5rem;
                font-size: 0.8rem;
            }

            .export-buttons {
                flex-direction: column;
            }

            .export-buttons .button {
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .tab-content-wrapper {
                padding: 0.75rem;
            }

            .tab-btn {
                padding: 0.6rem 0.3rem;
                font-size: 0.8rem;
            }
        }
    </style>
</head>

<body>
    <div id="header-container"></div>

    <noscript>
        <nav>
            <a href="/">Home</a> |
            <a href="/8d">8D Tool</a> |
            <a href="/taguchi_doe">Taguchi DOE</a> |
            <a href="/swot">SWOT Analysis</a> |
            <a href="/balancedcard">Balanced Scorecard</a> |
            <a href="/qfd">QFD</a> |
            <a href="/apqp-ppap">APQP/PPAP</a> |
            <a href="/ishikawa">Ishikawa</a> |
            <a href="/fmea">FMEA</a> |
            <a href="/vave">VAVE</a> |
            <a href="/eisenhower">Eisenhower Matrix</a> |
            <a href="/triz">TRIZ</a> |
            <a href="/weibull">Weibull</a> |
            <a href="/stack_up_analysis">Tolerance Stack-Up</a> |
            <a href="/pdca">PDCA</a> |
            <a href="/design_thinking">Design Thinking</a> |
            <a href="/pugh">Pugh Matrix</a> |
            <a href="/cpk_calculator">CpK Calculator</a> |
            <a href="/control-plan">Control Plan</a>
        </nav>
    </noscript>

    <main class="main-content-wrapper">
        <header class="header">
            <div class="tool-logo" data-color='17'><i class="fas fa-file-invoice"></i></div>
            <h1>Free Online Dynamic APQP/PPAP Planning Tool</h1>
            <p class="subtitle">An interactive tool to manage product launch projects according to industry standards.
            </p>
        </header>

        <div class="button-group">
            <button id="load-example-btn" class="button success"><i class="fas fa-lightbulb"></i> Load Example</button>
            <button id="reset-btn" class="button warning"><i class="fas fa-undo"></i> Reset</button>
        </div>

        <div class="tabs-container">
            <nav class="tabs-nav">
                <button class="tab-btn active" onclick="switchMainTab('tab-theory')">
                    <i class="fas fa-book"></i> Theory & Info
                </button>
                <button class="tab-btn" onclick="switchMainTab('tab-project-setup')">
                    <i class="fas fa-edit"></i> Project Setup
                </button>
                <button class="tab-btn" onclick="switchMainTab('tab-gantt')">
                    <i class="fas fa-chart-bar"></i> Gantt
                </button>
                <button class="tab-btn" onclick="switchMainTab('tab-action-plan')">
                    <i class="fas fa-clipboard-check"></i> Action Plan
                </button>
            </nav>

            <div id="tab-theory" class="wizard-tab-content active">
                <div class="tab-content-wrapper">
                    <section class="section">
                        <h2 class="section-title"><i class="fas fa-info-circle"></i> What are APQP & PPAP?</h2>
                        <p><strong>Advanced Product Quality Planning (APQP)</strong> is a structured framework of
                            procedures and techniques used to develop products, particularly in the automotive industry.
                            The primary goal of APQP is to ensure that new products meet customer requirements through a
                            standardized, preventative process, rather than relying on defect detection after
                            production.</p>
                        <p><strong>Production Part Approval Process (PPAP)</strong> is a key output of the APQP
                            process, typically concluding Phase 4. It is the formal method for providing evidence that a
                            supplier's production process can consistently produce parts that meet all customer
                            engineering design and specification requirements. The PPAP package is a comprehensive set
                            of documents that serves as official approval to begin mass production.</p>
                    </section>
                    <section class="section">
                        <h2 class="section-title"><i class="fas fa-history"></i> History and Purpose</h2>
                        <p>The concept of APQP was developed in the late 1980s by the <strong>Automotive Industry
                                Action Group (AIAG)</strong>, a non-profit association founded by the 'Big Three' U.S.
                            automobile manufacturers: Ford, General Motors, and Chrysler. The goal was to standardize
                            the product development and quality planning process for their vast network of suppliers.
                        </p>
                        <p>Before APQP, suppliers dealt with different requirements from each manufacturer, leading to
                            complexity and inefficiency. APQP created a common language and a single, robust framework
                            to guide product development from concept to full production. Its purpose is to foster clear
                            communication, identify and mitigate risks early, and ensure that the final product is
                            delivered on time, within budget, and to the customer's satisfaction. This proactive
                            approach is visualized through its five distinct phases:</p>
                        <div class="infographic-flow">
                            <div class="flow-step"><i class="fas fa-clipboard-list"></i><strong>Phase 1: Plan &
                                    Define</strong><span>Understand the customer's voice.</span></div>
                            <div class="flow-arrow"><i class="fas fa-long-arrow-alt-right"></i></div>
                            <div class="flow-step"><i class="fas fa-drafting-compass"></i><strong>Phase 2: Product
                                    Design</strong><span>Develop product features and characteristics.</span></div>
                            <div class="flow-arrow"><i class="fas fa-long-arrow-alt-right"></i></div>
                            <div class="flow-step"><i class="fas fa-cogs"></i><strong>Phase 3: Process
                                    Design</strong><span>Design a capable manufacturing system.</span></div>
                            <div class="flow-arrow"><i class="fas fa-long-arrow-alt-right"></i></div>
                            <div class="flow-step"><i class="fas fa-check-double"></i><strong>Phase 4:
                                    Validation</strong><span>Validate the manufacturing process.</span></div>
                            <div class="flow-arrow"><i class="fas fa-long-arrow-alt-right"></i></div>
                            <div class="flow-step"><i class="fas fa-chart-line"></i><strong>Phase 5:
                                    Feedback</strong><span>Assess and improve continuously.</span></div>
                        </div>
                    </section>
                    <section class="section">
                        <h2 class="section-title"><i class="fas fa-question-circle"></i> How to Use This Planner</h2>
                        <ul>
                            <li><strong>Step 1: Project Setup:</strong> Enter the basic project information, including
                                the project name, part number, customer, and project lead. Add team members' names, one
                                per line, to make them available for assignment.</li>
                            <li><strong>Step 2: Plan APQP Phases:</strong> For each of the five APQP phases, add
                                specific tasks, assign a responsible team member, set start/end dates, and update the
                                status and notes as the project progresses.</li>
                            <li><strong>Step 3: Manage PPAP Checklist:</strong> Review the 18 standard PPAP elements.
                                Assign a responsible person, update the status (Pending, In Progress, Completed, or
                                N/A), and add any relevant notes.</li>
                            <li><strong>Step 4: Visualize Progress:</strong> After entering dates for your APQP tasks,
                                click "Generate Gantt" to see a visual timeline of your project.</li>
                            <li><strong>Step 5: Track Actions:</strong> Click "Generate Action Plan" to automatically
                                create a to-do list of all pending and in-progress items from both APQP and PPAP
                                sections.</li>
                            <li><strong>Step 6: Export Report:</strong> Once your plan is complete, use the "Export to
                                Excel" button to download a comprehensive report containing all project details, plans,
                                and checklists.</li>
                        </ul>
                    </section>
                </div>
            </div>

            <div id="tab-project-setup" class="wizard-tab-content">
                <div class="tab-content-wrapper">
                    <div class="subtabs-container">
                        <nav class="subtabs-nav">
                            <button class="subtab-btn active" onclick="switchSubTab('subtab-project-config')">Project
                                Setup</button>
                            <button class="subtab-btn" onclick="switchSubTab('subtab-phase1')">Phase 1</button>
                            <button class="subtab-btn" onclick="switchSubTab('subtab-phase2')">Phase 2</button>
                            <button class="subtab-btn" onclick="switchSubTab('subtab-phase3')">Phase 3</button>
                            <button class="subtab-btn" onclick="switchSubTab('subtab-phase4')">Phase 4</button>
                            <button class="subtab-btn" onclick="switchSubTab('subtab-phase5')">Phase 5</button>
                            <button class="subtab-btn" onclick="switchSubTab('subtab-ppap')">PPAP Checklist</button>
                        </nav>

                        <div id="subtab-project-config" class="subtab-content active">
                            <div id="project-setup-section"></div>
                        </div>

                        <div id="subtab-phase1" class="subtab-content">
                            <div id="apqp-phase-1"></div>
                        </div>

                        <div id="subtab-phase2" class="subtab-content">
                            <div id="apqp-phase-2"></div>
                        </div>

                        <div id="subtab-phase3" class="subtab-content">
                            <div id="apqp-phase-3"></div>
                        </div>

                        <div id="subtab-phase4" class="subtab-content">
                            <div id="apqp-phase-4"></div>
                        </div>

                        <div id="subtab-phase5" class="subtab-content">
                            <div id="apqp-phase-5"></div>
                        </div>

                        <div id="subtab-ppap" class="subtab-content">
                            <div id="ppap-checklist"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="tab-gantt" class="wizard-tab-content">
                <div class="tab-content-wrapper">
                    <section class="section">
                        <h2 class="section-title"><i class="fas fa-chart-bar"></i>APQP Gantt Chart</h2>
                        <button class="button primary" onclick="generateGantt()"><i class="fas fa-project-diagram"></i>
                            Generate Gantt</button>

                        <div class="export-buttons">
                            <button class="button export-excel" onclick="exportGanttToExcel()">
                                <i class="fas fa-file-excel"></i> Export Gantt to Excel
                            </button>
                            <button class="button export-image" onclick="exportGanttToImage()">
                                <i class="fas fa-image"></i> Export Gantt to Image
                            </button>
                        </div>

                        <div id="gantt-chart-container">Enter task dates and click "Generate" to see the project
                            timeline.</div>
                    </section>
                </div>
            </div>

            <div id="tab-action-plan" class="wizard-tab-content">
                <div class="tab-content-wrapper">
                    <section class="section">
                        <h2 class="section-title"><i class="fas fa-clipboard-check"></i>Automatic Action Plan</h2>
                        <button class="button primary" onclick="generateActionItems()"><i class="fas fa-bolt"></i>
                            Generate Action Plan</button>

                        <div class="export-buttons">
                            <button class="button export-excel" onclick="exportActionPlanToExcel()">
                                <i class="fas fa-file-excel"></i> Export Action Plan to Excel
                            </button>
                        </div>

                        <table id="action-items-table">
                            <thead>
                                <tr>
                                    <th>Action Item</th>
                                    <th>Responsible</th>
                                    <th>Due Date</th>
                                    <th>Source</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="4" style="text-align:center;">Click "Generate" to populate with
                                        pending and in-progress tasks.</td>
                                </tr>
                            </tbody>
                        </table>
                    </section>
                </div>
            </div>
        </div>
    </main>

    <footer role="contentinfo">
        <div class="disclaimer-note">
            <p><strong>Disclaimer:</strong> The tools and information provided on Sigma Exacta are for informational and
                educational purposes only. This tool is based on established methodologies like the APQP and PPAP
                frameworks developed by the AIAG (Automotive Industry Action Group), which are the intellectual property
                of their respective owners. The tools on this site are independent implementations and are not
                affiliated with, sponsored by, or endorsed by the AIAG. While we strive for accuracy, we make no
                warranty or guarantee regarding the results. All calculations and decisions based on the output of these
                tools are the sole responsibility of the user. Sigma Exacta and its creators are not liable for any
                damages or losses resulting from the use of this website.</p>
        </div>
    </footer>

    <script>
        // Función para cargar el header dinámicamente
        function loadHeader() {
            fetch('header.html')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.text();
                })
                .then(data => {
                    document.getElementById('header-container').innerHTML = data;
                    // Inicializar el menú después de cargar el header
                    initializeMenu();
                })
                .catch(error => {
                    console.error('Error loading header:', error);
                });
        }

        // Función para inicializar el menú
        function initializeMenu() {
            const hoverSound = new Audio('data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABgAZGF0YQQAAAAAAAC/AAABAAAA//8AAnIseAABAHwAAU5/AABXfgAAS34AAEd+AABJfgAATX4AAFV+AABXfgAAVH4AAFN+AABTfgAAS34AAE9+AABVfgAAUX4AAEN+AABAfQAAP30AAD59AAA/fQAAQ30AAEd9AABLfQAAUn0AAGB9AABsfQAAe30AAH59AACAfQAAf30AAHx9AAB1fQAAcX0AAHN9AAB1fQAAdX0AAHJ9AABxPQAAeD4AAHc/AAB2PwAAcj8AAHI/AABxPwAAcT8AAHE/AABwPwAAcD8AAHA/AABvPwAAcD8AAHA/AABvPwAAaz0AAG4/AABsPwAAZj8AAGQ/AABiPwAAZD8AAGI/AABhPwAAYT8AAGI/AABiPwAAYT8AAGM/AABlPwAAaD8AAGs/AABuPwAAbj8AAG0/AABsPwAAbD8AAGs/AABoPwAAZD8AAGM/AABkPwAAZz8AAGg/AABrPwAAbT8AAHA/AABzPwAAcz8AAHM/AABzPwAAcT8AAHE/AABxPwAAcD8AAHA/AABwPwAAbj8AAGs/AABpPwAAaD8AAGc/AABhPwAAYD8AAF8/AABePwAAXT8AAFw/AABbPwAAWj8AAFk/AABYPwAAWj8AAFk/AABZPwAAWT8AAFk/AABYPwAAVT8AAFI/AABPPwAATD8AAEk/AABGPwAAQz8AAEA/AAA+PwAAO/8AADf8AAA1/AAANfwAADX8AAA1/AAANfwAADX8AAA2/AAAN/wAADf8AAA3/AAAN/wAADf8AAA3/AAAN/wAADf8AAA4/AAAOPwAADj8AAA4/AAAOPwAADj8AAA4/AAAN/wAADf8AAA3/AAAN/wAADf8AAA3/AAAN/wAADf8AAA3/AAAN/wAADf8AAA3/AAAN/wAADf8AA');
            hoverSound.preload = 'auto';
            let audioUnlocked = false;
            function unlockAudio() { if (audioUnlocked) return; hoverSound.volume = 0; hoverSound.play().then(() => { hoverSound.pause(); hoverSound.currentTime = 0; hoverSound.volume = 1; audioUnlocked = true; document.removeEventListener('click', unlockAudio); document.removeEventListener('touchstart', unlockAudio); }).catch(e => { }); }
            document.addEventListener('click', unlockAudio);
            document.addEventListener('touchstart', unlockAudio);
            const featureCards = document.querySelectorAll('.feature-card');
            featureCards.forEach(card => { card.addEventListener('mouseenter', () => { if (audioUnlocked) { hoverSound.currentTime = 0; hoverSound.play().catch(e => { }); } }); });
            const navToggle = document.getElementById('nav-toggle');
            const navMenu = document.getElementById('nav-menu');
            const toolsDropdownToggle = document.getElementById('tools-dropdown-toggle');
            const toolsDropdownMenu = document.getElementById('tools-dropdown-menu');
            const toolsDropdownContainer = document.getElementById('tools-dropdown-container');
            navToggle.addEventListener('click', () => { navMenu.classList.toggle('show-menu'); const icon = navToggle.querySelector('i'); icon.classList.toggle('fa-bars'); icon.classList.toggle('fa-times'); if (!navMenu.classList.contains('show-menu')) { toolsDropdownMenu.classList.remove('show-submenu'); toolsDropdownContainer.classList.remove('active'); } });
            toolsDropdownToggle.addEventListener('click', (event) => { if (window.innerWidth <= 992) { event.preventDefault(); toolsDropdownMenu.classList.toggle('show-submenu'); toolsDropdownContainer.classList.toggle('active'); } });
        }

        // --- FUNCIONES PARA TABS ---
        function switchMainTab(tabId) {
            // Quitar clase active de todos los botones y contenidos
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.wizard-tab-content').forEach(content => content.classList.remove('active'));

            // Activar el contenido seleccionado
            document.getElementById(tabId).classList.add('active');

            // Activar botón correspondiente
            const activeBtn = document.querySelector(`button[onclick="switchMainTab('${tabId}')"]`);
            if (activeBtn) activeBtn.classList.add('active');

            // Scroll al top suavemente
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function switchSubTab(subTabId) {
            // Quitar clase active de todos los botones y contenidos de subtabs
            document.querySelectorAll('.subtab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.subtab-content').forEach(content => content.classList.remove('active'));

            // Activar el contenido seleccionado
            document.getElementById(subTabId).classList.add('active');

            // Activar botón correspondiente
            const activeBtn = document.querySelector(`button[onclick="switchSubTab('${subTabId}')"]`);
            if (activeBtn) activeBtn.classList.add('active');

            // Scroll al top suavemente
            window.scrollTo({ top: document.querySelector('.subtabs-container').offsetTop, behavior: 'smooth' });
        }

        // --- SCRIPT de la herramienta APQP/PPAP (Lógica principal modificada para tabs) ---
        let state = {};
        const getInitialState = () => ({
            projectInfo: {
                name: '',
                partNumber: '',
                customer: '',
                lead: '',
                team: [],
            },
            apqpPhases: [
                {
                    id: 1,
                    title: 'Phase 1: Plan and Define Program',
                    icon: 'fa-clipboard-list',
                    desc: 'Objective: To ensure customer needs and expectations are clearly understood.',
                    tasks: []
                },
                {
                    id: 2,
                    title: 'Phase 2: Product Design & Development',
                    icon: 'fa-drafting-compass',
                    desc: 'Objective: To develop the product\'s features and design.',
                    tasks: []
                },
                {
                    id: 3,
                    title: 'Phase 3: Process Design & Development',
                    icon: 'fa-cogs',
                    desc: 'Objective: To design and develop a capable manufacturing system.',
                    tasks: []
                },
                {
                    id: 4,
                    title: 'Phase 4: Product & Process Validation',
                    icon: 'fa-check-double',
                    desc: 'Objective: To validate that the process can consistently produce a compliant product.',
                    tasks: []
                },
                {
                    id: 5,
                    title: 'Phase 5: Feedback, Assessment & Corrective Action',
                    icon: 'fa-chart-line',
                    desc: 'Objective: Monitor performance, reduce variation, and document lessons learned.',
                    tasks: []
                }
            ],
            ppapElements: [
                "Design Records",
                "Engineering Change Docs",
                "Customer Engineering Approval",
                "Design FMEA (DFMEA)",
                "Process Flow Diagram",
                "Process FMEA (PFMEA)",
                "Control Plan",
                "Measurement System Analysis (MSA)",
                "Dimensional Results",
                "Material/Performance Test Results",
                "Initial Process Studies",
                "Qualified Laboratory Documentation",
                "Appearance Approval Report (AAR)",
                "Sample Production Parts",
                "Master Sample",
                "Checking Aids",
                "Customer-Specific Requirements",
                "Part Submission Warrant (PSW)"
            ].map((name, index) => ({
                id: Date.now() + index,
                name,
                responsible: '',
                status: 'pending',
                notes: ''
            }))
        });

        function renderResponsibleDropdown(selectedValue = '') {
            const options = state.projectInfo.team.map(member =>
                `<option value="${member}" ${member === selectedValue ? 'selected' : ''}>${member}</option>`
            ).join('');
            return `<select class="responsible-selector"><option value="">--Select--</option>${options}</select>`;
        }

        function renderStatusDropdown(selectedValue = 'pending') {
            const statuses = {
                pending: 'Pending',
                progress: 'In Progress',
                completed: 'Completed',
                na: 'N/A'
            };
            const options = Object.entries(statuses).map(([key, value]) =>
                `<option value="${key}" ${key === selectedValue ? 'selected' : ''}>${value}</option>`
            ).join('');
            return `<select class="status-selector">${options}</select>`;
        }

        function renderProjectSetup() {
            const { name, partNumber, customer, lead, team } = state.projectInfo;
            const container = document.getElementById('project-setup-section');
            container.innerHTML = `
                <h2 class="section-title"><i class="fas fa-info-circle"></i> Project Setup</h2>
                <div class="grid-form">
                    <div class="form-group"><label for="project-name">Project / Program Name</label><input type="text" id="project-name" value="${name}"></div>
                    <div class="form-group"><label for="part-number">Part Number</label><input type="text" id="part-number" value="${partNumber}"></div>
                    <div class="form-group"><label for="customer">Customer</label><input type="text" id="customer" value="${customer}"></div>
                    <div class="form-group"><label for="project-lead">Project Lead</label><input type="text" id="project-lead" value="${lead}"></div>
                </div>
                <div class="form-group" style="margin-top: 20px;">
                    <label for="team-members">Team Members (one name per line)</label>
                    <textarea id="team-members" rows="4" placeholder="John Doe\nJane Smith">${team.join('\n')}</textarea>
                </div>`;
        }

        function renderApqpPhases() {
            state.apqpPhases.forEach((phase, phaseIndex) => {
                const container = document.getElementById(`apqp-phase-${phase.id}`);
                if (!container) return;
                container.innerHTML = `
                    <h3 class="section-title"><i class="fas ${phase.icon}"></i> ${phase.title}</h3>
                    <p class="phase-description"><strong>${phase.desc}</strong></p>
                    <table class="apqp-table">
                        <thead>
                            <tr>
                                <th>Task / Element</th>
                                <th style="width: 20%;">Responsible</th>
                                <th style="width: 10%;">Start</th>
                                <th style="width: 10%;">End</th>
                                <th style="width: 15%;">Status</th>
                                <th style="width: 25%;">Notes</th>
                                <th style="width: 5%;">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${phase.tasks.map(task => `
                                <tr class="task-row status-${task.status}" data-task-id="${task.id}" data-phase-index="${phaseIndex}">
                                    <td><input type="text" placeholder="New task..." value="${task.name}"></td>
                                    <td>${renderResponsibleDropdown(task.responsible)}</td>
                                    <td><input type="date" value="${task.start}"></td>
                                    <td><input type="date" value="${task.end}"></td>
                                    <td>${renderStatusDropdown(task.status)}</td>
                                    <td><input type="text" value="${task.notes}"></td>
                                    <td><button class="button danger remove-task-btn"><i class="fas fa-trash"></i></button></td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    <div class="table-actions">
                        <button class="button secondary add-task-btn" data-phase-index="${phaseIndex}"><i class="fas fa-plus"></i> Add Task</button>
                    </div>`;
            });
        }

        function renderPpapChecklist() {
            const container = document.getElementById('ppap-checklist');
            if (!container) return;
            container.innerHTML = `
                <table id="ppap-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>PPAP Element</th>
                            <th style="width: 20%;">Responsible</th>
                            <th style="width: 15%;">Status</th>
                            <th style="width: 25%;">Notes</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${state.ppapElements.map((elem, index) => `
                            <tr class="task-row status-${elem.status}" data-task-id="${elem.id}">
                                <td>${index + 1}</td>
                                <td><input type="text" placeholder="New PPAP element..." value="${elem.name}"></td>
                                <td>${renderResponsibleDropdown(elem.responsible)}</td>
                                <td>${renderStatusDropdown(elem.status)}</td>
                                <td><input type="text" value="${elem.notes}"></td>
                                <td><button class="button danger remove-task-btn"><i class="fas fa-trash"></i></button></td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
                <div class="table-actions">
                    <button class="button secondary add-ppap-btn"><i class="fas fa-plus"></i> Add Element</button>
                </div>`;
        }

        function renderAll() {
            renderProjectSetup();
            renderApqpPhases();
            renderPpapChecklist();
        }

        function setupEventListeners() {
            // Usar delegación de eventos en el documento para manejar elementos dinámicos
            document.addEventListener('change', e => {
                const target = e.target;
                const taskRow = target.closest('tr[data-task-id]');
                if (!taskRow) return;

                const taskId = Number(taskRow.dataset.taskId);
                const phaseIndex = taskRow.dataset.phaseIndex;
                let element;

                if (phaseIndex !== undefined) {
                    element = state.apqpPhases[phaseIndex].tasks.find(t => t.id === taskId);
                } else {
                    element = state.ppapElements.find(el => el.id === taskId);
                }

                if (!element) return;

                if (target.matches('input[type="text"]')) {
                    const prop = taskRow.cells[taskRow.cells.length === 7 ? 0 : 1].contains(target) ? 'name' : 'notes';
                    element[prop] = target.value;
                } else if (target.matches('input[type="date"]')) {
                    const prop = taskRow.cells[2].contains(target) ? 'start' : 'end';
                    element[prop] = target.value;
                } else if (target.matches('.responsible-selector')) {
                    element.responsible = target.value;
                } else if (target.matches('.status-selector')) {
                    element.status = target.value;
                    taskRow.className = `task-row status-${element.status}`;
                }
            });

            document.addEventListener('input', e => {
                const target = e.target;
                if (target.id === 'project-name') state.projectInfo.name = target.value;
                if (target.id === 'part-number') state.projectInfo.partNumber = target.value;
                if (target.id === 'customer') state.projectInfo.customer = target.value;
                if (target.id === 'project-lead') state.projectInfo.lead = target.value;
                if (target.id === 'team-members') {
                    state.projectInfo.team = target.value.split('\n').filter(Boolean);
                }
            });

            document.addEventListener('focusout', e => {
                if (e.target.id === 'team-members') {
                    renderAll();
                }
            });

            document.addEventListener('click', e => {
                const target = e.target.closest('button');
                if (!target) return;

                if (target.classList.contains('add-task-btn')) {
                    const phaseIndex = target.dataset.phaseIndex;
                    state.apqpPhases[phaseIndex].tasks.push({
                        id: Date.now(),
                        name: '',
                        responsible: '',
                        start: '',
                        end: '',
                        status: 'pending',
                        notes: ''
                    });
                    renderApqpPhases();
                }

                if (target.classList.contains('add-ppap-btn')) {
                    state.ppapElements.push({
                        id: Date.now(),
                        name: '',
                        responsible: '',
                        status: 'pending',
                        notes: ''
                    });
                    renderPpapChecklist();
                }

                if (target.classList.contains('remove-task-btn')) {
                    const taskRow = target.closest('tr[data-task-id]');
                    const taskId = Number(taskRow.dataset.taskId);
                    const phaseIndex = taskRow.dataset.phaseIndex;

                    if (phaseIndex !== undefined) {
                        state.apqpPhases[phaseIndex].tasks = state.apqpPhases[phaseIndex].tasks.filter(t => t.id !== taskId);
                        renderApqpPhases();
                    } else {
                        state.ppapElements = state.ppapElements.filter(el => el.id !== taskId);
                        renderPpapChecklist();
                    }
                }
            });

            document.getElementById('load-example-btn').addEventListener('click', loadExample);
            document.getElementById('reset-btn').addEventListener('click', resetForm);
        }

        function init() {
            state = getInitialState();
            renderAll();
            setupEventListeners();
            document.querySelector('#action-items-table tbody').innerHTML = '<tr><td colspan="4" style="text-align:center;">Click "Generate" to populate.</td></tr>';
            document.getElementById('gantt-chart-container').innerHTML = 'Enter task dates and click "Generate" to see the project timeline.';
        }

        function loadExample() {
            const today = new Date();
            const d = (days) => new Date(today.getTime() + days * 86400000).toISOString().split('T')[0];
            const exampleState = getInitialState();
            exampleState.projectInfo = {
                name: 'Next-Gen LED Headlight Assembly',
                partNumber: 'HL-2025-A1',
                customer: 'Aura Motors',
                lead: 'Sarah Miller',
                team: ['Sarah Miller', 'David Chen', 'Emily Rodriguez', 'Michael Johnson']
            };

            exampleState.apqpPhases[0].tasks = [
                { id: Date.now() + 1, name: 'Customer Requirements (SOR) Review', responsible: 'Sarah Miller', start: d(0), end: d(7), status: 'completed', notes: 'SOR v2.1 analyzed.' },
                { id: Date.now() + 2, name: 'Preliminary Feasibility Study', responsible: 'David Chen', start: d(5), end: d(15), status: 'completed', notes: 'Feasible with tooling investment.' },
                { id: Date.now() + 3, name: 'Define Quality & Reliability Goals', responsible: 'Emily Rodriguez', start: d(10), end: d(20), status: 'progress', notes: 'Targeting >50k hours lifespan.' }
            ];

            exampleState.apqpPhases[1].tasks = [
                { id: Date.now() + 4, name: 'DFMEA', responsible: 'David Chen', start: d(21), end: d(40), status: 'progress', notes: 'High RPNs on heat dissipation.' },
                { id: Date.now() + 5, name: 'Prototype Build A', responsible: 'Michael Johnson', start: d(41), end: d(55), status: 'pending', notes: '' },
                { id: Date.now() + 6, name: 'Design Verification Plan & Report (DVP&R)', responsible: 'Emily Rodriguez', start: d(45), end: d(70), status: 'pending', notes: 'Vibration and thermal tests planned.' }
            ];

            exampleState.apqpPhases[2].tasks = [
                { id: Date.now() + 7, name: 'Process Flow Diagram', responsible: 'Michael Johnson', start: d(60), end: d(70), status: 'completed', notes: 'Final version approved.' },
                { id: Date.now() + 8, name: 'PFMEA', responsible: 'Michael Johnson', start: d(71), end: d(90), status: 'progress', notes: '' },
                { id: Date.now() + 9, name: 'Control Plan (Pre-launch)', responsible: 'Emily Rodriguez', start: d(85), end: d(95), status: 'pending', notes: '' }
            ];

            exampleState.apqpPhases[3].tasks = [
                { id: Date.now() + 10, name: 'Significant Production Run', responsible: 'Michael Johnson', start: d(100), end: d(105), status: 'pending', notes: '300 pieces planned.' },
                { id: Date.now() + 11, name: 'Capability Studies (Pp/Ppk)', responsible: 'Emily Rodriguez', start: d(106), end: d(115), status: 'pending', notes: '' },
                { id: Date.now() + 12, name: 'Part Submission Warrant (PSW)', responsible: 'Sarah Miller', start: d(120), end: d(125), status: 'pending', notes: '' }
            ];

            exampleState.ppapElements[0].status = 'completed';
            exampleState.ppapElements[0].responsible = 'David Chen';
            exampleState.ppapElements[3].status = 'progress';
            exampleState.ppapElements[3].responsible = 'David Chen';
            exampleState.ppapElements[4].status = 'completed';
            exampleState.ppapElements[4].responsible = 'Michael Johnson';
            exampleState.ppapElements[5].status = 'progress';
            exampleState.ppapElements[5].responsible = 'Michael Johnson';
            exampleState.ppapElements[6].status = 'pending';
            exampleState.ppapElements[6].responsible = 'Emily Rodriguez';
            exampleState.ppapElements[12].status = 'na';

            state = exampleState;
            renderAll();

            // --- CAMBIO SOLICITADO: Cambiar Tab y Scroll ---
            switchMainTab('tab-project-setup');
            switchSubTab('subtab-project-config');

            const target = document.querySelector('.tabs-container');
            if (target) {
                target.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        function resetForm() {
            if (confirm("Are you sure you want to reset all project data?")) init();
        }

        // ===== FUNCIONES GANTT =====
        function generateGantt() {
            const container = document.getElementById('gantt-chart-container');
            const tasks = [];
            state.apqpPhases.forEach(phase => {
                phase.tasks.forEach(task => {
                    if (task.name && task.start && task.end) {
                        tasks.push({
                            name: task.name,
                            start: new Date(task.start + "T00:00:00"),
                            end: new Date(task.end + "T00:00:00"),
                            status: task.status
                        });
                    }
                });
            });

            if (tasks.length === 0) {
                container.innerHTML = 'No tasks with names and valid start/end dates found in APQP phases.';
                return;
            }

            tasks.sort((a, b) => a.start - b.start);
            const minDate = tasks[0].start;
            const maxDate = new Date(Math.max(...tasks.map(t => t.end)));
            const totalDurationDays = Math.max(1, (maxDate - minDate) / (1000 * 60 * 60 * 24));

            container.innerHTML = `
            <div class="gantt-inner-container">
                <div class="gantt-header">
                    <div>Task / Element</div>
                    <div class="gantt-header-timeline"></div>
                </div>
                <div class="gantt-body"></div>
            </div>
        `;

            const ganttHeaderTimeline = container.querySelector('.gantt-header-timeline');
            const ganttBody = container.querySelector('.gantt-body');

            const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
            let currentDate = new Date(minDate);
            currentDate.setDate(1);

            while (currentDate <= maxDate) {
                const monthOffsetDays = (currentDate - minDate) / (1000 * 60 * 60 * 24);
                const leftPercent = (monthOffsetDays / totalDurationDays) * 100;

                if (leftPercent >= 0 && leftPercent < 100) {
                    const marker = document.createElement('div');
                    marker.className = 'gantt-month-marker';
                    marker.style.left = `${leftPercent}%`;
                    marker.textContent = `${monthNames[currentDate.getMonth()]} '${String(currentDate.getFullYear()).slice(-2)}`;
                    ganttHeaderTimeline.appendChild(marker);
                }
                currentDate.setMonth(currentDate.getMonth() + 1);
            }

            tasks.forEach(task => {
                const startOffsetDays = (task.start - minDate) / (1000 * 60 * 60 * 24);
                const durationDays = Math.max(1, (task.end - task.start) / (1000 * 60 * 60 * 24));
                const leftPercent = (startOffsetDays / totalDurationDays) * 100;
                const widthPercent = (durationDays / totalDurationDays) * 100;

                const rowEl = document.createElement('div');
                rowEl.className = 'gantt-row';
                rowEl.innerHTML = `
                <div class="gantt-label" title="${task.name}">${task.name}</div>
                <div class="gantt-bar-container">
                    <div class="gantt-bar ${task.status}" style="left: ${leftPercent}%; width: ${widthPercent}%;" title="${task.name}: ${task.start.toLocaleDateString()} - ${task.end.toLocaleDateString()}"></div>
                </div>`;
                ganttBody.appendChild(rowEl);
            });
        }

        // ===== FUNCIONES DE EXPORTACIÓN =====
        function exportGanttToExcel() {
            const wb = XLSX.utils.book_new();

            // Hoja 1: Project Setup
            const { name, partNumber, customer, lead, team } = state.projectInfo;
            const project_info = [
                ["APQP/PPAP Project - Gantt Chart Export"],
                ["Generated on: " + new Date().toLocaleString()],
                [],
                ["PROJECT INFORMATION"],
                ["Project Name", name],
                ["Part Number", partNumber],
                ["Customer", customer],
                ["Project Lead", lead],
                [],
                ["Team Members"],
                ...team.map(m => [m])
            ];
            XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(project_info), "Project Info");

            // Hoja 2: Gantt Data
            const gantt_data = [["Phase", "Task", "Start Date", "End Date", "Duration (days)", "Status"]];
            state.apqpPhases.forEach(phase => {
                phase.tasks.forEach(task => {
                    if (task.name && task.start && task.end) {
                        const startDate = new Date(task.start);
                        const endDate = new Date(task.end);
                        const durationDays = Math.round((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;
                        gantt_data.push([phase.title, task.name, task.start, task.end, durationDays, task.status]);
                    }
                });
            });
            XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(gantt_data), "Gantt Data");

            // Hoja 3: Summary
            const summary_data = [
                ["APQP/PPAP GANTT CHART SUMMARY"],
                ["Generated on: " + new Date().toLocaleString()],
                [],
                ["Project Name", name],
                ["Total Phases", state.apqpPhases.length],
                ["Total Tasks", state.apqpPhases.reduce((sum, phase) => sum + phase.tasks.length, 0)],
                ["Tasks with Dates", state.apqpPhases.reduce((sum, phase) => sum + phase.tasks.filter(t => t.start && t.end).length, 0)],
                [],
                ["PHASE BREAKDOWN"]
            ];

            state.apqpPhases.forEach((phase, index) => {
                summary_data.push([`Phase ${index + 1}`, phase.tasks.length]);
            });

            XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(summary_data), "Summary");

            const projectName = state.projectInfo.name || "APQP_Gantt_Chart";
            XLSX.writeFile(wb, `${projectName.replace(/[\s/]/g, "_")}_Gantt.xlsx`);
        }

        function exportGanttToImage() {
            const container = document.getElementById('gantt-chart-container');

            if (container.innerHTML.includes('Enter task dates')) {
                alert("Please generate the Gantt chart first by clicking 'Generate Gantt'.");
                return;
            }

            html2canvas(container, {
                scale: 2,
                backgroundColor: "#ffffff",
                logging: false
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = `${state.projectInfo.name || 'APQP_Gantt'}_Chart.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
            });
        }

        function exportActionPlanToExcel() {
            // Primero generamos el action plan si no está generado
            generateActionItems();

            const wb = XLSX.utils.book_new();

            // Hoja 1: Project Setup
            const { name, partNumber, customer, lead, team } = state.projectInfo;
            const project_info = [
                ["APQP/PPAP Project - Action Plan Export"],
                ["Generated on: " + new Date().toLocaleString()],
                [],
                ["PROJECT INFORMATION"],
                ["Project Name", name],
                ["Part Number", partNumber],
                ["Customer", customer],
                ["Project Lead", lead],
                [],
                ["Team Members"],
                ...team.map(m => [m]),
                [],
                ["ACTION PLAN SUMMARY"],
                ["Total Pending/In-Progress Items", document.querySelectorAll('#action-items-table tbody tr').length - 1]
            ];
            XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(project_info), "Project Info");

            // Hoja 2: Action Plan
            const actionTable = document.getElementById("action-items-table");
            XLSX.utils.book_append_sheet(wb, XLSX.utils.table_to_sheet(actionTable), "Action Plan");

            // Hoja 3: APQP Tasks
            const apqp_data = [["Phase", "Task", "Responsible", "Start Date", "End Date", "Status", "Priority"]];
            let priorityCounter = 1;

            state.apqpPhases.forEach(phase => {
                phase.tasks.forEach(task => {
                    if ((task.status === 'pending' || task.status === 'progress') && task.name) {
                        const priority = `APQP-${String(priorityCounter).padStart(3, '0')}`;
                        apqp_data.push([phase.title, task.name, task.responsible || 'Unassigned', task.start || 'N/A', task.end || 'N/A', task.status, priority]);
                        priorityCounter++;
                    }
                });
            });
            XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(apqp_data), "APQP Tasks");

            // Hoja 4: PPAP Tasks
            const ppap_data = [["PPAP Element", "Responsible", "Status", "Priority"]];
            priorityCounter = 1;

            state.ppapElements.forEach(elem => {
                if ((elem.status === 'pending' || elem.status === 'progress') && elem.name) {
                    const priority = `PPAP-${String(priorityCounter).padStart(3, '0')}`;
                    ppap_data.push([elem.name, elem.responsible || 'Unassigned', elem.status, priority]);
                    priorityCounter++;
                }
            });
            XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(ppap_data), "PPAP Tasks");

            const projectName = state.projectInfo.name || "APQP_Action_Plan";
            XLSX.writeFile(wb, `${projectName.replace(/[\s/]/g, "_")}_Action_Plan.xlsx`);
        }

        function generateActionItems() {
            const actionTbody = document.querySelector('#action-items-table tbody');
            actionTbody.innerHTML = '';
            let hasActions = false;

            state.apqpPhases.forEach(phase => {
                phase.tasks.forEach(task => {
                    if ((task.status === 'pending' || task.status === 'progress') && task.name) {
                        const newRow = actionTbody.insertRow();
                        newRow.innerHTML = `<td>${task.name}</td><td>${task.responsible || 'Unassigned'}</td><td>${task.end || 'N/A'}</td><td>${phase.title}</td>`;
                        hasActions = true;
                    }
                });
            });

            state.ppapElements.forEach(elem => {
                if ((elem.status === 'pending' || elem.status === 'progress') && elem.name) {
                    const newRow = actionTbody.insertRow();
                    newRow.innerHTML = `<td>${elem.name}</td><td>${elem.responsible || 'Unassigned'}</td><td>N/A</td><td>PPAP Checklist</td>`;
                    hasActions = true;
                }
            });

            if (!hasActions) {
                actionTbody.innerHTML = '<tr><td colspan="4" style="text-align:center; color: var(--success-color);">No pending or in-progress actions found. Great job!</td></tr>';
            }
        }

        // Inicializar la aplicación cuando el DOM esté listo
        document.addEventListener('DOMContentLoaded', function () {
            // Cargar el header primero
            loadHeader();
            // Luego inicializar la aplicación APQP/PPAP
            init();
        });
    </script>

    <script src="dexie.min.js"></script>
    <script src="db-sigma.js"></script>  

</body>

</html>