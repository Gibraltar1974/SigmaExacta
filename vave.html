<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="canonical" href="https://sigmaexacta.com/vave" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VAVE Analysis Tool - Value Analysis & Value Engineering | Sigma Exacta</title>
    <meta name="description"
        content="Free Online Value Analysis (VAVE) analysis tool to optimize product value by analyzing functions and costs. Improve value index with our interactive Value Analysis and Value Engineering calculator. Export to Excel.">
    <meta name="keywords"
        content="Open source, Free Software, SigmaExacta, VAVE, Value Analysis, Value Engineering, function analysis, cost reduction, value index, product design, engineering tool, free VAVE tool, VA-VE">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="sigma-exacta-icon.jpg" type="image/jpeg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;800&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="styles.css">

    <style>
        /* Estilos específicos de la página VAVE */
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --success-color: #27ae60;
            font-size: 16px;
        }

        *,
        *::before,
        *::after {
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Nunito', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            color: #333;
            background-color: #f5f7fa;
            line-height: 1.6;
        }

        img {
            max-width: 100%;
            height: auto;
        }

        .main-content-wrapper {
            max-width: 100%;
            margin: 0;
            padding: 0;
            width: 100%;
        }

        .main-header {
            text-align: center;
            padding: 1rem 1.25rem;
            margin-bottom: 0;
            border-bottom: 1px solid #ddd;
            width: 100%;
            box-sizing: border-box;
        }

        .main-header h1 {
            color: #2c3e50;
            font-size: clamp(1.5rem, 4vw, 1.8rem);
            margin-top: 0.5rem;
            margin-bottom: 0.5rem;
            font-weight: 800;
        }

        .main-header p {
            color: #7f8c8d;
            font-weight: 400;
            font-size: 1.1rem;
            max-width: 700px;
            margin: 0 auto;
        }

        /* ESTILOS DEL SISTEMA DE PESTAÑAS (WIZARD) - Igual que en pugh.html */
        .tabs-nav {
            display: flex;
            background-color: #f1f5f9;
            border-radius: 8px 8px 0 0;
            overflow-x: auto;
            border-bottom: 2px solid #3498db;
            margin-bottom: 0;
            margin-top: 0;
            scrollbar-width: none;
            -ms-overflow-style: none;
            width: 100%;
        }

        .tabs-nav::-webkit-scrollbar {
            display: none;
        }

        .tab-btn {
            padding: 1rem 1.5rem;
            border: none;
            background: none;
            cursor: pointer;
            font-weight: 700;
            color: #64748b;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            font-family: 'Nunito', sans-serif;
            font-size: 1rem;
            flex: 1;
            justify-content: center;
        }

        .tab-btn:hover {
            background-color: #e2e8f0;
            color: #2c3e50;
        }

        .tab-btn.active {
            background-color: #fff;
            color: #3498db;
            border-bottom-color: #3498db;
            border-radius: 8px 8px 0 0;
            margin-bottom: -2px;
            border-left: 1px solid #e1e5e9;
            border-right: 1px solid #e1e5e9;
            border-top: 1px solid #e1e5e9;
        }

        .tabs-container {
            background: #fff;
            border: 1px solid #e1e5e9;
            border-top: none;
            border-radius: 0 0 8px 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            width: 100%;
            max-width: 100%;
            overflow-x: hidden;
            position: relative;
            margin-bottom: 2rem;
            box-sizing: border-box;
        }

        .wizard-tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
            width: 100%;
            box-sizing: border-box;
            max-width: 100%;
        }

        .wizard-tab-content.active {
            display: block;
            width: 100%;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(5px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .tab-content-wrapper {
            padding: 2rem;
            width: 100%;
            box-sizing: border-box;
            max-width: 100%;
        }

        /* CONTENEDORES DE CONTENIDO - Similar a pugh.html */
        .container {
            background-color: white;
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            width: 100%;
            box-sizing: border-box;
        }

        .container h2 {
            color: #2c3e50;
            margin-top: 0;
            border-bottom: 2px solid #3498db;
            padding-bottom: 0.6rem;
            font-weight: 800;
        }

        .container p,
        .container ol,
        .container ul {
            line-height: 1.8;
        }

        .container ol,
        .container ul {
            padding-left: 1.25rem;
        }

        /* ===== ESTILOS PARA LA ESTRUCTURA (igual que en FMEA) ===== */
        .panels-container {
            display: flex;
            flex-wrap: wrap;
            gap: 1.25rem;
            justify-content: center;
            width: 100%;
            margin-bottom: 1.25rem;
        }

        .structure-panel {
            background: white;
            padding: 1.25rem;
            border-radius: 8px;
            border: 1px solid #ddd;
            width: 300px;
            min-width: 250px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            flex-grow: 1;
        }

        .calculation-block {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.25rem;
            background-color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            width: 100%;
            box-sizing: border-box;
        }

        .calculation-title {
            font-weight: 800;
            font-size: 1.2em;
            margin-bottom: 1rem;
            color: #2c3e50;
            border-bottom: 1px solid #eee;
            padding-bottom: 0.6rem;
        }

        label {
            display: block;
            margin-bottom: 0.6rem;
            color: #2c3e50;
            font-weight: 600;
        }

        input[type="text"],
        input[type="number"],
        textarea,
        select {
            width: 100%;
            padding: 0.6rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            margin-bottom: 1rem;
            transition: border 0.3s, box-shadow 0.3s;
            font-family: 'Nunito', sans-serif;
            box-sizing: border-box;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        textarea:focus,
        select:focus,
        button:focus-visible {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.3);
        }

        button {
            background-color: #3498db;
            color: white;
            padding: 0.7rem 1.25rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 1rem;
            transition: background-color 0.3s, box-shadow 0.3s;
            font-weight: 600;
            font-family: 'Nunito', sans-serif;
        }

        button:hover {
            background-color: #2980b9;
        }

        button:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }

        .item-list {
            margin-top: 1rem;
            max-height: 400px;
            overflow-y: auto;
        }

        .item {
            padding: 0.6rem;
            margin-bottom: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #f8f9fa;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .item-name {
            flex-grow: 1;
            margin-right: 0.6rem;
        }

        .item-actions button {
            padding: 5px 8px;
            font-size: 0.8rem;
            margin: 0 2px;
        }

        /* ===== ESTILOS PARA EL DIAGRAMA DE RED ===== */
        #network-wrapper {
            position: relative;
            width: 100%;
            margin: 1.25rem auto;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            padding: 1rem;
        }

        #networkChart {
            width: 100%;
            height: 600px;
            position: relative;
        }

        #networkCanvas {
            width: 100%;
            height: 100%;
        }

        #networkIcon {
            position: absolute;
            top: 25px;
            left: 25px;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            z-index: 1001;
            filter: invert(1);
        }

        #fitViewBtn,
        #exportChartBtn {
            position: absolute;
            top: 25px;
            z-index: 1001;
            padding: 0.5rem 0.75rem;
        }

        #fitViewBtn {
            right: 25px;
        }

        #exportChartBtn {
            right: 80px;
            background-color: #16a085;
        }

        #exportChartBtn:hover {
            background-color: #117a65;
        }

        #generateVAVEValuesBtn {
            padding: 0.6rem 1rem;
            font-size: 1em;
            background-color: #9013fe;
            margin-bottom: 1.5rem;
        }

        #generateVAVEValuesBtn:hover {
            background-color: #7a0fd8;
        }

        #network-instruction {
            position: absolute;
            top: 1rem;
            left: 50%;
            transform: translateX(-50%);
            color: #888;
            font-size: 0.9rem;
            font-style: italic;
            pointer-events: none;
            z-index: 1001;
        }

        #networkLegend {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 0.6rem;
            border-radius: 5px;
            font-size: 0.8rem;
            z-index: 1000;
            max-height: 90%;
            overflow-y: auto;
            border: 1px solid #ddd;
        }

        #networkLegend div {
            margin: 5px 0;
        }

        #networkLegend span {
            display: inline-block;
            width: 15px;
            height: 15px;
            margin-right: 5px;
            vertical-align: middle;
            border: 1px solid #ccc;
        }

        /* ===== ESTILOS PARA LA TABLA DE VAVE ===== */
        .vave-table-wrapper {
            overflow-x: auto;
            width: 100%;
            -webkit-overflow-scrolling: touch;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-top: 1.25rem;
        }

        .vave-table {
            border-collapse: collapse;
            width: 100%;
            min-width: 1000px;
            background: white;
        }

        .vave-table th,
        .vave-table td {
            border: 1px solid #ddd;
            padding: 0.75rem;
            text-align: left;
            vertical-align: top;
            white-space: normal;
        }

        .vave-table th {
            background-color: #2c3e50;
            color: white;
            font-weight: 600;
        }

        .vave-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .vave-table input[type="number"] {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ccc;
            border-radius: 3px;
            font-size: 0.9rem;
        }

        .value-index-high {
            background-color: #d4edda !important;
            font-weight: bold;
            color: #155724;
        }

        .value-index-medium {
            background-color: #fff3cd !important;
            font-weight: bold;
            color: #856404;
        }

        .value-index-low {
            background-color: #f8d7da !important;
            font-weight: bold;
            color: #721c24;
        }

        .tab-nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid #eee;
            width: 100%;
            box-sizing: border-box;
        }

        .btn-next-tab {
            background-color: #3498db;
            color: white;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.7rem 1.25rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            font-family: 'Nunito', sans-serif;
            transition: background-color 0.3s, transform 0.2s;
        }

        .btn-next-tab:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }

        .btn-next-tab.btn-prev {
            background-color: #95a5a6;
        }

        .btn-next-tab.btn-prev:hover {
            background-color: #7f8c8d;
        }

        .btn-next-tab.btn-success {
            background-color: #27ae60;
        }

        .btn-next-tab.btn-success:hover {
            background-color: #229954;
        }

        .btn-next-tab.btn-purple {
            background-color: #9013fe;
        }

        .btn-next-tab.btn-purple:hover {
            background-color: #7a0fd8;
        }

        .example-btn {
            background-color: #27ae60;
        }

        .example-btn:hover {
            background-color: #229954;
        }

        .infographic-flow {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1.5rem;
            text-align: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .flow-step {
            flex: 1;
            min-width: 150px;
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f8f9fa;
            margin: 5px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .flow-step:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }

        .flow-step .fas {
            font-size: 1.8rem;
            color: #2c3e50;
            margin-bottom: 0.6rem;
        }

        .flow-step strong {
            display: block;
            font-size: 1.1rem;
            color: #2c3e50;
            font-weight: 600;
        }

        .flow-arrow {
            font-size: 2rem;
            color: #3498db;
            margin: 0 0.6rem;
        }

        /* Estilo para el icono en el header */
        .header-icon-vave {
            background-color: #9013fe;
            color: white;
            padding: 5px 8px;
            border-radius: 6px;
            margin-right: 10px;
            font-size: 1.2em;
        }

        /* Botones de acción globales */
        .global-action-buttons {
            text-align: center;
            margin: 1.5rem auto;
            padding: 0 1.25rem;
            max-width: 1200px;
        }

        /* Ajustes responsivos */
        @media (max-width: 992px) {
            .panels-container {
                flex-direction: column;
            }

            .structure-panel {
                width: 100%;
            }
        }

        @media (max-width: 768px) {
            .tab-content-wrapper {
                padding: 1rem;
            }

            .tab-btn {
                padding: 0.75rem 0.5rem;
                font-size: 0.9rem;
            }

            .infographic-flow {
                flex-direction: column;
                align-items: stretch;
            }

            .flow-arrow {
                transform: rotate(90deg);
                margin: 1rem 0;
            }
        }

        @media (max-width: 480px) {
            .tab-content-wrapper {
                padding: 0.75rem;
            }

            .tab-btn {
                padding: 0.6rem 0.3rem;
                font-size: 0.8rem;
            }
        }
    </style>
</head>

<body>

    <!-- Contenedor donde se cargará el header dinámicamente -->
    <div id="header-container"></div>

    <noscript>
        <nav>
            <a href="/">Home</a> |
            <a href="/8d">8D Tool</a> |
            <a href="/taguchi_doe">Taguchi DOE</a> |
            <a href="/swot">SWOT Analysis</a> |
            <a href="/balancedcard">Balanced Scorecard</a> |
            <a href="/qfd">QFD</a> |
            <a href="/apqp-ppap">APQP/PPAP</a> |
            <a href="/ishikawa">Ishikawa</a> |
            <a href="/fmea">FMEA</a> |
            <a href="/vave">VAVE</a> |
            <a href="/eisenhower">Eisenhower Matrix</a> |
            <a href="/triz">TRIZ</a> |
            <a href="/weibull">Weibull</a> |
            <a href="/stack_up_analysis">Tolerance Stack-Up</a> |
            <a href="/pdca">PDCA</a> |
            <a href="/design_thinking">Design Thinking</a> |
            <a href="/pugh">Pugh Matrix</a> |
            <a href="/cpk_calculator">CpK Calculator</a> |
            <a href="/control-plan">Control Plan</a>
        </nav>
    </noscript>

    <main class="main-content-wrapper">
        <header class="main-header">
            <h1>
                <i class="fas fa-cogs header-icon-vave"></i>
                Free Online Value Analysis / Value Engineering (VAVE) Tool
            </h1>
            <p>A Systematic Method for Improving Product Value</p>
        </header>

        <!-- Botones de acción globales -->
        <div class="global-action-buttons">
            <button id="loadExampleBtn" class="example-btn"><i class="fas fa-lightbulb"></i> Load Example</button>
            <button id="resetAllBtn" style="background-color: #f39c12;"><i class="fas fa-redo"></i> Reset All</button>
        </div>

        <!-- CONTENEDOR DE TABS CON FONDO BLANCO -->
        <div class="tabs-container">
            <!-- NAVEGACIÓN DE PESTAÑAS (WIZARD) -->
            <nav class="tabs-nav">
                <button class="tab-btn active" onclick="switchWizardTab('tab-theory')">
                    <i class="fas fa-book"></i> Theory & Info
                </button>
                <button class="tab-btn" onclick="switchWizardTab('tab-structure')">
                    <i class="fas fa-cogs"></i> Define Structure
                </button>
                <button class="tab-btn" onclick="switchWizardTab('tab-visualize')">
                    <i class="fas fa-project-diagram"></i> Visualize
                </button>
                <button class="tab-btn" onclick="switchWizardTab('tab-vave-analysis')">
                    <i class="fas fa-calculator"></i> VAVE Analysis
                </button>
            </nav>

            <!-- PESTAÑA 1: TEORÍA -->
            <div id="tab-theory" class="wizard-tab-content active">
                <div class="tab-content-wrapper">
                    <div class="container">
                        <h2><i class="fas fa-question-circle"></i> What is VAVE?</h2>
                        <p><strong>Value Analysis and Value Engineering (VAVE)</strong> is a powerful, systematic
                            methodology used
                            to analyze and improve the value of products, projects, or services. "Value" is defined by
                            the ratio of
                            function to cost. The goal is to achieve the required functions at the lowest possible
                            lifecycle cost
                            without compromising quality, reliability, or customer satisfaction.</p>
                        <p>The core principle is expressed in the value equation: <strong>Value = Function /
                                Cost</strong></p>
                        <ul>
                            <li><strong>Value Analysis (VA):</strong> Typically applied to <em>existing</em> products to
                                reduce
                                their cost or improve their function. It's a reactive approach to enhance value.</li>
                            <li><strong>Value Engineering (VE):</strong> Applied during the <em>design and development
                                    phase</em> of
                                a new product. It's a proactive approach to build value in from the start.</li>
                        </ul>
                        <p>VAVE combines both approaches into a unified process for continuous value improvement.</p>
                        <div class="infographic-flow">
                            <div class="flow-step"><i class="fas fa-list-ul"></i><strong>1. Identify
                                    Functions</strong><span>What
                                    does it do?</span></div>
                            <div class="flow-arrow"><i class="fas fa-long-arrow-alt-right"></i></div>
                            <div class="flow-step"><i class="fas fa-cube"></i><strong>2. Define
                                    Structure</strong><span>Components & Contacts</span></div>
                            <div class="flow-arrow"><i class="fas fa-long-arrow-alt-right"></i></div>
                            <div class="flow-step"><i class="fas fa-project-diagram"></i><strong>3. Visualize
                                    System</strong><span>Network Diagram</span></div>
                            <div class="flow-arrow"><i class="fas fa-long-arrow-alt-right"></i></div>
                            <div class="flow-step"><i class="fas fa-balance-scale"></i><strong>4. Analyze
                                    Value</strong><span>Cost vs. Function</span></div>
                        </div>
                    </div>

                    <div class="container">
                        <h2><i class="fas fa-history"></i> Brief History & Purpose</h2>
                        <p>The concept of Value Analysis was pioneered by <strong>Lawrence D. Miles</strong> at General
                            Electric
                            (GE) during World War II. Faced with material shortages, Miles developed a systematic
                            approach to find
                            less expensive substitute materials and designs without sacrificing the function of a
                            product. The
                            success of this method led to its formalization and widespread adoption after the war. Value
                            Engineering
                            evolved from this, applying the same principles proactively during the design phase.</p>
                        <p>The primary purpose of VAVE is to eliminate unnecessary costs while ensuring or improving
                            function and
                            quality, thereby maximizing the value delivered to the customer and the organization.</p>
                    </div>

                    <div class="container">
                        <h2><i class="fas fa-tools"></i> How to Use This Tool</h2>
                        <div class="instructions-box">
                            <ol>
                                <li><strong>Define Structure:</strong> In the "Define Structure" tab:
                                    <ul>
                                        <li>Add all components of your system in the "Components" panel</li>
                                        <li>Define contacts (interfaces) between components</li>
                                        <li>Define functions for each contact or component</li>
                                    </ul>
                                </li>
                                <li><strong>Visualize System:</strong> View the network diagram to understand your
                                    system structure</li>
                                <li><strong>VAVE Analysis:</strong> Assign costs and value scores to each function and
                                    calculate value index</li>
                                <li><strong>Optimize:</strong> Identify low-value functions for cost reduction or
                                    functional improvement</li>
                            </ol>
                        </div>
                    </div>

                    <div class="tab-nav-buttons">
                        <button class="btn-next-tab btn-purple" onclick="switchWizardTab('tab-structure')">Go to Define
                            Structure <i class="fas fa-arrow-right"></i></button>
                    </div>
                </div>
            </div>

            <!-- PESTAÑA 2: DEFINIR ESTRUCTURA -->
            <div id="tab-structure" class="wizard-tab-content">
                <div class="tab-content-wrapper">
                    <div class="panels-container">
                        <div id="componentsPanel" class="structure-panel">
                            <div class="calculation-title">Components</div>
                            <div class="form-group">
                                <label for="componentName"><i class="fas fa-cube"></i> Component Name:</label>
                                <input type="text" id="componentName" placeholder="Enter component name">
                                <label>
                                    <input type="checkbox" id="componentExternal"
                                        style="width: auto; margin-right: 5px;"> External Component
                                </label>
                                <button id="addComponentBtn"><i class="fas fa-plus"></i> Add Component</button>
                                <button id="clearComponentsBtn"><i class="fas fa-trash"></i> Clear All</button>
                            </div>
                            <div class="item-list" id="componentsList"></div>
                        </div>

                        <div id="contactsPanel" class="structure-panel">
                            <div class="calculation-title">Contacts</div>
                            <div class="form-group">
                                <label for="contactFrom"><i class="fas fa-arrow-right"></i> From Component:</label>
                                <select id="contactFrom" disabled>
                                    <option value="">Select component</option>
                                </select>
                                <label for="contactTo"><i class="fas fa-arrow-left"></i> To Component:</label>
                                <select id="contactTo" disabled>
                                    <option value="">Select component</option>
                                </select>
                                <button id="addContactBtn" disabled><i class="fas fa-plus"></i> Add Contact</button>
                                <button id="clearContactsBtn" disabled><i class="fas fa-trash"></i> Clear All</button>
                            </div>
                            <div class="item-list" id="contactsList"></div>
                        </div>

                        <div id="functionsPanel" class="structure-panel">
                            <div class="calculation-title">Functions</div>
                            <div class="form-group">
                                <label for="functionName"><i class="fas fa-bolt"></i> Function Name:</label>
                                <input type="text" id="functionName" placeholder="Enter function name">
                                <label for="functionType">Function Type:</label>
                                <select id="functionType">
                                    <option value="primary">Primary</option>
                                    <option value="secondary">Secondary</option>
                                </select>
                                <label for="functionContacts"><i class="fas fa-link"></i> Contacts:</label>
                                <select id="functionContacts" multiple disabled>
                                </select>
                                <button id="addFunctionBtn" disabled><i class="fas fa-plus"></i> Add Function</button>
                                <button id="clearFunctionsBtn" disabled><i class="fas fa-trash"></i> Clear All</button>
                            </div>
                            <div class="item-list" id="functionsList"></div>
                        </div>
                    </div>

                    <div class="tab-nav-buttons">
                        <button class="btn-next-tab btn-prev" onclick="switchWizardTab('tab-theory')"><i
                                class="fas fa-arrow-left"></i> Back to Theory</button>
                        <button class="btn-next-tab btn-purple" onclick="switchWizardTab('tab-visualize')">Go to
                            Visualize <i class="fas fa-arrow-right"></i></button>
                    </div>
                </div>
            </div>

            <!-- PESTAÑA 3: VISUALIZAR -->
            <div id="tab-visualize" class="wizard-tab-content">
                <div class="tab-content-wrapper">
                    <div id="network-wrapper">
                        <img id="networkIcon" src="sigma-exacta-icon.jpg" alt="Sigma Exacta Inverted Logo">
                        <button id="exportChartBtn" title="Export Chart as JPG"><i class="fas fa-camera"></i></button>
                        <button id="fitViewBtn" title="Fit to View"><i class="fas fa-compress-arrows-alt"></i></button>
                        <div id="networkChart">
                            <div id="network-instruction">Drag nodes to rearrange the layout</div>
                            <div id="networkCanvas" style="width: 100%; height: 100%;"></div>
                            <div id="networkLegend"></div>
                        </div>
                    </div>

                    <div class="tab-nav-buttons">
                        <button class="btn-next-tab btn-prev" onclick="switchWizardTab('tab-structure')"><i
                                class="fas fa-arrow-left"></i> Back to Define Structure</button>
                        <button class="btn-next-tab btn-purple" onclick="switchWizardTab('tab-vave-analysis')">Go to
                            VAVE Analysis <i class="fas fa-arrow-right"></i></button>
                    </div>
                </div>
            </div>

            <!-- PESTAÑA 4: VAVE ANALYSIS -->
            <div id="tab-vave-analysis" class="wizard-tab-content">
                <div class="tab-content-wrapper">
                    <div class="calculation-block">
                        <div class="calculation-title">VAVE Analysis Tool</div>

                        <!-- Botón Generate VAVE Analysis -->
                        <div style="text-align: center; margin-bottom: 1.5rem;">
                            <button id="generateVAVEValuesBtn"><i class="fas fa-calculator"></i> Generate VAVE
                                Analysis</button>
                        </div>

                        <div class="calculation-block">
                            <h3><i class="fas fa-info-circle"></i> Instructions</h3>
                            <p>For each function identified in your system, assign:</p>
                            <ul>
                                <li><strong>Cost ($):</strong> The estimated cost associated with this function</li>
                                <li><strong>Value Score (1-10):</strong> How important this function is to the
                                    customer/system (1=least, 10=most)</li>
                                <li><strong>Value Index = Value Score / Cost</strong> (Higher is better)</li>
                            </ul>
                            <p>Functions with <span class="value-index-low" style="padding: 2px 5px;">low value
                                    index</span> are candidates for cost reduction or functional improvement.</p>
                        </div>

                        <div id="vaveTableContainer">
                            <p style="color: #7f8c8d; text-align: center; padding: 2rem;">
                                <i class="fas fa-info-circle"
                                    style="font-size: 2rem; margin-bottom: 1rem; display: block;"></i>
                                Click "Generate VAVE Analysis" above to start analyzing your functions.
                            </p>
                        </div>

                        <div id="vaveResults" style="display: none;">
                            <h3><i class="fas fa-chart-line"></i> Value Analysis Results</h3>
                            <div class="vave-table-wrapper">
                                <table id="vaveResultsTable" class="vave-table">
                                    <thead>
                                        <tr>
                                            <th>Function</th>
                                            <th>Type</th>
                                            <th>Description</th>
                                            <th>Cost ($)</th>
                                            <th>Value Score (1-10)</th>
                                            <th>Value Index</th>
                                            <th>Priority</th>
                                            <th>Recommendation</th>
                                        </tr>
                                    </thead>
                                    <tbody id="vaveResultsBody">
                                    </tbody>
                                </table>
                            </div>

                            <div
                                style="margin-top: 2rem; padding: 1rem; background-color: #f8f9fa; border-radius: 8px;">
                                <h4><i class="fas fa-chart-pie"></i> Summary</h4>
                                <p><strong>Total Cost:</strong> $<span id="totalCostValue">0.00</span></p>
                                <p><strong>Average Value Index:</strong> <span id="averageValueIndex">0.00</span></p>
                                <p><strong>Functions with Low Value Index (&lt; 0.1):</strong> <span
                                        id="lowValueCount">0</span></p>
                                <p><strong>Functions with High Value Index (&gt; 0.25):</strong> <span
                                        id="highValueCount">0</span></p>
                            </div>

                            <div class="matrix-actions" style="margin-top: 2rem;">
                                <button id="exportVAVEToExcelBtn" disabled><i class="fas fa-file-excel"></i> Export to
                                    Excel</button>
                                <button onclick="switchWizardTab('tab-visualize')" style="background-color: #6c757d;"><i
                                        class="fas fa-edit"></i> Edit Structure</button>
                            </div>
                        </div>
                    </div>

                    <div class="tab-nav-buttons">
                        <button class="btn-next-tab btn-prev" onclick="switchWizardTab('tab-visualize')"><i
                                class="fas fa-arrow-left"></i> Back to Visualize</button>
                        <button class="btn-next-tab" onclick="switchWizardTab('tab-theory')">Back to Theory <i
                                class="fas fa-book"></i></button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer role="contentinfo">
        <div class="disclaimer-note">
            <p><strong>Disclaimer:</strong> The tools and information provided on Sigma Exacta are for informational and
                educational purposes only. This tool is based on the Value Analysis / Value Engineering (VAVE)
                methodology, pioneered by Lawrence D. Miles. The tools on this site are independent implementations and
                are not affiliated with, sponsored by, or endorsed by the original creators or any specific institution.
                While we strive for accuracy, we make no warranty or guarantee regarding the results. All decisions
                related to product design, cost reduction, or value improvement based on the output of this tool are the
                sole responsibility of the user. Sigma Exacta and its creators are not liable for any damages or losses
                resulting from the use of this website.</p>
        </div>
    </footer>

    <script>
        // ============================================
        // FUNCIONES GLOBALES PARA LAS TABS
        // ============================================

        // Variables globales (similares a FMEA)
        let components = [];
        let contacts = [];
        let functions = [];
        let network = null;
        let contactCounter = 0;
        let primaryFunctionCounter = 0;
        let secondaryFunctionCounter = 0;

        const functionColors = ['#e74c3c', '#3498db', '#2ecc71', '#f1c40f', '#9b59b6', '#1abc9c', '#e67e22', '#34495e', '#d35400', '#27ae60'];

        // Función para cambiar entre tabs
        function switchWizardTab(tabId) {
            // Quitar clase active de todos los botones y contenidos de wizard
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.wizard-tab-content').forEach(content => content.classList.remove('active'));

            // Activar el contenido seleccionado
            document.getElementById(tabId).classList.add('active');

            // Activar botón correspondiente
            const activeBtn = document.querySelector(`button[onclick="switchWizardTab('${tabId}')"]`);
            if (activeBtn) activeBtn.classList.add('active');

            // Scroll al top suavemente
            window.scrollTo({ top: 0, behavior: 'smooth' });

            // Si vamos a la pestaña de visualize, ajustar el gráfico
            if (tabId === 'tab-visualize' && network) {
                setTimeout(() => {
                    network.fit({ animation: true });
                }, 100);
            }
        }

        // ============================================
        // CÓDIGO PRINCIPAL CUANDO EL DOM ESTÁ LISTO
        // ============================================
        document.addEventListener('DOMContentLoaded', function () {
            // Cargar el header desde header.html
            fetch('header.html')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.text();
                })
                .then(data => {
                    document.getElementById('header-container').innerHTML = data;
                    // Inicializar el menú después de cargar el header
                    initMenu();
                })
                .catch(error => {
                    console.error('Error loading header:', error);
                });

            // Inicializar la herramienta VAVE
            initVAVE();
        });

        // Inicializar la lógica de VAVE
        function initVAVE() {
            // Referencias a elementos DOM
            const componentsList = document.getElementById('componentsList');
            const contactsList = document.getElementById('contactsList');
            const functionsList = document.getElementById('functionsList');
            const contactFromSelect = document.getElementById('contactFrom');
            const contactToSelect = document.getElementById('contactTo');
            const functionContactsSelect = document.getElementById('functionContacts');

            // Event listeners para botones globales
            document.getElementById('loadExampleBtn').addEventListener('click', loadExample);
            document.getElementById('resetAllBtn').addEventListener('click', resetAll);

            // Event listeners para botones de estructura
            document.getElementById('addComponentBtn').addEventListener('click', addComponent);
            document.getElementById('addContactBtn').addEventListener('click', addContact);
            document.getElementById('addFunctionBtn').addEventListener('click', addFunction);
            document.getElementById('generateVAVEValuesBtn').addEventListener('click', generateVAVEAnalysis);
            document.getElementById('exportChartBtn').addEventListener('click', exportChart);
            document.getElementById('clearComponentsBtn').addEventListener('click', resetAll);
            document.getElementById('clearContactsBtn').addEventListener('click', () => {
                contacts = [];
                functions = [];
                contactCounter = 0;
                primaryFunctionCounter = 0;
                secondaryFunctionCounter = 0;
                updateAll();
            });
            document.getElementById('clearFunctionsBtn').addEventListener('click', () => {
                functions = [];
                primaryFunctionCounter = 0;
                secondaryFunctionCounter = 0;
                updateAll();
            });
            document.getElementById('fitViewBtn').addEventListener('click', () => { if (network) network.fit({ animation: true }); });
            document.getElementById('exportVAVEToExcelBtn').addEventListener('click', exportVAVEToExcel);

            updateAll();

            // Función para agregar componente
            function addComponent() {
                const name = document.getElementById('componentName').value.trim();
                if (name) {
                    const isExternal = document.getElementById('componentExternal').checked;
                    const newId = components.length > 0 ? Math.max(...components.map(c => c.id)) + 1 : 1;
                    components.push({ id: newId, name, external: isExternal });
                    document.getElementById('componentName').value = '';
                    document.getElementById('componentExternal').checked = false;
                    updateAll();
                }
            }

            // Función para agregar contacto
            function addContact() {
                const fromId = parseInt(contactFromSelect.value);
                const toId = parseInt(contactToSelect.value);
                if (fromId && toId && fromId !== toId) {
                    contactCounter++;
                    const newId = contacts.length > 0 ? Math.max(...contacts.map(c => c.id)) + 1 : 1;
                    contacts.push({ id: newId, from: fromId, to: toId, name: `c${contactCounter}` });
                    updateAll();
                }
            }

            // Función para agregar función
            function addFunction() {
                const name = document.getElementById('functionName').value.trim();
                const type = document.getElementById('functionType').value;
                const selectedContacts = Array.from(functionContactsSelect.selectedOptions).map(option => parseInt(option.value));
                if (name && selectedContacts.length > 0) {
                    const newId = functions.length > 0 ? Math.max(...functions.map(f => f.id)) + 1 : 1;
                    let funcLabel = '';
                    if (type === 'primary') {
                        primaryFunctionCounter++;
                        funcLabel = `fp${primaryFunctionCounter}`;
                    } else {
                        secondaryFunctionCounter++;
                        funcLabel = `fs${secondaryFunctionCounter}`;
                    }
                    functions.push({
                        id: newId,
                        name,
                        type,
                        contacts: selectedContacts,
                        label: funcLabel,
                        cost: 0,
                        valueScore: 5
                    });
                    document.getElementById('functionName').value = '';
                    updateAll();
                }
            }

            // Función para actualizar lista de componentes
            function updateComponentsList() {
                componentsList.innerHTML = '';
                components.forEach(component => {
                    const item = document.createElement('div');
                    item.className = 'item';
                    item.innerHTML = `
                    <div class="item-name">${component.name} ${component.external ? '(External)' : ''}</div>
                    <div class="item-actions"><button class="delete-btn" title="Delete"><i class="fas fa-trash"></i></button></div>`;
                    item.querySelector('.delete-btn').addEventListener('click', () => {
                        contacts = contacts.filter(c => c.from !== component.id && c.to !== component.id);
                        const contactIds = contacts.map(c => c.id);
                        functions = functions.filter(f => f.contacts.every(cId => contactIds.includes(cId)));
                        components = components.filter(c => c.id !== component.id);
                        updateAll();
                    });
                    componentsList.appendChild(item);
                });
                document.getElementById('addContactBtn').disabled = components.length < 2;
            }

            // Función para actualizar lista de contactos
            function updateContactsList() {
                contactsList.innerHTML = '';
                contacts.forEach(contact => {
                    const from = components.find(c => c.id === contact.from);
                    const to = components.find(c => c.id === contact.to);
                    if (from && to) {
                        const item = document.createElement('div');
                        item.className = 'item';
                        item.innerHTML = `
                        <div class="item-name"><strong>${contact.name}:</strong> ${from.name} → ${to.name}</div>
                        <div class="item-actions"><button class="delete-btn" title="Delete"><i class="fas fa-trash"></i></button></div>`;
                        item.querySelector('.delete-btn').addEventListener('click', () => {
                            functions.forEach(f => { f.contacts = f.contacts.filter(id => id !== contact.id); });
                            functions = functions.filter(f => f.contacts.length > 0);
                            contacts = contacts.filter(c => c.id !== contact.id);
                            updateAll();
                        });
                        contactsList.appendChild(item);
                    }
                });
                document.getElementById('clearContactsBtn').disabled = contacts.length === 0;
            }

            // Función para actualizar lista de funciones
            function updateFunctionsList() {
                functionsList.innerHTML = '';
                functions.forEach(func => {
                    const item = document.createElement('div');
                    item.className = 'item function-item';
                    item.style.borderLeftColor = getFunctionColor(func.id);
                    const funcContacts = contacts.filter(c => func.contacts.includes(c.id));
                    const contactNames = funcContacts.map(c => c.name).join(', ');
                    item.innerHTML = `
                    <div class="item-name"><strong>${func.label}:</strong> ${func.name} (${func.type})<br><small>Contacts: ${contactNames}</small></div>
                    <div class="item-actions"><button class="delete-btn" title="Delete"><i class="fas fa-trash"></i></button></div>`;
                    item.querySelector('.delete-btn').addEventListener('click', () => {
                        functions = functions.filter(f => f.id !== func.id);
                        updateAll();
                    });
                    functionsList.appendChild(item);
                });
                document.getElementById('addFunctionBtn').disabled = contacts.length === 0;
                document.getElementById('clearFunctionsBtn').disabled = functions.length === 0;
            }

            // Función para actualizar todo
            function updateAll() {
                updateComponentsList();
                updateContactsList();
                updateFunctionsList();
                updateSelectOptions();
                updateNetworkVisualization();
            }

            // Función para actualizar opciones de select
            function updateSelectOptions() {
                contactFromSelect.innerHTML = '<option value="">Select component</option>';
                contactToSelect.innerHTML = '<option value="">Select component</option>';
                components.forEach(c => {
                    contactFromSelect.appendChild(new Option(c.name, c.id));
                    contactToSelect.appendChild(new Option(c.name, c.id));
                });
                contactFromSelect.disabled = components.length < 2;
                contactToSelect.disabled = components.length < 2;

                functionContactsSelect.innerHTML = '';
                contacts.forEach(contact => {
                    const from = components.find(c => c.id === contact.from);
                    const to = components.find(c => c.id === contact.to);
                    if (from && to) {
                        functionContactsSelect.appendChild(new Option(`${contact.name}: ${from.name} → ${to.name}`, contact.id));
                    }
                });
                functionContactsSelect.disabled = contacts.length === 0;
            }

            // Función para obtener color de función
            function getFunctionColor(id) {
                return functionColors[(id - 1) % functionColors.length];
            }

            // Función para cargar ejemplo
            function loadExample() {
                resetAll();
                components = [
                    { id: 1, name: 'Motor', external: false },
                    { id: 2, name: 'Gearbox', external: false },
                    { id: 3, name: 'Controller', external: false },
                    { id: 4, name: 'Power Supply', external: true },
                    { id: 5, name: 'Sensor', external: false },
                    { id: 6, name: 'Actuator', external: false },
                    { id: 7, name: 'Display Unit', external: false },
                    { id: 8, name: 'User Interface', external: true }
                ];
                contactCounter = 8;
                contacts = [
                    { id: 1, from: 1, to: 2, name: 'c1' },
                    { id: 2, from: 3, to: 1, name: 'c2' },
                    { id: 3, from: 4, to: 3, name: 'c3' },
                    { id: 4, from: 5, to: 3, name: 'c4' },
                    { id: 5, from: 3, to: 6, name: 'c5' },
                    { id: 6, from: 3, to: 7, name: 'c6' },
                    { id: 7, from: 8, to: 3, name: 'c7' },
                    { id: 8, from: 2, to: 6, name: 'c8' }
                ];
                primaryFunctionCounter = 3;
                secondaryFunctionCounter = 1;
                functions = [
                    {
                        id: 1,
                        name: 'Transmit Power',
                        type: 'primary',
                        label: 'fp1',
                        contacts: [1, 8],
                        cost: 150,
                        valueScore: 9
                    },
                    {
                        id: 2,
                        name: 'Control Speed',
                        type: 'primary',
                        label: 'fp2',
                        contacts: [2, 3, 4],
                        cost: 200,
                        valueScore: 8
                    },
                    {
                        id: 3,
                        name: 'Provide System Status',
                        type: 'secondary',
                        label: 'fs1',
                        contacts: [6, 7],
                        cost: 75,
                        valueScore: 5
                    },
                    {
                        id: 4,
                        name: 'Execute Commands',
                        type: 'primary',
                        label: 'fp3',
                        contacts: [5, 7],
                        cost: 120,
                        valueScore: 7
                    }
                ];
                updateAll();
            }

            // Función para resetear todo
            function resetAll() {
                components = [];
                contacts = [];
                functions = [];
                contactCounter = 0;
                primaryFunctionCounter = 0;
                secondaryFunctionCounter = 0;

                // Limpiar resultados VAVE
                const vaveTableContainer = document.getElementById('vaveTableContainer');
                const vaveResults = document.getElementById('vaveResults');
                if (vaveTableContainer) {
                    vaveTableContainer.innerHTML = '<p style="color: #7f8c8d; text-align: center; padding: 2rem;"><i class="fas fa-info-circle" style="font-size: 2rem; margin-bottom: 1rem; display: block;"></i>Click "Generate VAVE Analysis" above to start analyzing your functions.</p>';
                }
                if (vaveResults) {
                    vaveResults.style.display = 'none';
                }

                if (network) {
                    network.destroy();
                    network = null;
                }
                updateAll();

                const networkLegend = document.getElementById('networkLegend');
                if (networkLegend) networkLegend.innerHTML = '';
            }

            // Función para generar el diagrama de red
            function updateNetworkVisualization() {
                const container = document.getElementById('networkCanvas');
                if (network) {
                    network.destroy();
                }

                if (components.length === 0) {
                    container.innerHTML = '<div style="display: flex; justify-content: center; align-items: center; height: 100%; color: #888; font-style: italic;">Add components to visualize the system structure</div>';
                    return;
                }

                const INTERNAL_Y_SPACING = 150;
                const INTERNAL_X_SPACING = 250;
                const EXTERNAL_Y_OFFSET = 200;

                const nodesData = [];
                const internalComponents = components.filter(c => !c.external);
                const externalComponents = components.filter(c => c.external);

                let internal_y_start = 0;
                internalComponents.forEach((component, i) => {
                    const x = (i % 2 === 0) ? -INTERNAL_X_SPACING / 2 : INTERNAL_X_SPACING / 2;
                    const y = internal_y_start + Math.floor(i / 2) * INTERNAL_Y_SPACING;
                    nodesData.push({ ...component, x, y, fixed: false });
                });

                const numInternalRows = Math.ceil(internalComponents.length / 2);
                const internalZoneHeight = (numInternalRows - 1) * INTERNAL_Y_SPACING;

                const external_top_y = internal_y_start - EXTERNAL_Y_OFFSET;
                const external_bottom_y = internal_y_start + internalZoneHeight + EXTERNAL_Y_OFFSET;

                const topExternals = externalComponents.slice(0, Math.ceil(externalComponents.length / 2));
                const bottomExternals = externalComponents.slice(Math.ceil(externalComponents.length / 2));

                topExternals.forEach((component, i) => {
                    const x = (topExternals.length - 1) * -100 + i * 200;
                    nodesData.push({ ...component, x, y: external_top_y, fixed: false });
                });

                bottomExternals.forEach((component, i) => {
                    const x = (bottomExternals.length - 1) * -100 + i * 200;
                    nodesData.push({ ...component, x, y: external_bottom_y, fixed: false });
                });

                const visNodes = nodesData.map(c => {
                    let nodeColor, nodeFont, nodeShape;
                    const baseFont = { size: 28, face: 'Nunito, sans-serif' };

                    if (c.external) {
                        nodeColor = { border: '#2c3e50', background: '#ecf0f1' };
                        nodeFont = { ...baseFont, color: '#2c3e50', weight: '600' };
                        nodeShape = 'box';
                    } else {
                        nodeColor = { border: '#2c3e50', background: '#3498db' };
                        nodeFont = { ...baseFont, color: '#ffffff', weight: '600' };
                        nodeShape = 'box';
                    }
                    return {
                        id: c.id, label: c.name, x: c.x, y: c.y, fixed: c.fixed,
                        color: nodeColor, font: nodeFont, shape: nodeShape, margin: 10
                    };
                });

                const edgesData = [];

                contacts.forEach(contact => {
                    edgesData.push({
                        id: `c-${contact.id}`, from: contact.from, to: contact.to,
                        color: '#333333',
                        width: 1.5,
                        smooth: { enabled: false }
                    });
                });

                functions.forEach(func => {
                    const funcColor = getFunctionColor(func.id);
                    func.contacts.forEach(contactId => {
                        const underlyingContact = contacts.find(c => c.id === contactId);
                        if (underlyingContact) {
                            edgesData.push({
                                id: `f-${func.id}-${contactId}`, from: underlyingContact.from, to: underlyingContact.to,
                                label: func.label,
                                color: { color: funcColor, highlight: funcColor },
                                arrows: { to: { enabled: true, scaleFactor: 0.7 } },
                                width: 3,
                                font: { size: 36, face: 'Nunito, sans-serif', color: funcColor, strokeWidth: 5, strokeColor: 'white', weight: '800' },
                                smooth: { enabled: true, type: 'curvedCW', roundness: 0.2 + (func.id * 0.05) }
                            });
                        }
                    });
                });

                const data = { nodes: new vis.DataSet(visNodes), edges: new vis.DataSet(edgesData) };

                const options = {
                    layout: { hierarchical: false },
                    physics: { enabled: false },
                    nodes: { borderWidth: 2, shadow: true },
                    edges: { shadow: true },
                    interaction: { hover: true, tooltipDelay: 200, dragNodes: true },
                };

                network = new vis.Network(container, data, options);

                const lineTopY = internal_y_start - (INTERNAL_Y_SPACING / 2);
                const lineBottomY = internal_y_start + internalZoneHeight + (INTERNAL_Y_SPACING / 2);

                network.on('afterDrawing', function (ctx) {
                    ctx.save();
                    ctx.strokeStyle = '#95a5a6';
                    ctx.lineWidth = 2;
                    ctx.setLineDash([5, 10]);
                    const x_start = -10000;
                    const x_end = 10000;
                    ctx.beginPath();
                    ctx.moveTo(x_start, lineTopY);
                    ctx.lineTo(x_end, lineTopY);
                    ctx.stroke();
                    ctx.beginPath();
                    ctx.moveTo(x_start, lineBottomY);
                    ctx.lineTo(x_end, lineBottomY);
                    ctx.stroke();
                    ctx.restore();
                });

                network.fit({ animation: { duration: 500, easingFunction: 'easeInOutQuad' } });

                let legendHtml = '<div><strong>Function Legend:</strong></div>';
                if (functions.length > 0) {
                    functions.forEach(func => {
                        const color = getFunctionColor(func.id);
                        legendHtml += `<div><span style="background-color: ${color};"></span>${func.label}: ${func.name}</div>`;
                    });
                } else {
                    legendHtml += '<div>No functions defined.</div>';
                }
                const networkLegend = document.getElementById('networkLegend');
                if (networkLegend) networkLegend.innerHTML = legendHtml;
            }

            // Función para generar análisis VAVE
            function generateVAVEAnalysis() {
                if (functions.length === 0) {
                    alert('Please define functions first in the "Define Structure" tab.');
                    return;
                }

                const vaveTableContainer = document.getElementById('vaveTableContainer');
                const vaveResults = document.getElementById('vaveResults');

                // Crear la tabla de análisis VAVE
                let tableHTML = `
                    <div class="vave-table-wrapper">
                        <table id="vaveAnalysisTable" class="vave-table">
                            <thead>
                                <tr>
                                    <th>Function ID</th>
                                    <th>Function Name</th>
                                    <th>Type</th>
                                    <th>Contacts</th>
                                    <th>Cost ($)</th>
                                    <th>Value Score (1-10)</th>
                                    <th>Value Index</th>
                                    <th>Priority</th>
                                </tr>
                            </thead>
                            <tbody>`;

                functions.forEach(func => {
                    const funcContacts = contacts.filter(c => func.contacts.includes(c.id));
                    const contactNames = funcContacts.map(c => c.name).join(', ');

                    // Calcular valor inicial si no existe
                    if (func.cost === undefined) func.cost = 0;
                    if (func.valueScore === undefined) func.valueScore = 5;

                    const valueIndex = func.cost > 0 ? (func.valueScore / func.cost).toFixed(4) : "N/A";
                    const valueIndexNum = parseFloat(valueIndex) || 0;

                    let priorityClass = '';
                    let priorityText = '';

                    if (valueIndexNum >= 0.25) {
                        priorityClass = 'value-index-high';
                        priorityText = 'High Value';
                    } else if (valueIndexNum >= 0.1) {
                        priorityClass = 'value-index-medium';
                        priorityText = 'Medium Value';
                    } else {
                        priorityClass = 'value-index-low';
                        priorityText = 'Low Value';
                    }

                    tableHTML += `
                        <tr>
                            <td>${func.label}</td>
                            <td>${func.name}</td>
                            <td>${func.type}</td>
                            <td>${contactNames}</td>
                            <td><input type="number" min="0" step="0.01" value="${func.cost}" class="cost-input" data-id="${func.id}" style="width: 100px;"></td>
                            <td><input type="number" min="1" max="10" step="1" value="${func.valueScore}" class="value-input" data-id="${func.id}" style="width: 100px;"></td>
                            <td class="${priorityClass}" id="value-index-${func.id}">${valueIndex}</td>
                            <td class="${priorityClass}">${priorityText}</td>
                        </tr>`;
                });

                tableHTML += `
                            </tbody>
                        </table>
                    </div>
                    <div style="margin-top: 1rem; text-align: center;">
                        <button id="calculateVAVEValuesBtn"><i class="fas fa-calculator"></i> Calculate Value Index</button>
                        <button id="listAnalysisBtn" style="background-color: #27ae60;"><i class="fas fa-list"></i> List Analysis</button>
                    </div>`;

                vaveTableContainer.innerHTML = tableHTML;
                vaveResults.style.display = 'block';

                // Event listeners para los inputs
                document.querySelectorAll('.cost-input, .value-input').forEach(input => {
                    input.addEventListener('input', updateVAVERow);
                });

                document.getElementById('calculateVAVEValuesBtn').addEventListener('click', calculateAllVAVEValues);
                document.getElementById('listAnalysisBtn').addEventListener('click', listVAVEAnalysis);

                // Calcular valores iniciales
                calculateAllVAVEValues();
            }

            // Función para actualizar una fila de VAVE
            function updateVAVERow(event) {
                const input = event.target;
                const funcId = parseInt(input.dataset.id);
                const func = functions.find(f => f.id === funcId);

                if (!func) return;

                if (input.classList.contains('cost-input')) {
                    func.cost = parseFloat(input.value) || 0;
                } else if (input.classList.contains('value-input')) {
                    func.valueScore = parseInt(input.value) || 5;
                }

                calculateVAVERow(funcId);
            }

            // Función para calcular una fila de VAVE
            function calculateVAVERow(funcId) {
                const func = functions.find(f => f.id === funcId);
                if (!func) return;

                const valueIndexCell = document.getElementById(`value-index-${funcId}`);
                const row = valueIndexCell.closest('tr');
                const priorityCell = row.querySelector('td:nth-child(8)');

                const valueIndex = func.cost > 0 ? (func.valueScore / func.cost).toFixed(4) : "N/A";
                const valueIndexNum = parseFloat(valueIndex) || 0;

                valueIndexCell.textContent = valueIndex;
                valueIndexCell.className = '';
                priorityCell.className = '';

                let priorityClass = '';
                let priorityText = '';

                if (valueIndexNum >= 0.25) {
                    priorityClass = 'value-index-high';
                    priorityText = 'High Value';
                } else if (valueIndexNum >= 0.1) {
                    priorityClass = 'value-index-medium';
                    priorityText = 'Medium Value';
                } else {
                    priorityClass = 'value-index-low';
                    priorityText = 'Low Value';
                }

                valueIndexCell.classList.add(priorityClass);
                priorityCell.classList.add(priorityClass);
                priorityCell.textContent = priorityText;
            }

            // Función para calcular todos los valores VAVE
            function calculateAllVAVEValues() {
                functions.forEach(func => {
                    calculateVAVERow(func.id);
                });

                updateVAVESummary();
            }

            // Función para actualizar el resumen VAVE
            function updateVAVESummary() {
                let totalCost = 0;
                let totalValueIndex = 0;
                let validFunctions = 0;
                let lowValueCount = 0;
                let highValueCount = 0;

                functions.forEach(func => {
                    if (func.cost > 0) {
                        totalCost += func.cost;
                        const valueIndex = func.valueScore / func.cost;
                        totalValueIndex += valueIndex;
                        validFunctions++;

                        if (valueIndex >= 0.25) {
                            highValueCount++;
                        } else if (valueIndex < 0.1) {
                            lowValueCount++;
                        }
                    }
                });

                const averageValueIndex = validFunctions > 0 ? (totalValueIndex / validFunctions).toFixed(4) : "0.0000";

                document.getElementById('totalCostValue').textContent = totalCost.toFixed(2);
                document.getElementById('averageValueIndex').textContent = averageValueIndex;
                document.getElementById('lowValueCount').textContent = lowValueCount;
                document.getElementById('highValueCount').textContent = highValueCount;

                // Habilitar botón de exportación
                document.getElementById('exportVAVEToExcelBtn').disabled = false;
            }

            // Función para listar el análisis VAVE (antes Save Analysis)
            function listVAVEAnalysis() {
                calculateAllVAVEValues();

                // Actualizar la tabla de resultados
                const resultsBody = document.getElementById('vaveResultsBody');
                resultsBody.innerHTML = '';

                functions.forEach(func => {
                    const funcContacts = contacts.filter(c => func.contacts.includes(c.id));
                    const contactNames = funcContacts.map(c => c.name).join(', ');

                    const valueIndex = func.cost > 0 ? (func.valueScore / func.cost).toFixed(4) : "N/A";
                    const valueIndexNum = parseFloat(valueIndex) || 0;

                    let priorityClass = '';
                    let priorityText = '';
                    let recommendation = '';

                    if (valueIndexNum >= 0.25) {
                        priorityClass = 'value-index-high';
                        priorityText = 'High';
                        recommendation = 'Maintain or enhance';
                    } else if (valueIndexNum >= 0.1) {
                        priorityClass = 'value-index-medium';
                        priorityText = 'Medium';
                        recommendation = 'Consider optimization';
                    } else {
                        priorityClass = 'value-index-low';
                        priorityText = 'Low';
                        recommendation = 'Investigate for cost reduction or function improvement';
                    }

                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${func.label}</td>
                        <td>${func.type}</td>
                        <td>${func.name}<br><small>Contacts: ${contactNames}</small></td>
                        <td>$${func.cost.toFixed(2)}</td>
                        <td>${func.valueScore}</td>
                        <td class="${priorityClass}">${valueIndex}</td>
                        <td class="${priorityClass}">${priorityText}</td>
                        <td>${recommendation}</td>
                    `;
                    resultsBody.appendChild(row);
                });

                alert('VAVE analysis listed successfully!');
            }

            // Función para exportar a Excel
            function exportVAVEToExcel() {
                const wb = XLSX.utils.book_new();

                // Hoja de datos VAVE
                const vaveData = functions.map(func => {
                    const funcContacts = contacts.filter(c => func.contacts.includes(c.id));
                    const contactNames = funcContacts.map(c => c.name).join(', ');
                    const valueIndex = func.cost > 0 ? (func.valueScore / func.cost).toFixed(4) : "N/A";

                    let priority = '';
                    if (parseFloat(valueIndex) >= 0.25) {
                        priority = 'High';
                    } else if (parseFloat(valueIndex) >= 0.1) {
                        priority = 'Medium';
                    } else {
                        priority = 'Low';
                    }

                    return {
                        'Function ID': func.label,
                        'Function Name': func.name,
                        'Type': func.type,
                        'Contacts': contactNames,
                        'Cost ($)': func.cost,
                        'Value Score (1-10)': func.valueScore,
                        'Value Index': valueIndex,
                        'Priority': priority
                    };
                });

                const ws = XLSX.utils.json_to_sheet(vaveData);
                ws['!cols'] = [
                    { wch: 10 }, { wch: 25 }, { wch: 10 },
                    { wch: 20 }, { wch: 10 }, { wch: 10 },
                    { wch: 12 }, { wch: 10 }
                ];
                XLSX.utils.book_append_sheet(wb, ws, "VAVE Analysis");

                // Hoja de resumen
                const summaryData = [{
                    'Total Cost': functions.reduce((sum, f) => sum + f.cost, 0),
                    'Average Value Index': functions.length > 0 ?
                        (functions.reduce((sum, f) => sum + (f.cost > 0 ? f.valueScore / f.cost : 0), 0) / functions.filter(f => f.cost > 0).length).toFixed(4) : 0,
                    'Low Value Functions (<0.1)': functions.filter(f => f.cost > 0 && f.valueScore / f.cost < 0.1).length,
                    'High Value Functions (>0.25)': functions.filter(f => f.cost > 0 && f.valueScore / f.cost >= 0.25).length
                }];

                const ws2 = XLSX.utils.json_to_sheet(summaryData);
                XLSX.utils.book_append_sheet(wb, ws2, "Summary");

                XLSX.writeFile(wb, "VAVE_Analysis_Sigma_Exacta.xlsx");
            }

            // Función para exportar el gráfico
            function exportChart() {
                const canvas = document.querySelector('#networkCanvas canvas');
                if (canvas && network) {
                    const dataURL = canvas.toDataURL('image/jpeg', 1.0);
                    const link = document.createElement('a');
                    link.href = dataURL;
                    link.download = 'vave_structure_chart.jpg';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                } else {
                    alert('The chart is not available to be exported.');
                }
            }
        }

        // Función para inicializar el menú
        function initMenu() {
            const navToggle = document.getElementById('nav-toggle');
            const navMenu = document.getElementById('nav-menu');
            const toolsDropdownToggle = document.getElementById('tools-dropdown-toggle');
            const toolsDropdownMenu = document.getElementById('tools-dropdown-menu');
            const toolsDropdownContainer = document.getElementById('tools-dropdown-container');

            if (navToggle && navMenu) {
                navToggle.addEventListener('click', () => {
                    navMenu.classList.toggle('show-menu');
                    const icon = navToggle.querySelector('i');
                    if (icon) {
                        icon.classList.toggle('fa-bars');
                        icon.classList.toggle('fa-times');
                    }

                    if (!navMenu.classList.contains('show-menu')) {
                        if (toolsDropdownMenu) toolsDropdownMenu.classList.remove('show-submenu');
                        if (toolsDropdownContainer) toolsDropdownContainer.classList.remove('active');
                    }
                });
            }

            if (toolsDropdownToggle && toolsDropdownMenu) {
                toolsDropdownToggle.addEventListener('click', (event) => {
                    if (window.innerWidth <= 992) {
                        event.preventDefault();
                        toolsDropdownMenu.classList.toggle('show-submenu');
                        if (toolsDropdownContainer) toolsDropdownContainer.classList.toggle('active');
                    }
                });
            }
        }
    </script>

</body>

</html>