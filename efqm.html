<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="canonical" href="https://sigmaexacta.com/efqm" />
    <title>Organizational Maturity Assessment | Sigma Exacta</title>
    <meta name="description"
        content="Free online assessment tool based on business excellence principles to diagnose your organization's performance. Evaluate leadership, strategy, processes, and results with a holistic framework.">
    <meta name="keywords"
        content="Open Source, Free Software, SigmaExacta, EFQM, Organizational Assessment Report, Business Excellence">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="sigma-exacta-icon.jpg" type="image/jpeg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;800&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="styles.css">

    <style>
        /* CAMBIOS GLOBALES */
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --success-color: #27ae60;
            --warning-color: #f1c40f;
            --light-color: #ecf0f1;
            font-size: 16px;
        }

        *,
        *::before,
        *::after {
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Nunito', 'Segoe UI', sans-serif;
            margin: 0;
            padding: 0;
            color: #333;
            background-color: #f5f7fa;
            line-height: 1.6;
            -webkit-text-size-adjust: 100%;
            width: 100%;
            overflow-x: hidden;
        }

        img,
        canvas {
            max-width: 100%;
            height: auto;
        }

        /* ===== NUEVO SISTEMA DE PESTAÑAS ===== */
        .main-content-wrapper {
            padding: 0;
            margin: 0;
            width: 100%;
            max-width: 100%;
            overflow-x: hidden;
        }

        .main-header {
            text-align: center;
            padding: 1rem 1.25rem;
            margin-bottom: 0;
            border-bottom: 1px solid #ddd;
            width: 100%;
            box-sizing: border-box;
            background-color: #f5f7fa;
        }

        .main-header h1 {
            color: #2c3e50;
            font-size: clamp(1.5rem, 4vw, 1.8rem);
            margin-top: 0.5rem;
            margin-bottom: 0.5rem;
            font-weight: 800;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .main-header p {
            color: #7f8c8d;
            font-weight: 400;
            font-size: 1.1rem;
            max-width: 700px;
            margin: 0 auto;
        }

        /* --- BOTONES PRINCIPALES SOBRE LAS TABS --- */
        .main-action-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 1.5rem auto;
            flex-wrap: wrap;
            max-width: 800px;
        }

        .main-action-buttons button {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
        }

        .main-action-buttons .btn-example {
            background-color: var(--success-color);
            color: white;
        }

        .main-action-buttons .btn-example:hover {
            background-color: #229954;
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.15);
        }

        .main-action-buttons .btn-reset {
            background-color: var(--accent-color);
            color: white;
        }

        .main-action-buttons .btn-reset:hover {
            background-color: #c0392b;
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.15);
        }

        /* ===== ESTILOS DEL SISTEMA DE PESTAÑAS (WIZARD) ===== */
        .tabs-nav {
            display: flex;
            background-color: #f1f5f9;
            border-radius: 8px 8px 0 0;
            overflow-x: auto;
            border-bottom: 2px solid #3498db;
            margin-bottom: 0;
            margin-top: 0;
            scrollbar-width: none;
            -ms-overflow-style: none;
            width: 100%;
            box-sizing: border-box;
        }

        .tabs-nav::-webkit-scrollbar {
            display: none;
        }

        .tab-btn {
            padding: 1rem 1.5rem;
            border: none;
            background: none;
            cursor: pointer;
            font-weight: 700;
            color: #64748b;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            font-family: 'Nunito', sans-serif;
            font-size: 1rem;
            flex: 1;
            justify-content: center;
            box-sizing: border-box;
        }

        .tab-btn:hover {
            background-color: #e2e8f0;
            color: #2c3e50;
        }

        .tab-btn.active {
            background-color: #fff;
            color: #3498db;
            border-bottom-color: #3498db;
            border-radius: 8px 8px 0 0;
            margin-bottom: -2px;
            border-left: 1px solid #e1e5e9;
            border-right: 1px solid #e1e5e9;
            border-top: 1px solid #e1e5e9;
        }

        /* CONTENEDOR PRINCIPAL DE TABS - FONDO BLANCO */
        .tabs-container {
            background: #fff;
            border: 1px solid #e1e5e9;
            border-top: none;
            border-radius: 0 0 8px 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            width: 100%;
            max-width: 100%;
            overflow-x: hidden;
            position: relative;
            margin-bottom: 2rem;
            box-sizing: border-box;
        }

        /* PESTAÑAS - Todas con el mismo ancho */
        .wizard-tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
            width: 100%;
            box-sizing: border-box;
            max-width: 100%;
        }

        .wizard-tab-content.active {
            display: block;
            width: 100%;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(5px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* CONTENIDO DE TODAS LAS TABS - Mismo padding */
        .tab-content-wrapper {
            padding: 2rem;
            width: 100%;
            box-sizing: border-box;
            max-width: 100%;
        }

        /* Ajuste para pantallas móviles */
        @media (max-width: 768px) {
            .tab-content-wrapper {
                padding: 1rem;
            }

            .tab-btn {
                padding: 0.75rem 0.5rem;
                font-size: 0.9rem;
            }

            .main-action-buttons {
                gap: 0.75rem;
                margin: 1rem auto;
            }

            .main-action-buttons button {
                padding: 0.7rem 1.2rem;
                font-size: 0.9rem;
            }
        }

        @media (max-width: 480px) {
            .tab-content-wrapper {
                padding: 0.75rem;
            }

            .tab-btn {
                padding: 0.6rem 0.3rem;
                font-size: 0.8rem;
            }

            .main-action-buttons {
                flex-direction: column;
                align-items: stretch;
                gap: 0.5rem;
            }

            .main-action-buttons button {
                width: 100%;
                justify-content: center;
            }
        }

        /* ===== ESTILOS EXISTENTES DE EFQM ===== */
        .header {
            margin-bottom: 1.25rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #ddd;
            text-align: center;
        }

        .header h1 {
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-color);
            font-size: clamp(1.5rem, 4vw, 1.8rem);
            margin: 0.5rem 0;
            font-weight: 800;
        }

        .header p {
            color: #666;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .block {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.25rem;
            background-color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            width: 100%;
            box-sizing: border-box;
        }

        .block-title {
            font-weight: 800;
            font-size: 1.2em;
            margin: 0 0 1rem 0;
            color: var(--primary-color);
            border-bottom: 1px solid #eee;
            padding-bottom: 0.6rem;
            display: flex;
            align-items: center;
            gap: 0.6rem;
        }

        .block p,
        .block li {
            line-height: 1.6;
        }

        .block ul {
            padding-left: 1.25rem;
            margin: 0.6rem 0 0 0;
        }

        button {
            background-color: var(--secondary-color);
            color: white;
            padding: 0.7rem 1.25rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 1rem;
            transition: background-color 0.3s;
            font-family: 'Nunito', sans-serif;
            font-weight: 600;
        }

        button:hover:not(:disabled) {
            background-color: #2980b9;
        }

        .btn-success {
            background-color: var(--success-color);
        }

        .btn-success:hover {
            background-color: #229954;
        }

        button:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.9rem;
            font-weight: bold;
            color: white;
        }

        .badge-success {
            background-color: var(--success-color);
        }

        .badge-warning {
            background-color: var(--warning-color);
            color: #333;
        }

        .badge-danger {
            background-color: var(--accent-color);
        }

        /* ESTILOS DE ACORDEÓN MEJORADOS */
        .accordion-item {
            border-bottom: 1px solid #ddd;
        }

        .accordion-item:last-child {
            border-bottom: none;
        }

        .accordion-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            cursor: pointer;
            background-color: #f8f9fa;
            transition: background-color 0.2s;
        }

        .accordion-header:hover {
            background-color: #e9ecef;
        }

        .accordion-title {
            font-weight: 600;
            font-size: 1.1em;
            color: var(--primary-color);
        }

        .accordion-score {
            font-weight: bold;
            color: var(--secondary-color);
            white-space: nowrap;
        }

        .accordion-icon {
            transition: transform 0.3s ease;
        }

        .accordion-header.active .accordion-icon {
            transform: rotate(180deg);
        }

        .accordion-body {
            padding: 1.25rem;
            background-color: white;
            display: none;
            border-top: 1px solid #e9ecef;
        }

        .sub-criterion {
            margin-bottom: 1.25rem;
        }

        .sub-criterion label {
            display: block;
            margin-bottom: 0.6rem;
            font-weight: 600;
        }

        /* --- ESTILOS DEL SLIDER MODIFICADOS PARA USAR EL COLOR DE LA CATEGORÍA --- */
        .score-slider {
            width: calc(100% - 70px);
            margin-right: 15px;
            vertical-align: middle;
            cursor: pointer;
            -webkit-appearance: none;
            appearance: none;
            background: transparent;
        }

        .score-slider::-webkit-slider-runnable-track {
            width: 100%;
            height: 6px;
            background: #ddd;
            border-radius: 3px;
        }

        .score-slider::-moz-range-track {
            width: 100%;
            height: 6px;
            background: #ddd;
            border-radius: 3px;
        }

        .score-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            margin-top: -5px;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: var(--slider-color, var(--secondary-color));
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);
            transition: background-color 0.3s;
        }

        .score-slider::-moz-range-thumb {
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: var(--slider-color, var(--secondary-color));
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);
            border: none;
            transition: background-color 0.3s;
        }

        .slider-value {
            display: inline-block;
            width: 50px;
            font-weight: bold;
            text-align: right;
        }

        .results-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            align-items: center;
        }

        #chart-wrapper {
            position: relative;
            min-height: 300px;
        }

        .analysis-section {
            margin-bottom: 1rem;
        }

        .analysis-section ul {
            padding-left: 0;
            list-style: none;
        }

        .analysis-section li {
            margin-bottom: 0.5rem;
            display: flex;
            align-items: flex-start;
            word-break: break-word;
        }

        .analysis-section li i {
            margin-right: 8px;
            margin-top: 4px;
        }

        textarea {
            width: 100%;
            box-sizing: border-box;
            min-height: 120px;
            padding: 0.6rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            margin-top: 0.6rem;
            font-family: 'Nunito', sans-serif;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        textarea:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.3);
        }

        footer {
            padding: 2rem 1.25rem;
            text-align: center;
        }

        .disclaimer-note {
            margin-top: 2rem;
            padding: 0 1rem;
            font-size: 0.8rem;
            color: #777;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .summary-logo {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: block;
            margin: 0.75rem 0 1rem 0;
        }

        .efqm-h1-icon {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            width: 50px;
            height: 50px;
            border-radius: 8px;
            background-color: #27ae60;
            color: white;
            font-size: 2.0rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            margin-right: 12px;
            vertical-align: middle;
            transition: background-color 0.3s, box-shadow 0.3s;
        }

        .efqm-h1-icon:hover {
            background-color: #1e8449;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        .tab-nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid #eee;
            width: 100%;
            box-sizing: border-box;
        }

        .btn-next-tab {
            background-color: #3498db;
            color: white;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.7rem 1.25rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            font-family: 'Nunito', sans-serif;
            transition: background-color 0.3s, transform 0.2s;
        }

        .btn-next-tab:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }

        .btn-next-tab.btn-prev {
            background-color: #95a5a6;
        }

        .btn-next-tab.btn-prev:hover {
            background-color: #7f8c8d;
        }

        .btn-next-tab.btn-success {
            background-color: #27ae60;
        }

        .btn-next-tab.btn-success:hover {
            background-color: #229954;
        }

        .results-actions {
            display: flex;
            gap: 10px;
            margin-top: 1rem;
            flex-wrap: wrap;
            width: 100%;
            justify-content: center;
        }

        /* ===== ESTILOS NUEVOS PARA LA TABLA DE RESULTADOS ===== */
        .detailed-results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            font-size: 0.95rem;
        }

        .detailed-results-table th,
        .detailed-results-table td {
            padding: 10px;
            border: 1px solid #eee;
            text-align: left;
        }

        .criteria-header-row {
            color: white;
            font-weight: bold;
        }

        .sub-criteria-row:nth-child(even) {
            background-color: #f9f9f9;
        }

        .score-cell {
            text-align: center !important;
            font-weight: bold;
            width: 80px;
        }

        /* NUEVO: Estilo para ocultar resultados */
        .results-hidden {
            display: none !important;
        }

        /* NUEVO: Estilo para mostrar mensaje cuando los resultados están ocultos */
        .hidden-results-message {
            text-align: center;
            padding: 3rem 2rem;
            color: #7f8c8d;
            font-style: italic;
            border: 2px dashed #ddd;
            border-radius: 8px;
            margin: 2rem 0;
            background-color: #f9f9f9;
        }

        .hidden-results-message i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #ddd;
        }

        .hidden-results-message h3 {
            color: #7f8c8d;
            margin-bottom: 0.5rem;
        }

        .hidden-results-message p {
            font-size: 1.1rem;
        }
    </style>
</head>

<body>
    <div id="header-container"></div>

    <noscript>
        <nav>
            <a href="/">Home</a> |
            <a href="/8d">8D Tool</a> |
            <a href="/taguchi_doe">Taguchi DOE</a> |
            <a href="/swot">SWOT Analysis</a> |
            <a href="/balancedcard">Balanced Scorecard</a> |
            <a href="/qfd">QFD</a> |
            <a href="/apqp-ppap">APQP/PPAP</a> |
            <a href="/ishikawa">Ishikawa</a> |
            <a href="/fmea">FMEA</a> |
            <a href="/vave">VAVE</a> |
            <a href="/eisenhower">Eisenhower Matrix</a> |
            <a href="/triz">TRIZ</a> |
            <a href="/weibull">Weibull</a> |
            <a href="/stack_up_analysis">Tolerance Stack-Up</a> |
            <a href="/pdca">PDCA</a> |
            <a href="/design_thinking">Design Thinking</a> |
            <a href="/pugh">Pugh Matrix</a> |
            <a href="/cpk_calculator">CpK Calculator</a> |
            <a href="/control-plan">Control Plan</a>
        </nav>
    </noscript>

    <main class="main-content-wrapper">
        <header class="main-header">
            <h1>
                <a href="https://www.efqm.org/" target="_blank" title="Learn more about the EFQM Model"
                    style="text-decoration: none;">
                    <div class="efqm-h1-icon">
                        <i class="fas fa-award"></i>
                    </div>
                </a>
                Free Online Organizational Maturity Assessment Tool
            </h1>
            <p>Diagnose your organization's maturity level using a holistic performance framework.</p>
        </header>

        <div class="main-action-buttons">
            <button id="globalLoadExampleBtn" class="btn-example">
                <i class="fas fa-bolt"></i> Load Example Data
            </button>
            <button id="globalResetBtn" class="btn-reset">
                <i class="fas fa-undo"></i> Reset All Scores
            </button>
        </div>

        <div class="tabs-container">
            <nav class="tabs-nav">
                <button class="tab-btn active" onclick="switchWizardTab('tab-theory')">
                    <i class="fas fa-book"></i> Theory & Info
                </button>
                <button class="tab-btn" onclick="switchWizardTab('tab-input')">
                    <i class="fas fa-edit"></i> Data Input & Assessment
                </button>
                <button class="tab-btn" onclick="switchWizardTab('tab-results')">
                    <i class="fas fa-chart-bar"></i> Results & Export
                </button>
            </nav>

            <div id="tab-theory" class="wizard-tab-content active">
                <div class="tab-content-wrapper">
                    <div class="block">
                        <div class="block-title"><i class="fas fa-info-circle"></i> What is an Organizational Maturity
                            Framework?
                        </div>
                        <p>An Organizational Maturity or Business Excellence Framework is a strategic management tool
                            used for
                            self-assessment and continuous improvement. These frameworks provide a holistic view of an
                            organization
                            by evaluating its performance across a balanced set of criteria, from leadership and
                            strategy to
                            processes and results.</p>
                    </div>

                    <div class="block">
                        <div class="block-title"><i class="fas fa-history"></i> History and Purpose</div>
                        <p>The concept of organizational excellence evolved from the quality movements of the 20th
                            century. After
                            World War II, W. Edwards Deming's work on quality control in Japan led to the creation of
                            the
                            <strong>Deming Prize</strong> in 1951, one of the earliest models for recognizing
                            company-wide quality
                            management.
                        </p>
                        <p>In response to growing international competition, the United States established the
                            <strong>Baldrige
                                Performance Excellence Framework</strong> in 1987. Shortly after, European leaders
                            created the
                            <strong>EFQM Model</strong> (European Foundation for Quality Management) in 1989 to enhance
                            the
                            competitiveness of European organizations.
                        </p>
                        <p>The purpose of these frameworks is to move beyond simple product quality checks and provide a
                            holistic,
                            non-prescriptive guide for achieving sustainable excellence across all facets of an
                            organization.</p>
                    </div>

                    <div class="block">
                        <div class="block-title"><i class="fas fa-tools"></i> How to Use This Tool</div>
                        <ul>
                            <li><strong>Step 1: Perform Assessment:</strong> In the "Data Input & Assessment" tab, click
                                on each of the 7 criteria to expand the section. Use the sliders to score your
                                organization's performance on each sub-criterion. Scores update in real-time.</li>
                            <li><strong>Step 2: Review Dashboard:</strong> Your scores will automatically update the
                                dashboard in the "Results & Export" tab, showing pillar scores, a total score, and a
                                maturity level. The radar chart provides a visual profile of your organization's
                                strengths.</li>
                            <li><strong>Step 3: Analyze Results:</strong> The "Automated Analysis" section will
                                highlight your key strengths and potential opportunities for improvement based on your
                                scores.</li>
                            <li><strong>Step 4: Create an Action Plan:</strong> Use the "Notes & Action Plan" text area
                                to document key insights and define concrete next steps.</li>
                            <li><strong>Step 5: Export Report:</strong> In the "Results & Export" tab, click the "Export
                                to Excel" button to download a comprehensive report with your summary, scores, chart,
                                and action plan.</li>
                        </ul>
                    </div>

                    <div class="tab-nav-buttons">
                        <button class="btn-next-tab" onclick="switchWizardTab('tab-input')">Go to Data Input &
                            Assessment <i class="fas fa-arrow-right"></i></button>
                    </div>
                </div>
            </div>

            <div id="tab-input" class="wizard-tab-content">
                <div class="tab-content-wrapper">
                    <div class="block">
                        <div class="block-title"><i class="fas fa-tasks"></i> Organizational Assessment</div>
                        <p>Click on each criterion below to expand and evaluate your organization's performance. Use the
                            sliders to assign scores (0-100%) for each sub-criterion.</p>

                        <div style="display: none;">
                            <button type="button" id="loadExampleBtn" class="btn-success"><i class="fas fa-bolt"></i>
                                Load Example
                                Data</button>
                            <button type="button" id="resetBtn"><i class="fas fa-undo"></i> Reset All Scores</button>
                        </div>

                        <div id="assessmentAccordion"></div>
                    </div>

                    <div class="tab-nav-buttons">
                        <button class="btn-next-tab btn-prev" onclick="switchWizardTab('tab-theory')"><i
                                class="fas fa-arrow-left"></i> Back to Theory</button>
                        <button class="btn-next-tab btn-success" onclick="switchWizardTab('tab-results')">Go to Results
                            & Export <i class="fas fa-arrow-right"></i></button>
                    </div>
                </div>
            </div>

            <div id="tab-results" class="wizard-tab-content">
                <div class="tab-content-wrapper">
                    <!-- CONTENEDOR PRINCIPAL DE RESULTADOS (se ocultará inicialmente) -->
                    <div id="results-container" class="results-hidden">
                        <div class="block">
                            <div class="block-title"><i class="fas fa-chart-line"></i> Results Dashboard</div>

                            <div class="results-dashboard" id="results-block">
                                <div id="score-summary">
                                    <div class="block-title"><i class="fas fa-sitemap"></i> Foundations: <span
                                            id="foundations_score" class="result-value">-</span> / 200 pts</div>
                                    <img src="sigma-exacta-icon.jpg" alt="Sigma Exacta Logo" class="summary-logo">
                                    <p><i class="fas fa-cogs"></i> Processes: <span id="processes_score"
                                            class="result-value">-</span> / 400
                                        pts</p>
                                    <p><i class="fas fa-trophy"></i> Outcomes: <span id="outcomes_score"
                                            class="result-value">-</span> / 400
                                        pts</p>
                                    <hr>
                                    <p style="font-size: 1.2em; font-weight: bold;">Total Score: <span id="total_score"
                                            class="result-value">-</span> / 1000</p>
                                    <p>Maturity Level: <span id="maturity_level" class="badge">-</span></p>
                                </div>
                                <div id="chart-wrapper">
                                    <canvas id="excellenceChart"></canvas>
                                </div>
                            </div>
                        </div>

                        <div class="block" id="analysis-block">
                            <div class="block-title"><i class="fas fa-lightbulb"></i> Automated Analysis</div>
                            <div class="results-dashboard">
                                <div class="analysis-section">
                                    <h4><i class="fas fa-star" style="color:var(--success-color);"></i> Key Strengths
                                    </h4>
                                    <ul id="strengths-list">
                                        <li>Complete the assessment to see analysis.</li>
                                    </ul>
                                </div>
                                <div class="analysis-section">
                                    <h4><i class="fas fa-lightbulb" style="color:var(--warning-color);"></i>
                                        Opportunities
                                        for
                                        Improvement</h4>
                                    <ul id="ofis-list">
                                        <li>Complete the assessment to see analysis.</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="block" id="notes-block">
                            <div class="block-title"><i class="fas fa-pen-alt"></i> Notes & Action Plan</div>
                            <p>Use the space below to write down your reflections, key findings, or next steps.</p>
                            <textarea id="actionPlan"
                                placeholder="e.g., Action: Review stakeholder engagement strategy (Criterion 3). Owner: John Doe. Deadline: Q3."></textarea>
                        </div>

                        <div class="block" id="detailed-results-view" style="display: none;">
                            <div class="block-title"><i class="fas fa-list-ol"></i> Detailed Score Breakdown</div>
                            <div id="detailed-results-content">
                            </div>
                        </div>
                    </div>

                    <!-- MENSAJE CUANDO LOS RESULTADOS ESTÁN OCULTOS -->
                    <div class="hidden-results-message" id="hidden-results-message">
                        <i class="fas fa-chart-bar"></i>
                        <h3>Results Hidden</h3>
                        <p>Click "Show Results" to view your assessment results, analysis, and action plan.</p>
                    </div>

                    <!-- BOTONES DE ACCIÓN (siempre visibles) -->
                    <div class="block" style="text-align: center;">
                        <div class="results-actions">
                            <button id="listResultsBtn" style="background-color: #8e44ad;">
                                <i class="fas fa-eye"></i> Show Results
                            </button>

                            <button id="exportExcelBtn">
                                <i class="fas fa-file-excel"></i> Export Excellence Report to Excel
                            </button>
                            <button id="exportJpgBtn">
                                <i class="fas fa-file-image"></i> Export Results to JPG
                            </button>
                        </div>
                    </div>

                    <div class="tab-nav-buttons">
                        <button class="btn-next-tab btn-prev" onclick="switchWizardTab('tab-input')">
                            <i class="fas fa-arrow-left"></i> Back to Data Input & Assessment
                        </button>
                        <button class="btn-next-tab" onclick="switchWizardTab('tab-theory')">
                            Back to Theory <i class="fas fa-book"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="disclaimer-note">
            <p><strong>Disclaimer:</strong> The tools and information provided on Sigma Exacta are for informational and
                educational purposes only. Some tools, like this one, are based on established methodologies (e.g., EFQM
                Model, Baldrige Framework), which may be the intellectual property of their respective owners. The tools
                on this site are independent implementations and are not affiliated with, sponsored by, or endorsed by
                the original creators of these methodologies. While we strive for accuracy, we make no warranty or
                guarantee regarding the results. All calculations and decisions based on the output of these tools are
                the sole responsibility of the user. Sigma Exacta and its creators are not liable for any damages or
                losses resulting from the use of this website.</p>
        </div>
    </footer>

    <script>
        // ============================================
        // FUNCIONES DEL SISTEMA DE PESTAÑAS
        // ============================================

        // Función para cambiar entre tabs
        function switchWizardTab(tabId) {
            // Quitar clase active de todos los botones y contenidos de wizard
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.wizard-tab-content').forEach(content => content.classList.remove('active'));

            // Activar el contenido seleccionado
            document.getElementById(tabId).classList.add('active');

            // Activar botón correspondiente
            const activeBtn = document.querySelector(`button[onclick="switchWizardTab('${tabId}')"]`);
            if (activeBtn) activeBtn.classList.add('active');

            // Scroll al top suavemente
            window.scrollTo({ top: 0, behavior: 'smooth' });

            // Actualizar gráfico cuando se cambia a la pestaña de resultados
            if (tabId === 'tab-results' && excellenceChart) {
                updateUI();
            }
        }

        // Cargar el header dinámicamente
        fetch('header.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('header-container').innerHTML = data;
                // Inicializar el menú después de cargar el header
                initNavigation();
            })
            .catch(error => console.error('Error loading header:', error));

        // Función para inicializar la navegación
        function initNavigation() {
            const hoverSound = new Audio('data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABgAZGF0YQQAAAAAAAC/AAABAAAA//8AAnIseAABAHwAAU5/AABXfgAAS34AAEd+AABJfgAATX4AAFV+AABXfgAAVH4AAFN+AABTfgAAS34AAE9+AABVfgAAUX4AAEN+AABAfQAAP30AAD59AAA/fQAAQ30AAEd9AABLfQAAUn0AAGB9AABsfQAAe30AAH59AACAfQAAf30AAHx9AAB1fQAAdX0AAHV9AAB1fQAAdX0AAHJ9AABxPQAAeD4AAHc/AAB2PwAAcj8AAHI/AABxPwAAcT8AAHE/AABwPwAAcD8AAHA/AABvPwAAcD8AAHA/AABvPwAAaz0AAG4/AABsPwAAZj8AAGQ/AABiPwAAZD8AAGI/ABhPwAAYT8AAGI/AABiPwAAYT8AAGM/AABlPwAAaD8AAGs/AABuPwAAbj8AAG0/AABsPwAAbD8AAGs/AABoPwAAZD8AAGM/AABkPwAAZz8AAGg/AABrPwAAbT8AAHA/AABzPwAAcz8AAHM/AABzPwAAcT8AAHE/AABxPwAAcD8AAHA/AABwPwAAbj8AAGs/AABpPwAAaD8AAGc/AABhPwAAYD8AAF8/AABePwAAXT8AAFw/AABbPwAAWj8AAFk/AABYPwAAWj8AAFk/AABZPwAAWT8AAFk/AABYPwAAVT8AAFI/AABPPwAATD8AAEk/AABGPwAAQz8AAEA/AAA+PwAAO/wAADf8AAA1/AAANfwAADX8AAA1/AAANfwAADf8AAA2/AAAN/wAADf8AAA3/AAAN/wAADf8AAA3/AAAN/wAADf8AAA4/AAAOPwAADj8AAA4/AAA4/AAAOPwAADj8AAA4/AAAN/wAADf8AAA3/AAAN/wAADf8AAA3/AAAN/wAADf8AAA3/AAAN/wAADf8AAA3/AAAN/wAADf8AAA3/AAAN/wAADf8AAA3/AA');
            hoverSound.preload = 'auto';
            let audioUnlocked = false;
            function unlockAudio() {
                if (audioUnlocked) return;
                hoverSound.volume = 0;
                hoverSound.play().then(() => {
                    hoverSound.pause();
                    hoverSound.currentTime = 0;
                    hoverSound.volume = 1;
                    audioUnlocked = true;
                    document.removeEventListener('click', unlockAudio);
                    document.removeEventListener('touchstart', unlockAudio);
                }).catch(e => { });
            }
            document.addEventListener('click', unlockAudio);
            document.addEventListener('touchstart', unlockAudio);
            const navToggle = document.getElementById('nav-toggle');
            const navMenu = document.getElementById('nav-menu');
            const toolsDropdownToggle = document.getElementById('tools-dropdown-toggle');
            const toolsDropdownMenu = document.getElementById('tools-dropdown-menu');
            const toolsDropdownContainer = document.getElementById('tools-dropdown-container');
            navToggle.addEventListener('click', () => {
                navMenu.classList.toggle('show-menu');
                const icon = navToggle.querySelector('i');
                icon.classList.toggle('fa-bars');
                icon.classList.toggle('fa-times');
                if (!navMenu.classList.contains('show-menu')) {
                    toolsDropdownMenu.classList.remove('show-submenu');
                    toolsDropdownContainer.classList.remove('active');
                }
            });
            toolsDropdownToggle.addEventListener('click', (event) => {
                if (window.innerWidth <= 992) {
                    event.preventDefault();
                    toolsDropdownMenu.classList.toggle('show-submenu');
                    toolsDropdownContainer.classList.toggle('active');
                }
            });
        }

        const exampleDataTemplate = [
            { id: 'c1', name: '1. Leadership & Strategy', shortName: 'Leadership', weight: 100, color: '#3498db', subCriteria: [{ q: 'Leadership provides clear direction and purpose.', score: 70 }, { q: 'A robust strategy is in place and effectively communicated.', score: 60 }, { q: 'Leaders foster a culture of excellence and continuous improvement.', score: 50 },] },
            { id: 'c2', name: '2. People & Culture', shortName: 'Culture', weight: 100, color: '#2ecc71', subCriteria: [{ q: 'The organization attracts, develops, and retains talent.', score: 80 }, { q: 'The workplace culture is positive, inclusive, and empowering.', score: 60 }, { q: 'Employee well-being and engagement are actively managed.', score: 70 },] },
            { id: 'c3', name: '3. Stakeholder Focus', shortName: 'Stakeholders', weight: 100, color: '#f1c40f', subCriteria: [{ q: 'Key stakeholder needs are understood and anticipated.', score: 90 }, { q: 'Strong, value-driven relationships are built with stakeholders.', score: 70 }, { q: 'Stakeholder feedback is systematically gathered and acted upon.', score: 60 },] },
            { id: 'c4', name: '4. Process Mgmt.', shortName: 'Processes', weight: 200, color: '#9b59b6', subCriteria: [{ q: 'Value-adding processes are designed, managed, and optimized.', score: 50 }, { q: 'Quality and efficiency are systematically improved.', score: 40 }, { q: 'Risk and opportunity are effectively managed within processes.', score: 60 },] },
            { id: 'c5', name: '5. Innovation & Tech', shortName: 'Innovation', weight: 100, color: '#e67e22', subCriteria: [{ q: 'Innovation is encouraged and managed to create new value.', score: 60 }, { q: 'Digital technologies are leveraged to improve performance.', score: 50 }, { q: 'The organization is agile and adapts to change effectively.', score: 70 },] },
            { id: 'c6', name: '6. Stakeholder Results', shortName: 'Stakeholder Results', weight: 200, color: '#c0392b', subCriteria: [{ q: 'There are consistently high levels of customer satisfaction.', score: 70 }, { q: 'There are positive results related to employee engagement.', score: 60 }, { q: 'The organization is viewed positively by partners and society.', score: 80 },] },
            { id: 'c7', name: '7. Business Results', shortName: 'Business Results', weight: 200, color: '#34495e', subCriteria: [{ q: 'The organization is achieving its key strategic goals.', score: 80 }, { q: 'Key operational and performance targets are being met.', score: 90 }, { q: 'Financial health is strong and sustainable.', score: 70 },] }
        ];
        let criteriaData;
        let excellenceChart;
        let resultsVisible = false;

        document.addEventListener('DOMContentLoaded', () => {
            resetAll();
            initializeChart();
            setupEventListeners();
        });

        function renderAccordion() {
            const accordionContainer = document.getElementById('assessmentAccordion');
            accordionContainer.innerHTML = '';
            criteriaData.forEach((criterion, index) => {
                const item = document.createElement('div');
                item.className = 'accordion-item';
                let subCriteriaHtml = '';
                criterion.subCriteria.forEach((sub, subIndex) => {
                    subCriteriaHtml += `
                <div class="sub-criterion">
                    <label for="sub-slider-${index}-${subIndex}">${sub.q}</label>
                    <input type="range" 
                           id="sub-slider-${index}-${subIndex}" 
                           class="score-slider" 
                           data-criterion-index="${index}" 
                           data-sub-index="${subIndex}" 
                           min="0" max="100" step="10" 
                           value="${sub.score}"
                           style="--slider-color: ${criterion.color};"> 
                    <span class="slider-value" id="sub-value-${index}-${subIndex}">${sub.score}%</span>
                </div>`;
                });
                item.innerHTML = `
            <div class="accordion-header" data-index="${index}">
                <span class="accordion-title" style="color:${criterion.color};">${criterion.name}</span>
                <div style="display:flex; align-items:center; gap:15px;">
                    <span class="accordion-score" id="${criterion.id}-score" style="color:${criterion.color};">0 / ${criterion.weight} pts</span>
                    <i class="fas fa-chevron-down accordion-icon"></i>
                </div>
            </div>
            <div class="accordion-body" style="display: none;">${subCriteriaHtml}</div>`;
                accordionContainer.appendChild(item);
            });
            attachSliderListeners();
        }

        function attachSliderListeners() {
            document.querySelectorAll('.score-slider').forEach(slider => {
                slider.oninput = (e) => {
                    const criterionIndex = e.target.dataset.criterionIndex;
                    const subIndex = e.target.dataset.subIndex;
                    const newValue = parseInt(e.target.value);
                    document.getElementById(`sub-value-${criterionIndex}-${subIndex}`).textContent = `${newValue}%`;
                    criteriaData[criterionIndex].subCriteria[subIndex].score = newValue;
                    updateUI();
                };
            });
        }

        function initializeChart() {
            const ctx = document.getElementById('excellenceChart').getContext('2d');

            // Create the gradient for the fill
            const gradientFill = ctx.createLinearGradient(0, 0, 0, 400);
            gradientFill.addColorStop(0, 'rgba(52, 152, 219, 0.4)');
            gradientFill.addColorStop(0.5, 'rgba(46, 204, 113, 0.4)');
            gradientFill.addColorStop(1, 'rgba(231, 76, 60, 0.4)');

            excellenceChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: criteriaData.map(c => c.shortName),
                    datasets: [{
                        label: 'Criterion Score (%)',
                        data: [],
                        backgroundColor: gradientFill,
                        borderColor: criteriaData.map(c => c.color),
                        borderWidth: 2,
                        fill: true,
                        tension: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            angleLines: { display: true, color: 'rgba(0,0,0,0.1)' },
                            suggestedMin: 0,
                            suggestedMax: 100,
                            pointLabels: {
                                font: { size: 12 },
                                color: criteriaData.map(c => c.color)
                            },
                            ticks: {
                                backdropColor: 'rgba(255, 255, 255, 0.75)',
                                stepSize: 20
                            }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        title: {
                            display: true,
                            text: 'Organizational Excellence Profile',
                            font: { size: 16 }
                        }
                    }
                }
            });
        }

        function setupEventListeners() {
            // Usar los nuevos botones globales
            document.getElementById('globalLoadExampleBtn').addEventListener('click', loadExample);
            document.getElementById('globalResetBtn').addEventListener('click', resetAll);

            // Mantener compatibilidad con los botones existentes (ocultos)
            document.getElementById('loadExampleBtn').addEventListener('click', loadExample);
            document.getElementById('resetBtn').addEventListener('click', resetAll);

            // LISTENER PARA EL NUEVO BOTÓN
            document.getElementById('listResultsBtn').addEventListener('click', toggleResultsVisibility);

            document.getElementById('assessmentAccordion').addEventListener('click', e => {
                const header = e.target.closest('.accordion-header');
                if (header) {
                    const body = header.nextElementSibling;
                    header.classList.toggle('active');
                    body.style.display = body.style.display === 'block' ? 'none' : 'block';
                }
            });
            document.getElementById('exportExcelBtn').addEventListener('click', exportToExcel);
            document.getElementById('exportJpgBtn').addEventListener('click', exportToJpg);
        }

        function updateUI() {
            let foundationsScore = 0, processesScore = 0, outcomesScore = 0, totalScore = 0;
            criteriaData.forEach((c, i) => {
                const subScores = c.subCriteria.map(sub => sub.score);
                c.score = subScores.length > 0 ? subScores.reduce((a, b) => a + b, 0) / subScores.length : 0;
                const points = (c.score / 100) * c.weight;
                totalScore += points;
                if (i < 3) foundationsScore += points;
                else if (i < 5) processesScore += points;
                else outcomesScore += points;
                document.getElementById(`${c.id}-score`).textContent = `${points.toFixed(0)} / ${c.weight} pts`;
            });
            document.getElementById('foundations_score').textContent = foundationsScore.toFixed(0);
            document.getElementById('processes_score').textContent = processesScore.toFixed(0);
            document.getElementById('outcomes_score').textContent = outcomesScore.toFixed(0);
            document.getElementById('total_score').textContent = totalScore.toFixed(0);
            const maturitySpan = document.getElementById('maturity_level');
            if (totalScore < 300) {
                maturitySpan.textContent = 'Getting Started'; maturitySpan.className = 'badge badge-danger';
            } else if (totalScore < 500) {
                maturitySpan.textContent = 'Developing'; maturitySpan.className = 'badge badge-warning';
            } else if (totalScore < 700) {
                maturitySpan.textContent = 'Mature'; maturitySpan.className = 'badge badge-success';
            } else {
                maturitySpan.textContent = 'Role Model'; maturitySpan.className = 'badge badge-success';
            }
            excellenceChart.data.datasets[0].data = criteriaData.map(c => c.score);
            excellenceChart.data.datasets[0].borderColor = criteriaData.map(c => c.color);
            excellenceChart.update();
            generateAnalysis();
        }

        function generateAnalysis() {
            const sortedCriteria = [...criteriaData].sort((a, b) => b.score - a.score);
            const strengths = sortedCriteria.slice(0, 3).filter(c => c.score > 60);
            const ofis = sortedCriteria.slice(-3).reverse().filter(c => c.score < 50);
            const strengthList = document.getElementById('strengths-list');
            strengthList.innerHTML = strengths.length > 0
                ? strengths.map(c => `<li><i class="fas fa-check-circle" style="color:var(--success-color);"></i>${c.name.split('. ')[1]} (${c.score.toFixed(0)}%)</li>`).join('')
                : '<li>Complete the assessment to see analysis.</li>';
            const ofisList = document.getElementById('ofis-list');
            ofisList.innerHTML = ofis.length > 0
                ? ofis.map(c => `<li><i class="fas fa-arrow-alt-circle-up" style="color:var(--warning-color);"></i>${c.name.split('. ')[1]} (${c.score.toFixed(0)}%)</li>`).join('')
                : '<li>No significant opportunities identified yet.</li>';
        }

        function resetAll() {
            criteriaData = JSON.parse(JSON.stringify(exampleDataTemplate));
            criteriaData.forEach(c => { c.subCriteria.forEach(sub => sub.score = 0); });
            document.getElementById('actionPlan').value = '';
            renderAccordion();

            // Asegurar que los resultados estén ocultos
            document.getElementById('results-container').classList.add('results-hidden');
            document.getElementById('hidden-results-message').style.display = 'block';
            document.getElementById('listResultsBtn').innerHTML = '<i class="fas fa-eye"></i> Show Results';
            document.getElementById('listResultsBtn').style.backgroundColor = '#8e44ad';
            resultsVisible = false;

            if (excellenceChart) {
                updateUI();
            }
        }

        function loadExample() {
            criteriaData = JSON.parse(JSON.stringify(exampleDataTemplate));
            document.getElementById('actionPlan').value = "Example Action Plan:\n1. Review stakeholder feedback process (Criterion 3) to better capture insights.\n2. Launch a pilot project to improve process efficiency (Criterion 4).\n3. Communicate strategic goals more clearly to all teams (Criterion 1).";
            renderAccordion();
            updateUI();

            // Asegurar que los resultados estén ocultos
            document.getElementById('results-container').classList.add('results-hidden');
            document.getElementById('hidden-results-message').style.display = 'block';
            document.getElementById('listResultsBtn').innerHTML = '<i class="fas fa-eye"></i> Show Results';
            document.getElementById('listResultsBtn').style.backgroundColor = '#8e44ad';
            resultsVisible = false;

            // Cambiar a la pestaña de input
            switchWizardTab('tab-input');

            // Esperar un momento para que se renderice la pestaña y hacer scroll
            setTimeout(() => {
                const accordion = document.getElementById('assessmentAccordion');
                accordion.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
        }

        // FUNCION PARA MOSTRAR/OCULTAR RESULTADOS
        function toggleResultsVisibility() {
            const container = document.getElementById('results-container');
            const hiddenMessage = document.getElementById('hidden-results-message');
            const listResultsBtn = document.getElementById('listResultsBtn');

            if (!resultsVisible) {
                // Mostrar TODO el contenido de resultados
                container.classList.remove('results-hidden');
                hiddenMessage.style.display = 'none';

                // Mostrar también la tabla detallada
                document.getElementById('detailed-results-view').style.display = 'block';
                updateDetailedTable();

                // Cambiar el texto del botón
                listResultsBtn.innerHTML = '<i class="fas fa-eye-slash"></i> Hide Results';
                listResultsBtn.style.backgroundColor = '#34495e';
                resultsVisible = true;

                // Scroll a los resultados
                container.scrollIntoView({ behavior: 'smooth', block: 'start' });
            } else {
                // Ocultar TODO el contenido de resultados
                container.classList.add('results-hidden');
                hiddenMessage.style.display = 'block';

                // Ocultar también la tabla detallada
                document.getElementById('detailed-results-view').style.display = 'none';

                // Cambiar el texto del botón
                listResultsBtn.innerHTML = '<i class="fas fa-eye"></i> Show Results';
                listResultsBtn.style.backgroundColor = '#8e44ad';
                resultsVisible = false;

                // Scroll al mensaje
                hiddenMessage.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        // FUNCIÓN AUXILIAR PARA ACTUALIZAR TABLA DETALLADA
        function updateDetailedTable() {
            const content = document.getElementById('detailed-results-content');
            let html = '<table class="detailed-results-table">';

            criteriaData.forEach(c => {
                const totalScore = c.subCriteria.reduce((sum, sub) => sum + sub.score, 0) / c.subCriteria.length;

                html += `
                    <tr class="criteria-header-row" style="background-color: ${c.color};">
                        <td colspan="2">
                            ${c.name} <span style="float:right;">${totalScore.toFixed(1)}%</span>
                        </td>
                    </tr>
                `;

                c.subCriteria.forEach(sub => {
                    html += `
                        <tr class="sub-criteria-row">
                            <td>${sub.q}</td>
                            <td class="score-cell">${sub.score}%</td>
                        </tr>
                    `;
                });
            });

            html += '</table>';
            content.innerHTML = html;
        }

        // FUNCIÓN MEJORADA PARA EXPORTAR A EXCEL
        function exportToExcel() {
            // Si los resultados no están visibles, mostrarlos primero
            if (!resultsVisible) {
                toggleResultsVisibility();
                // Esperar un momento para que se rendericen los resultados
                setTimeout(exportExcelWithData, 300);
            } else {
                exportExcelWithData();
            }
        }

        function exportExcelWithData() {
            const wb = XLSX.utils.book_new();

            // HOJA 1: RESUMEN
            const summaryData = [
                ["ORGANIZATIONAL MATURITY ASSESSMENT REPORT", "", "", "", ""],
                ["Generated by Sigma Exacta", "", "", "", ""],
                ["Date:", new Date().toLocaleDateString(), "", "", ""],
                ["", "", "", "", ""],
                ["PILLAR", "SCORE", "MAX SCORE", "PERCENTAGE", "RATING"],
                ["Foundations", parseFloat(document.getElementById('foundations_score').textContent), 200],
                ["Processes", parseFloat(document.getElementById('processes_score').textContent), 400],
                ["Outcomes", parseFloat(document.getElementById('outcomes_score').textContent), 400],
                ["TOTAL", parseFloat(document.getElementById('total_score').textContent), 1000],
                ["", "", "", "", ""],
                ["MATURITY LEVEL", document.getElementById('maturity_level').textContent, "", "", ""],
                ["", "", "", "", ""],
                ["KEY STRENGTHS", "", "", "", ""]
            ];

            // Añadir fortalezas
            const strengths = document.querySelectorAll('#strengths-list li');
            strengths.forEach(li => {
                const text = li.textContent.replace('●', '').trim();
                if (text && text !== "Complete the assessment to see analysis.") {
                    summaryData.push([text, "", "", "", ""]);
                }
            });

            summaryData.push(["", "", "", "", ""], ["OPPORTUNITIES FOR IMPROVEMENT", "", "", "", ""]);

            // Añadir oportunidades
            const ofis = document.querySelectorAll('#ofis-list li');
            ofis.forEach(li => {
                const text = li.textContent.replace('●', '').trim();
                if (text && text !== "Complete the assessment to see analysis." && text !== "No significant opportunities identified yet.") {
                    summaryData.push([text, "", "", "", ""]);
                }
            });

            // Calcular porcentajes y ratings
            for (let i = 5; i <= 8; i++) {
                if (summaryData[i] && summaryData[i][1] !== undefined) {
                    const score = summaryData[i][1];
                    const max = summaryData[i][2];
                    const percentage = max > 0 ? ((score / max) * 100).toFixed(1) + "%" : "0%";
                    summaryData[i][3] = percentage;

                    // Añadir rating
                    if (i === 8) { // Total
                        const totalScore = score;
                        let rating = '';
                        if (totalScore < 300) rating = 'Getting Started';
                        else if (totalScore < 500) rating = 'Developing';
                        else if (totalScore < 700) rating = 'Mature';
                        else rating = 'Role Model';
                        summaryData[i][4] = rating;
                    } else {
                        summaryData[i][4] = (score / max) >= 0.7 ? 'Good' : (score / max) >= 0.5 ? 'Fair' : 'Needs Improvement';
                    }
                }
            }

            const ws1 = XLSX.utils.aoa_to_sheet(summaryData);
            ws1['!cols'] = [{ wch: 35 }, { wch: 12 }, { wch: 12 }, { wch: 12 }, { wch: 18 }];

            // Formatear celdas
            ws1['A1'].s = { font: { bold: true, size: 16 }, alignment: { horizontal: 'center' } };
            ws1['A2'].s = { font: { italic: true }, alignment: { horizontal: 'center' } };

            // Fusionar celdas para el título
            ws1['!merges'] = [
                { s: { r: 0, c: 0 }, e: { r: 0, c: 4 } },
                { s: { r: 1, c: 0 }, e: { r: 1, c: 4 } }
            ];

            XLSX.utils.book_append_sheet(wb, ws1, "Summary");

            // HOJA 2: PUNTUACIONES DETALLADAS
            const detailedData = [];
            detailedData.push(["CRITERION", "SUB-CRITERION / QUESTION", "SCORE (%)", "WEIGHT", "POINTS"]);

            criteriaData.forEach(c => {
                const totalScore = c.subCriteria.reduce((sum, sub) => sum + sub.score, 0) / c.subCriteria.length;
                const points = (totalScore / 100) * c.weight;

                detailedData.push([c.name, "OVERALL SCORE", totalScore.toFixed(1), c.weight, points.toFixed(1)]);

                c.subCriteria.forEach(sub => {
                    detailedData.push(["", sub.q, sub.score, "", ""]);
                });

                detailedData.push([]);
            });

            const ws2 = XLSX.utils.aoa_to_sheet(detailedData);
            ws2['!cols'] = [{ wch: 40 }, { wch: 60 }, { wch: 12 }, { wch: 12 }, { wch: 12 }];
            XLSX.utils.book_append_sheet(wb, ws2, "Detailed Scores");

            // HOJA 3: PLAN DE ACCIÓN
            const notesData = [
                ["NOTES & ACTION PLAN"],
                [""],
                [document.getElementById('actionPlan').value || "No notes entered."],
                [""],
                ["", "", "", "", ""],
                ["ASSESSMENT PROFILE CHART", "", "", "", ""],
                ["", "", "", "", ""]
            ];

            const ws3 = XLSX.utils.aoa_to_sheet(notesData);
            ws3['!cols'] = [{ wch: 100 }];

            // Formatear celdas
            ws3['A1'].s = { font: { bold: true, size: 14 } };
            ws3['A6'].s = { font: { bold: true } };

            XLSX.utils.book_append_sheet(wb, ws3, "Action Plan");

            // HOJA 4: GRÁFICO
            const chartData = [["Organizational Excellence Profile"]];
            const ws4 = XLSX.utils.aoa_to_sheet(chartData);
            ws4['!cols'] = [{ wch: 30 }];

            // Convertir gráfico a imagen base64
            const chartBase64 = excellenceChart.toBase64Image();

            // Nota: XLSX.js no soporta imágenes directamente, pero podemos agregar la imagen como un objeto
            // En versiones más recientes, se puede usar el complemento de imágenes
            // Para este ejemplo, crearemos una hoja de cálculo simple

            // Crear una hoja con datos del gráfico
            const chartPoints = [["Criterion", "Score (%)"]];
            criteriaData.forEach(c => {
                const totalScore = c.subCriteria.reduce((sum, sub) => sum + sub.score, 0) / c.subCriteria.length;
                chartPoints.push([c.shortName, totalScore.toFixed(1)]);
            });

            const wsChart = XLSX.utils.aoa_to_sheet(chartPoints);
            wsChart['!cols'] = [{ wch: 20 }, { wch: 15 }];
            XLSX.utils.book_append_sheet(wb, wsChart, "Chart Data");

            // EXPORTAR
            XLSX.writeFile(wb, `Organizational_Maturity_Assessment_${new Date().toISOString().split('T')[0]}.xlsx`);

            // Mostrar mensaje de éxito
            alert("Report exported successfully! The Excel file contains 4 sheets: Summary, Detailed Scores, Action Plan, and Chart Data.");
        }

        function exportToJpg() {
            // Si los resultados no están visibles, mostrarlos primero
            if (!resultsVisible) {
                toggleResultsVisibility();
                // Esperar un momento para que se rendericen los resultados
                setTimeout(exportJpgWithData, 300);
            } else {
                exportJpgWithData();
            }
        }

        function exportJpgWithData() {
            const resultsContainer = document.getElementById('results-container');

            // Crear un contenedor temporal para la captura
            const tempContainer = document.createElement('div');
            tempContainer.style.background = 'white';
            tempContainer.style.padding = '20px';
            tempContainer.style.width = '800px';
            tempContainer.style.maxWidth = '90%';
            tempContainer.style.margin = '0 auto';
            tempContainer.style.fontFamily = 'Nunito, sans-serif';
            tempContainer.style.lineHeight = '1.6';
            tempContainer.style.color = '#333';
            tempContainer.style.position = 'absolute';
            tempContainer.style.left = '-9999px';
            tempContainer.style.top = '0';

            // Clonar el contenido de resultados
            const clone = resultsContainer.cloneNode(true);
            clone.classList.remove('results-hidden');
            tempContainer.appendChild(clone);

            // Agregar encabezado
            const header = document.createElement('div');
            header.innerHTML = `
                <div style="text-align: center; margin-bottom: 20px; padding-bottom: 20px; border-bottom: 2px solid #3498db;">
                    <h1 style="color: #2c3e50; margin: 0 0 10px 0;">Organizational Maturity Assessment</h1>
                    <p style="color: #7f8c8d; margin: 0;">Generated by Sigma Exacta - ${new Date().toLocaleDateString()}</p>
                </div>
            `;
            tempContainer.insertBefore(header, tempContainer.firstChild);

            document.body.appendChild(tempContainer);

            html2canvas(tempContainer, {
                scale: 2,
                logging: false,
                useCORS: true,
                backgroundColor: '#ffffff'
            }).then(canvas => {
                const link = document.createElement('a');
                link.href = canvas.toDataURL('image/jpeg', 0.9);
                link.download = `Organizational_Assessment_${new Date().toISOString().split('T')[0]}.jpg`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

                document.body.removeChild(tempContainer);
            }).catch(error => {
                console.error('Error exporting to JPG:', error);
                alert('Error exporting to JPG. Please try again.');
                document.body.removeChild(tempContainer);
            });
        }
    </script>

    <script src="dexie.min.js"></script>
    <script src="db-sigma.js"></script>

</body>

</html>