<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRIZ Problem Solving Tool & 40 Principles | Sigma Exacta</title>
    <meta name="description"
        content="Free online TRIZ tool to solve complex problems with a structured methodology. Identify contradictions, use the 40 inventive principles, and apply Su-Field analysis for innovation.">
    <meta name="keywords"
        content="Open Source, Free Software,TRIZ, Theory of Inventive Problem Solving, contradiction matrix, 40 inventive principles, Genrich Altshuller, Su-Field analysis, problem solving, innovation tool, technical contradiction, physical contradiction, contradiction matrix, 76 standard solutions">
    <link rel="canonical" href="https://sigmaexacta.com/triz" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="sigma-exacta-icon.jpg" type="image/jpeg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;800&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="styles.css">

    <style>
        /* ===== ESTILOS DE LA BARRA DE NAVEGACIÓN (COPIADOS DE INDEX.HTML) ===== */
        .top-bar {
            position: sticky;
            top: 0;
            z-index: 1001;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background-color: #222;
        }

        .logo-text,
        .navigation .nav-link,
        .nav-toggle {
            color: #fff;
        }

        .nav-toggle {
            display: none;
            font-size: 1.5rem;
            background: none;
            border: none;
            cursor: pointer;
        }

        .navigation .nav-menu {
            display: flex;
            list-style: none;
            margin: 0;
            padding: 0;
            align-items: center;
        }

        .navigation .nav-link {
            padding: 10px 15px;
            text-decoration: none;
            font-weight: 600;
            display: block;
        }

        .navigation .nav-link i {
            margin-left: 5px;
            transition: transform 0.3s ease;
        }

        .nav-item-dropdown {
            position: relative;
        }

        .dropdown-menu {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            background-color: #fff;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
            border-radius: 5px;
            z-index: 1000;
            min-width: 600px;
            padding: 20px;
        }

        .dropdown-menu a,
        .dropdown-menu h4 {
            color: #333;
        }

        .dropdown-link:hover {
            background-color: #f1f1f1;
        }

        .dropdown-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
        }

        .nav-item-dropdown:hover>.dropdown-menu {
            display: block;
        }

        @media (max-width: 992px) {
            .nav-toggle {
                display: block;
            }

            .navigation .nav-menu {
                display: none;
                flex-direction: column;
                position: absolute;
                top: 100%;
                left: 0;
                width: 100%;
                background-color: #fff;
                border-top: 1px solid #eee;
            }

            .navigation .nav-menu .nav-link {
                color: #333;
            }

            .navigation .nav-menu.show-menu {
                display: flex;
            }

            .navigation .nav-item {
                width: 100%;
                text-align: left;
            }

            .nav-item-dropdown>.nav-link {
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .dropdown-menu {
                display: none;
                position: static;
                width: 100%;
                box-shadow: none;
                border-top: 1px solid #f0f0f0;
                padding: 10px 0 10px 30px;
                min-width: unset;
                background-color: #f9f9f9;
            }

            .dropdown-menu.show-submenu {
                display: block;
            }

            .nav-item-dropdown:hover>.dropdown-menu {
                display: none;
            }

            .nav-item-dropdown.active:hover>.dropdown-menu {
                display: block;
            }

            .nav-item-dropdown.active>.nav-link i {
                transform: rotate(180deg);
            }
        }

        /* Estilos de la página (modificado el .header h1 para incluir flexbox) */
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            font-size: 16px;
            --professional-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --professional-border: 1px solid #e1e5e9;
        }

        *,
        ::after,
        ::before {
            box-sizing: border-box
        }

        html {
            scroll-behavior: smooth
        }

        body {
            font-family: 'Nunito', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            color: #333;
            background-color: #f8fafc;
            line-height: 1.6;
        }

        /* MODIFICACIÓN 1: Se ha eliminado max-width:1000px y margin:0 auto para que ocupe el ancho completo */
        .main-content-wrapper {
            padding: 1.25rem
        }

        .header {
            margin-bottom: 1.25rem;
            padding-bottom: 1rem;
            border-bottom: var(--professional-border);
            text-align: center;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 8px;
            padding: 1.5rem;
        }

        .header h1 {
            color: var(--primary-color);
            font-size: clamp(1.5rem, 4vw, 1.8rem);
            margin: .5rem 0;
            font-weight: 800;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .header .header-subtitle {
            font-size: 1.1rem;
            color: #4a5568;
            margin: 0;
            font-weight: 400;
        }

        .content-block {
            border: var(--professional-border);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            background-color: #fff;
            box-shadow: var(--professional-shadow);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .content-block:hover {
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.12);
        }

        .content-block h2 {
            font-size: 1.5em;
            margin-top: 0;
            margin-bottom: 1.25rem;
            color: var(--primary-color);
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: .6rem;
            font-weight: 800;
        }

        .content-block h2 .fas {
            margin-right: .75rem
        }

        .infographic-flow {
            display: flex;
            justify-content: space-between;
            align-items: stretch;
            margin-top: 1.5rem;
            text-align: center;
            flex-wrap: wrap;
            gap: .6rem;
        }

        .flow-step {
            flex: 1;
            min-width: 150px;
            padding: 1rem;
            border: var(--professional-border);
            border-radius: 8px;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            transition: transform .2s, box-shadow .2s;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .flow-step:hover {
            transform: translateY(-5px);
            box-shadow: var(--professional-shadow);
        }

        .flow-step .fas {
            font-size: 1.8rem;
            color: var(--primary-color);
            margin-bottom: .6rem;
        }

        .flow-step strong {
            display: block;
            font-size: 1.1rem;
            color: var(--primary-color);
            font-weight: 600;
        }

        .flow-step span {
            font-size: .9em;
            color: #4a5568;
        }

        .flow-arrow {
            font-size: 2rem;
            color: var(--secondary-color);
            margin: auto .6rem;
            flex-grow: 0;
        }

        .instructions-box ul {
            margin: .6rem 0 0 0;
            padding-left: 1.25rem
        }

        .instructions-box li {
            margin-bottom: .5rem;
            line-height: 1.6
        }

        .solver-step {
            border: var(--professional-border);
            border-radius: 8px;
            padding: 1.25rem;
            margin-bottom: 1.25rem;
            background-color: #fdfdfd;
        }

        .solver-step h3 {
            font-size: 1.2em;
            margin-top: 0;
            margin-bottom: 1rem;
            color: var(--primary-color);
            border-bottom: 1px solid #eee;
            padding-bottom: .6rem;
            font-weight: 800;
        }

        .form-group {
            margin-bottom: 1.25rem
        }

        label {
            color: var(--primary-color);
            font-weight: 600;
            display: block;
            margin-bottom: .5rem;
        }

        input[type=text],
        select,
        textarea {
            width: 100%;
            padding: .6rem;
            border: var(--professional-border);
            border-radius: 4px;
            transition: border .3s, box-shadow .3s;
            font-size: 1rem;
            font-family: 'Nunito', sans-serif;
            background-color: #fff;
        }

        button:focus-visible,
        input:focus,
        select:focus,
        textarea:focus {
            outline: 0;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, .2);
        }

        textarea {
            min-height: 90px;
            resize: vertical;
        }

        .radio-group label {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 400;
            margin-bottom: .6rem;
            cursor: pointer;
        }

        .radio-group input {
            width: auto;
            margin: 0
        }

        button {
            background-color: var(--secondary-color);
            color: #fff;
            padding: .7rem 1.25rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 1rem;
            transition: background-color .3s, transform 0.2s, box-shadow 0.2s;
            font-family: 'Nunito', sans-serif;
            font-weight: 600;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .btn-success {
            background-color: var(--success-color)
        }

        .btn-success:hover {
            background-color: #219653
        }

        .btn-warning {
            background-color: var(--warning-color)
        }

        .btn-warning:hover {
            background-color: #d4ac0d
        }

        #solve-button {
            width: 100%;
            padding: 1rem;
            font-size: 1.2em;
            font-weight: 700;
            margin-top: 1.25rem;
        }

        #solve-button:hover {
            background-color: #2980b9
        }

        .hidden {
            display: none
        }

        #results-container {
            border: 2px solid var(--success-color);
            background-color: #f8fef8;
            border-radius: 8px;
            padding: 1.25rem;
            margin-top: 1.5rem;
            box-shadow: var(--professional-shadow);
        }

        #results-container h3 {
            color: var(--success-color);
            font-weight: 800;
        }

        .principle-item {
            border-left: 3px solid var(--secondary-color);
            padding-left: 1rem;
            margin-bottom: 1rem;
        }

        .principle-item strong {
            color: var(--dark-color);
            font-size: 1.05em;
            font-weight: 600;
        }

        .results-actions {
            margin-top: 1.25rem;
            padding-top: 1.25rem;
            border-top: 1px solid #eee;
        }

        footer {
            padding: 2rem 1.25rem;
            text-align: center;
        }

        .disclaimer-note {
            margin-top: 2rem;
            padding: 0 1rem;
            font-size: .8rem;
            color: #777;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        @media (max-width: 992px) {
            .infographic-flow {
                flex-direction: column;
                align-items: center
            }

            .flow-arrow {
                transform: rotate(90deg);
                margin: 1rem 0
            }
        }

        /* ===== ESTILOS RESPONSIVOS PARA MÓVILES ===== */
        @media (max-width: 768px) {

            /* Ajustar diagramas Su-Field para móviles */
            .sufield-svg-container {
                width: 100% !important;
                max-width: 280px !important;
                height: 240px !important;
                margin: 0 auto;
            }

            .sufield-triangle-container {
                padding: 1rem !important;
                margin: 1rem 0 !important;
            }

            /* Ajustar transformación de solución para móviles */
            .solution-transformation {
                flex-direction: column;
                gap: 1rem;
            }

            .transition-arrow {
                transform: rotate(90deg);
                margin: 0.5rem 0;
            }

            .before-state,
            .after-state {
                width: 100% !important;
            }

            /* Ajustar textos en resultados */
            #results-container {
                padding: 1rem !important;
                overflow-wrap: break-word;
                word-wrap: break-word;
            }

            #results-container .solver-step,
            #results-container .principle-card,
            #results-container .solution-card {
                padding: 1rem !important;
                margin-bottom: 1rem !important;
            }

            #results-container h3,
            #results-container h4,
            #results-container h5 {
                word-wrap: break-word;
                overflow-wrap: break-word;
            }

            /* Ajustar sistema Su-Field en móviles */
            .sufield-system-fields {
                grid-template-columns: 1fr !important;
                gap: 0.5rem !important;
            }

            .sufield-system {
                padding: 1rem !important;
            }

            /* Ajustar matriz de contradicciones */
            .matrix-container {
                overflow-x: auto;
                font-size: 0.7rem;
            }

            .matrix-table th,
            .matrix-table td {
                padding: 4px 2px !important;
                font-size: 0.65rem;
            }

            /* Ajustar flujo de infografía */
            .infographic-flow {
                gap: 0.5rem;
            }

            .flow-step {
                min-width: 120px;
                padding: 0.8rem;
            }

            .flow-step .fas {
                font-size: 1.4rem;
            }

            .flow-step strong {
                font-size: 1rem;
            }

            .flow-step span {
                font-size: 0.8rem;
            }
        }

        @media (max-width: 480px) {

            /* Ajustes adicionales para pantallas muy pequeñas */
            .main-content-wrapper {
                padding: 0.5rem !important;
            }

            .content-block {
                padding: 1rem !important;
                margin-bottom: 1rem !important;
            }

            .solver-step {
                padding: 1rem !important;
            }

            .header {
                padding: 1rem !important;
            }

            /* Textos más pequeños en diagramas */
            .sufield-svg-container .node-type {
                font-size: 0.55rem !important;
            }

            .sufield-svg-container .node-label {
                font-size: 0.65rem !important;
            }

            /* Botones en móviles */
            button {
                padding: 0.8rem 1rem !important;
                margin: 3px !important;
                font-size: 0.9rem !important;
            }

            #solve-button {
                padding: 0.9rem !important;
                font-size: 1.1rem !important;
            }
        }

        /* NUEVOS ESTILOS SOLICITADOS PARA EL ICONO EN H1 */
        .triz-h1-icon-style {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            width: 35px;
            height: 35px;
            border-radius: 6px;
            /* Borde cuadrado suave */
            background-color: #fc6d26;
            /* Color de TRIZ (naranja/rojizo) */
            color: #fff;
            font-size: 1.2rem;
            margin-right: 0.75rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* ===== NUEVOS ESTILOS PARA CONTRADICCIONES FÍSICAS MEJORADAS ===== */
        .physical-strategy-guide {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 5px solid var(--secondary-color);
            padding: 1.5rem;
            margin: 1rem 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .strategy-title {
            font-weight: bold;
            color: var(--primary-color);
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
        }

        .strategy-description {
            margin-bottom: 1rem;
            line-height: 1.5;
        }

        .strategy-example {
            background: rgba(255, 255, 255, 0.7);
            padding: 1rem;
            border-radius: 5px;
            font-style: italic;
            border-left: 3px solid var(--accent-color);
        }

        .physical-principle-card {
            border: var(--professional-border);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            background: #fff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .physical-principle-card:hover {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .principle-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .principle-number {
            background: var(--secondary-color);
            color: white;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .principle-name {
            font-weight: bold;
            color: var(--primary-color);
            font-size: 1.1rem;
            flex: 1;
            margin-left: 10px;
        }

        .principle-description {
            margin-bottom: 1rem;
            line-height: 1.5;
        }

        .principle-example {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 5px;
            border-left: 3px solid var(--warning-color);
        }

        .example-title {
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        /* ===== NUEVOS ESTILOS MEJORADOS PARA DIAGRAMAS SU-FIELD CON FLECHAS QUE TERMINAN EN LOS CÍRCULOS ===== */
        .sufield-triangle-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 1.5rem 0;
            padding: 1.5rem;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            border: var(--professional-border);
            position: relative;
            overflow: hidden;
        }

        .sufield-svg-container {
            width: 320px;
            /* Aumentado ligeramente */
            height: 280px;
            /* Aumentado ligeramente */
            position: relative;
        }

        .sufield-svg {
            width: 100%;
            height: 100%;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
        }

        .triangle-path {
            fill: rgba(255, 255, 255, 0.8);
            stroke: #dee2e6;
            stroke-width: 2;
            stroke-dasharray: 5, 5;
        }

        /* Estilo mejorado para las flechas que terminan en los círculos */
        .interaction-line {
            stroke: #3498db;
            stroke-width: 2;
            marker-end: url(#arrowhead);
        }

        .problem-interaction {
            stroke: #e74c3c;
            stroke-width: 3;
        }

        .sufield-node {
            cursor: default;
            transition: none;
        }

        /* Eliminar hover effects */
        .sufield-node:hover {
            transform: none;
            filter: none;
        }

        .s1-node {
            fill: #3498db;
        }

        .s2-node {
            fill: #e74c3c;
        }

        .f-node {
            fill: #f39c12;
        }

        .node-label {
            font-weight: bold;
            font-size: 0.75rem;
            /* Reducido para mejor ajuste */
            text-anchor: middle;
            dominant-baseline: middle;
            pointer-events: none;
            fill: #1a5632;
            filter: url(#text-background);
        }

        .node-type {
            font-size: 0.65rem;
            /* Reducido para mejor ajuste */
            text-anchor: middle;
            fill: #4a5568;
            font-weight: 600;
        }

        /* NUEVO: Estilo para el indicador de problema con iconos */
        .problem-indicator-icon {
            font-size: 1.8rem;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
            animation: subtle-pulse 3s infinite;
        }

        @keyframes subtle-pulse {
            0% {
                opacity: 0.8;
            }

            50% {
                opacity: 1;
            }

            100% {
                opacity: 0.8;
            }
        }

        /* Estilos para diferentes tipos de problemas en SVG */
        .problem-insufficient .interaction-line {
            stroke-dasharray: 5, 5;
            stroke: #3498db;
        }

        .problem-harmful .interaction-line {
            stroke: #e74c3c;
            stroke-width: 3;
        }

        .problem-difficult .interaction-line {
            stroke-dasharray: 2, 2;
            stroke: #f39c12;
        }

        .problem-missing .interaction-line {
            stroke-dasharray: 10, 5;
            stroke: #9b59b6;
        }

        .problem-excessive .interaction-line {
            stroke: #e67e22;
            stroke-width: 4;
        }

        .problem-inefficient .interaction-line {
            stroke: #1abc9c;
            stroke-width: 2;
            stroke-dasharray: 1, 0;
        }

        /* ===== NUEVOS ESTILOS PARA SOLUCIONES ESTÁNDAR CON DIAGRAMAS ===== */
        .standard-solution-visual {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            border-left: 5px solid var(--secondary-color);
        }

        .solution-transformation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .before-state,
        .after-state {
            text-align: center;
            flex: 1;
        }

        .state-label {
            margin-top: 0.5rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .transition-arrow {
            font-size: 2rem;
            color: var(--secondary-color);
            margin: 0 1rem;
        }

        .problem-state .triangle-path {
            fill: rgba(255, 230, 230, 0.8);
        }

        .solution-state .triangle-path {
            fill: rgba(230, 255, 230, 0.8);
        }

        .solution-description {
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .solution-description h5 {
            margin-top: 0;
            color: var(--primary-color);
            border-bottom: 1px solid #dee2e6;
            padding-bottom: 0.5rem;
        }

        /* ===== NUEVOS ESTILOS PARA MATRIZ VISUAL MEJORADA ===== */
        .matrix-container {
            margin-top: 1rem;
            overflow-x: auto;
            border: var(--professional-border);
            border-radius: 8px;
            padding: 1rem;
            background: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .matrix-table {
            border-collapse: collapse;
            width: 100%;
            font-size: 0.75rem;
        }

        .matrix-table th,
        .matrix-table td {
            border: 1px solid #e0e0e0;
            padding: 6px 4px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .matrix-table th {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            font-weight: bold;
            position: sticky;
            top: 0;
            min-width: 40px;
            height: 40px;
        }

        .matrix-table th:first-child {
            background: linear-gradient(135deg, #3498db, #2980b9);
            position: sticky;
            left: 0;
            z-index: 3;
        }

        .matrix-table td {
            background-color: #fafafa;
            height: 35px;
            position: relative;
        }

        .matrix-table td:hover {
            background-color: #e3f2fd;
            transform: scale(1.05);
            z-index: 2;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        .matrix-table .selected {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(39, 174, 96, 0.4);
        }

        .matrix-table .improving {
            background-color: #e8f5e9;
        }

        .matrix-table .worsening {
            background-color: #ffebee;
        }

        .principle-numbers {
            font-size: 0.7rem;
            line-height: 1.2;
            font-weight: bold;
        }

        .matrix-toggle {
            margin-bottom: 1rem;
            text-align: center;
        }

        /* ===== NUEVOS ESTILOS PARA ICONOS OPTIMIZADOS ===== */
        .principle-icon,
        .solution-icon,
        .class-icon {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            width: 24px;
            height: 24px;
            border-radius: 4px;
            margin-right: 8px;
            font-size: 0.9rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .principle-icon {
            background-color: #3498db;
            color: white;
        }

        .solution-icon {
            background-color: #9b59b6;
            color: white;
        }

        .class-icon {
            background-color: #e74c3c;
            color: white;
        }

        .principle-card {
            border: var(--professional-border);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            background: #fff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            border-left: 4px solid #3498db;
        }

        .principle-card:hover {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .principle-header {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .solution-card {
            border: var(--professional-border);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.5rem;
            background: #f8f9fa;
            transition: all 0.2s ease;
        }

        .solution-card:hover {
            background: #e9ecef;
        }

        .solution-header {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .class-header {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e74c3c;
        }

        /* MODIFICACIÓN 3: Iconos específicos para principios de contradicciones físicas */
        .physical-principle-icon {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            width: 32px;
            height: 32px;
            border-radius: 6px;
            margin-right: 12px;
            font-size: 1rem;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* MODIFICACIÓN 4: Iconos específicos para soluciones estándar */
        .standard-solution-icon {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            width: 28px;
            height: 28px;
            border-radius: 5px;
            margin-right: 10px;
            font-size: 0.9rem;
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* Iconos específicos para principios */
        .icon-segmentation {
            color: #3498db;
        }

        .icon-extraction {
            color: #e74c3c;
        }

        .icon-local-quality {
            color: #2ecc71;
        }

        .icon-asymmetry {
            color: #9b59b6;
        }

        .icon-combining {
            color: #f39c12;
        }

        .icon-universality {
            color: #1abc9c;
        }

        .icon-nesting {
            color: #34495e;
        }

        .icon-counterweight {
            color: #7f8c8d;
        }

        .icon-preliminary {
            color: #d35400;
        }

        .icon-prior-action {
            color: #c0392b;
        }

        /* Estilos para el sistema Su-Field */
        .sufield-system {
            border: var(--professional-border);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            background: #fdfdfd;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .sufield-system-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #eee;
        }

        .sufield-system-title {
            font-weight: bold;
            color: var(--primary-color);
            font-size: 1.1rem;
        }

        .sufield-system-fields {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        @media (max-width: 768px) {
            .sufield-system-fields {
                grid-template-columns: 1fr;
            }
        }

        /* Estilos para el selector de matriz */
        .matrix-version-selector {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            border-left: 4px solid #3498db;
        }

        .matrix-version-info {
            margin-top: 0.5rem;
            font-size: 0.9rem;
            color: #666;
            font-style: italic;
        }

        /* ===== NUEVOS ESTILOS PARA LA MATRIZ DE SOLUCIONES ESTÁNDAR ===== */
        .solutions-matrix {
            font-size: 0.7rem;
        }

        .solutions-matrix th {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 8px 4px;
            text-align: center;
            white-space: nowrap;
        }

        .solutions-matrix td {
            padding: 6px 4px;
            border: 1px solid #e0e0e0;
            vertical-align: top;
        }

        .matrix-applicable {
            background-color: #d4edda;
            color: #155724;
            text-align: center;
            font-weight: bold;
        }

        .solutions-matrix tr:hover td {
            background-color: #e3f2fd;
        }

        .solutions-matrix tr:hover .matrix-applicable {
            background-color: #c3e6cb;
        }

        #principles-toggle-container {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            margin: 1rem 0;
        }

        #principles-toggle-container button {
            margin: 0 auto;
            display: block;
        }

        /* ===== NUEVOS ESTILOS PARA TESE ===== */
        .tese-container {
            position: relative;
            width: 100%;
            height: 300px;
            margin: 20px 0;
            border: var(--professional-border);
            border-radius: 8px;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        }

        .tese-svg {
            width: 100%;
            height: 100%;
        }

        .s-curve {
            fill: none;
            stroke: #3498db;
            stroke-width: 3;
        }

        .stage-marker {
            fill: #e74c3c;
            stroke: #fff;
            stroke-width: 2;
            cursor: move;
            transition: all 0.3s ease;
        }

        .stage-marker:hover {
            fill: #c0392b;
            transform: scale(1.2);
        }

        .stage-label {
            font-size: 0.8rem;
            font-weight: bold;
            text-anchor: middle;
            fill: #2c3e50;
        }

        .stage-line {
            stroke: #95a5a6;
            stroke-width: 1;
            stroke-dasharray: 5, 5;
        }

        .tese-info {
            margin-top: 15px;
            padding: 15px;
            background: #fff;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }

        .trends-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .trends-table th,
        .trends-table td {
            border: 1px solid #e0e0e0;
            padding: 8px 12px;
            text-align: left;
        }

        .trends-table th {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            font-weight: bold;
        }

        .trends-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .trends-table tr:hover {
            background-color: #e3f2fd;
        }

        .recommended-trend {
            background-color: #d4edda !important;
            font-weight: bold;
        }

        /* ===== NUEVOS ESTILOS PARA ICONOS DE TENDENCIAS RECOMENDADAS ===== */
        .trend-icon-container {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .trend-icon {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            width: 28px;
            height: 28px;
            border-radius: 5px;
            margin-right: 10px;
            font-size: 0.9rem;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* ===== NUEVOS ESTILOS PARA ICONOS DE TENDENCIAS TESE ===== */
        .tese-trends-icons {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin: 1rem 0;
            flex-wrap: wrap;
        }

        .tese-trend-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            min-width: 80px;
        }

        .tese-trend-icon {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 50px;
            height: 50px;
            border-radius: 10px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            font-size: 1.3rem;
            margin-bottom: 0.5rem;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);
        }

        .tese-trend-name {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        /* Mejorar el filtro de fondo de texto */
        .text-background {
            fill: #f8f9fa;
            fill-opacity: 0.9;
            stroke: #dee2e6;
            stroke-width: 1;
        }
    </style>
</head>

<body>
    <div id="header-container"></div>

    <main class="main-content-wrapper">
        <header class="header">
            <h1><span class="triz-h1-icon-style"><i class="fas fa-brain"></i></span> Free Online Inventive Problem
                Solving (TRIZ) Tool</h1>
            <p class="header-subtitle">A data-driven method for systematic innovation and invention.</p>
        </header>

        <!-- What is TRIZ? - Corregido -->
        <div class="content-block">
            <h2><i class="fas fa-question-circle"></i> What is TRIZ?</h2>
            <div class="instructions-box">
                <ul>
                    <li><strong>TRIZ</strong> (Теория решения изобретательских задач), or "Theory of Inventive Problem
                        Solving,"
                        is a systematic, data-driven methodology for innovation developed by <strong>Genrich
                            Altshuller</strong> and his
                        colleagues. Unlike traditional brainstorming approaches, TRIZ is based on analyzing patterns in
                        millions
                        of patents to identify universal principles of invention that transcend specific industries and
                        technologies.</li>

                    <li>The core premise of TRIZ is that most inventive problems contain inherent
                        <strong>contradictions</strong>
                        - situations where improving one parameter of a system inevitably worsens another. By
                        systematically
                        identifying and resolving these contradictions breakthrough solutions can be systematically
                        discovered across all technical fields (using the <strong>Contradiction Matrix</strong>). For
                        highly complex challenges, the <strong>ARIZ</strong> (Algorithm of Inventive Problem Solving)
                        provides a detailed,
                        step-by-step procedure for tackling the problem and resolving <strong>physical
                            contradictions</strong> (where a single
                        component requires
                        two opposing properties simultaneously). Furthermore, the <strong>Su-Field Analysis</strong>
                        (Substance-Field) serves as
                        a graphical
                        model to simplify a technical system into interacting components (Substances and Fields),
                        allowing users to
                        systematically apply Inventive Standards to fix or improve ineffective interactions. Finally,
                        the <strong>LDST</strong>
                        (Laws of Development of Technical Systems) is a thinking framework that ensures comprehensive
                        problem resolution
                        by analyzing the evolution of technical systems through fundamental laws of development.
                    </li>
                </ul>
            </div>
        </div>

        <!-- History & Origin - Corregido -->
        <div class="content-block">
            <h2><i class="fas fa-history"></i> History & Origin</h2>
            <div class="instructions-box">
                <ul>
                    <li>TRIZ was developed by <strong>Genrich Altshuller</strong> beginning in 1946 while working as a
                        patent
                        examiner in the Soviet Navy. After analyzing thousands of patents across diverse technical
                        fields, he
                        discovered that inventive problems, regardless of their specific domain, were solved using a
                        surprisingly small set of universal principles and patterns.</li>

                    <li>Altshuller's revolutionary insight was that <strong>innovation follows predictable
                            patterns</strong>
                        rather than being random acts of genius. His team systematically analyzed over 200,000 patents
                        to codify
                        these patterns into the foundational TRIZ tools that form the basis of the methodology today.
                    </li>

                    <li><strong>Key Historical Contributions:</strong>
                        <ul>
                            <li><strong>Genrich Altshuller (1946-1985)</strong>: Developed the core TRIZ framework
                                including the
                                40
                                Principles, Contradiction Matrix, and the ARIZ algorithm for complex problem solving
                            </li>
                            <li><strong>Boris Zlotin & Alla Zusman (1980s-1990s)</strong>: Advanced LDST (Laws of
                                Development of
                                Technical Systems) and expanded TRIZ applications</li>
                            <li><strong>Vladimir Petrov (1990s-2000s)</strong>: Expanded the 76 Standard Solutions and
                                refined
                                the
                                Su-Field methodology</li>
                            <li><strong>Victor Fey & Eugene Rivin (1990s)</strong>: Adapted TRIZ for Western audiences
                                and
                                industrial applications</li>
                            <li><strong>Simon Litvin (2000s)</strong>: Developed modern physical contradiction
                                resolution
                                methods
                                and separation principles</li>
                            <li><strong>Valeri Souchkov & Michael Orloff (2000s)</strong>: Refined function analysis and
                                Su-Field
                                modeling techniques</li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>

        <!-- TRIZ Methodology & Tools - Corregido -->
        <div class="content-block">
            <h2><i class="fas fa-toolbox"></i> TRIZ Methodology & Tools</h2>
            <div class="instructions-box">
                <ul>
                    <li>The TRIZ methodology provides a structured approach to problem solving that guides innovators
                        through a
                        systematic process of analyzing problems, identifying contradictions, and applying proven
                        solution
                        patterns. The methodology integrates several powerful tools that work together to transform
                        seemingly
                        intractable problems into solvable challenges.</li>

                    <li><strong>LDST - Laws of Development of Technical Systems</strong><br>
                        LDST identifies fundamental laws that govern how technical systems evolve over time, helping
                        innovators
                        understand system dynamics and identify natural evolution paths based on Altshuller's original
                        framework.</li>

                    <li><strong>Ideal Final Result (IFR)</strong><br>
                        The IFR is a powerful concept that defines the perfect solution where the system performs its
                        function
                        without any drawbacks, costs, or harmful effects. Formulating the IFR helps innovators break
                        psychological inertia and focus on the essential function rather than being constrained by
                        existing
                        implementations.</li>

                    <li><strong>Technical Contradictions</strong><br>
                        Technical Contradictions occur when improving one parameter of a system causes another parameter
                        to
                        worsen.
                        For example, making a car stronger typically makes it heavier. These contradictions are resolved
                        using
                        the
                        <strong>Contradiction Matrix</strong> and <strong>40 Inventive Principles</strong>, which
                        provide
                        specific
                        guidance on how to overcome the trade-off.
                    </li>

                    <li><strong>40 Inventive Principles</strong><br>
                        The 40 Principles represent the most common patterns of invention found across all technical
                        fields,
                        from
                        Segmentation and Asymmetry to Phase Transitions and Composite Materials. Each principle provides
                        concrete strategies for transforming systems to resolve contradictions and achieve breakthrough
                        improvements.</li>

                    <li><strong>Contradiction Matrix</strong><br>
                        The matrix systematically maps 39 improving parameters against 39 worsening parameters to
                        suggest the
                        most relevant principles for resolving specific technical contradictions. Modern versions (like
                        the 2003
                        matrix) expand this to 48 parameters for greater precision and applicability to contemporary
                        engineering
                        challenges.</li>

                    <li><strong>Physical Contradictions</strong><br>
                        Physical Contradictions occur when a single parameter requires opposite states or properties.
                        For
                        example,
                        a coffee cup needs to be hot to keep coffee warm but cool to hold comfortably. These are
                        resolved using
                        <strong>Separation Principles</strong> (Separation in Space, Time, Condition, and System Level)
                        that
                        allow
                        the contradictory requirements to be satisfied simultaneously.
                    </li>

                    <li><strong>Su-Field Analysis</strong><br>
                        Developed from Altshuller's work on substance-field modeling, Su-Field analysis represents any
                        technical
                        system as interactions between three fundamental elements:
                        <ul>
                            <li><strong>Substance 1 (S1)</strong>: The object being acted upon or transformed</li>
                            <li><strong>Substance 2 (S2)</strong>: The tool performing the action or causing the
                                transformation
                            </li>
                            <li><strong>Field (F)</strong>: The energy or force causing the interaction between S1 and
                                S2</li>
                        </ul>
                        The <strong>76 Standard Solutions</strong> provide specific transformations for improving or
                        resolving
                        problems in Su-Field systems, categorized into five classes from building complete systems to
                        simplification strategies. This systematic approach ensures that even complex system
                        interactions can be
                        analyzed and improved methodically.
                    </li>
                </ul>
            </div>
        </div>

        <!-- How to Use This Tool - Mantenido igual -->
        <div class="content-block">
            <h2><i class="fas fa-tools"></i> How to Use This Tool</h2>
            <div class="instructions-box">
                <ul>
                    <li><strong>Load Example:</strong> Click "Load Next Example" to see a variety of pre-filled sample
                        problems with different characteristics.</li>
                    <li><strong>Step 1 - LDST Analysis:</strong> Select a fundamental law of technical system
                        development to get strategic guidance.</li>
                    <li><strong>Step 2 - Define the Problem:</strong> Describe the system, its primary useful function,
                        and main drawback in simple, clear terms.</li>
                    <li><strong>Step 3 - Formulate Ideal Final Result (IFR):</strong> Define the ideal solution where
                        the system performs its function without the drawback, costs, or harmful effects.</li>
                    <li><strong>Step 4 - Identify the Core Contradiction:</strong> Select whether it's a technical
                        contradiction (improving one feature worsens another) or physical contradiction (one feature
                        needs opposite properties). Use the matrix or separation principles accordingly.</li>
                    <li><strong>Step 5 - Su-Field Analysis:</strong> Model the problem as interactions between
                        substances (S1, S2) and fields (F). Identify the problem type and get standard solutions.</li>
                    <li><strong>Generate Solutions:</strong> Click "Solve Problem & Generate Report" to receive
                        inventive principles tailored to your contradiction.</li>
                    <li><strong>Export:</strong> Once the report is generated, you can export it to Excel for your
                        records and further analysis.</li>
                </ul>

                <div class="infographic-flow">
                    <div class="flow-step"><i class="fas fa-project-diagram"></i><strong>1. LDST
                            Analysis</strong><span>Apply fundamental laws of technical systems</span></div>
                    <div class="flow-arrow"><i class="fas fa-long-arrow-alt-right"></i></div>
                    <div class="flow-step"><i class="fas fa-tasks"></i><strong>2. Define Problem</strong><span>Analyze
                            the system and its drawback</span></div>
                    <div class="flow-arrow"><i class="fas fa-long-arrow-alt-right"></i></div>
                    <div class="flow-step"><i class="fas fa-rocket"></i><strong>3. Formulate IFR</strong><span>Define
                            the Ideal Final Result</span></div>
                    <div class="flow-arrow"><i class="fas fa-long-arrow-alt-right"></i></div>
                    <div class="flow-step"><i class="fas fa-exchange-alt"></i><strong>4. Identify
                            Contradiction</strong><span>Find the core technical or physical conflict</span></div>
                    <div class="flow-arrow"><i class="fas fa-long-arrow-alt-right"></i></div>
                    <div class="flow-step"><i class="fas fa-atom"></i><strong>5. Su-Field Analysis</strong><span>Model
                            system interactions and apply standard solutions</span></div>
                </div>
            </div>
        </div>

        <div class="content-block">
            <h2><i class="fas fa-cogs"></i> TRIZ Problem Solver</h2>
            <div style="text-align: center; margin-bottom: 20px;">
                <button class="btn-success" onclick="loadExample()"><i class="fas fa-magic"></i> Load Next
                    Example</button>
                <button class="btn-warning" onclick="resetTool()"><i class="fas fa-sync-alt"></i> Reset Tool</button>
            </div>

            <div class="solver-step" style="background-color: #f8f9fa; border-left: 4px solid #3498db;">
                <h4><i class="fas fa-lightbulb"></i> Example Problems</h4>
                <p><strong>Current Example:</strong> <span id="current-example-description">Bicycle Frame - Law of
                        Ideality example</span></p>
                <p><em>Click "Load Next Example" to cycle through different scenarios with varying system laws.</em>
                </p>
            </div>

            <!-- MODIFICADO: Sección LDST sin selector de ley específica -->
            <div class="solver-step" id="step-ldst">
                <h3><i class="fas fa-project-diagram"></i> Step 1: Laws of Development of Technical Systems (LDST)</h3>
                <p>Select the life cycle stage of your system to get the most relevant development laws according to
                    Altshuller's classical framework.</p>

                <!-- Selector de fase de vida -->
                <div class="form-group">
                    <label for="lifecycle-stage">System Life Cycle Stage:</label>
                    <select id="lifecycle-stage" onchange="updateLDSTRecommendations()">
                        <option value="birth">Birth (Introduction Phase)</option>
                        <option value="growth">Growth Phase</option>
                        <option value="maturity">Maturity Phase</option>
                        <option value="decline">Decline Phase</option>
                        <option value="transition">Transition to New System</option>
                    </select>
                    <!-- El elemento ldst-recommendation-info se creará dinámicamente aquí -->
                </div>

                <div style="text-align: center; margin-top: 15px;">
                    <button class="btn-success" onclick="toggleLawsTable()"><i class="fas fa-table"></i> Show/Hide All
                        LDST Laws</button>
                </div>

                <div id="laws-table-container" class="hidden">
                    <div class="content-block">
                        <h4><i class="fas fa-graduation-cap"></i> Laws of Development of Technical Systems (LDST)</h4>
                        <p style="margin-bottom: 1.5rem; font-style: italic; font-weight: bold;">
                            Source: Altshuller, G. S. (1984). Creativity as an Exact Science: The Theory of the Solution
                            of Inventive Problems.
                        </p>
                        <div style="overflow-x: auto;">
                            <table class="trends-table">
                                <thead>
                                    <tr>
                                        <th>Law #</th>
                                        <th>Name</th>
                                        <th>Description</th>
                                        <th>Key Principles</th>
                                        <th>Examples</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr id="law-1">
                                        <td><i class="fas fa-cube"></i> 1</td>
                                        <td>System Integrity</td>
                                        <td>System must have all essential parts and minimal connections</td>
                                        <td>Completeness, Conductivity, Coordination</td>
                                        <td>Combustion engine, writing system</td>
                                    </tr>
                                    <tr id="law-2">
                                        <td><i class="fas fa-bolt"></i> 2</td>
                                        <td>Energy Conductivity</td>
                                        <td>Energy must flow unobstructed through all parts</td>
                                        <td>Eliminate intermediaries, Increase conductivity</td>
                                        <td>Copper wires, gears, fiber optics</td>
                                    </tr>
                                    <tr id="law-3">
                                        <td><i class="fas fa-music"></i> 3</td>
                                        <td>Harmony</td>
                                        <td>Parts coordinated in rhythm, frequency and structure</td>
                                        <td>Synchronization, Resonance</td>
                                        <td>4-stroke engine, multi-core processors</td>
                                    </tr>
                                    <tr id="law-4" class="recommended-trend">
                                        <td><i class="fas fa-rocket"></i> 4</td>
                                        <td>Ideality</td>
                                        <td>More functions with fewer resources and complexity</td>
                                        <td>Self-service, Multiple functions</td>
                                        <td>Smartphones, electric vehicles</td>
                                    </tr>
                                    <tr id="law-5">
                                        <td><i class="fas fa-tachometer-alt"></i> 5</td>
                                        <td>Uneven Development</td>
                                        <td>Parts develop at different rates creating contradictions</td>
                                        <td>Identify lagging subsystems</td>
                                        <td>Processors vs memory, batteries vs screens</td>
                                    </tr>
                                    <tr id="law-6">
                                        <td><i class="fas fa-expand-arrows-alt"></i> 6</td>
                                        <td>Transition to Supersystem</td>
                                        <td>Systems integrate into larger supersystems</td>
                                        <td>Integration, Expansion</td>
                                        <td>Internet, integrated transport</td>
                                    </tr>
                                    <tr id="law-7">
                                        <td><i class="fas fa-atom"></i> 7</td>
                                        <td>Transition to Micro-Level</td>
                                        <td>Development moves to microstructural levels and fields</td>
                                        <td>Fragmentation, Field utilization</td>
                                        <td>Transistors → nanochips, tools → nanobots</td>
                                    </tr>
                                    <tr id="law-8">
                                        <td><i class="fas fa-magnet"></i> 8</td>
                                        <td>Increased S-Field Complexity</td>
                                        <td>Evolution toward greater field and substance complexity</td>
                                        <td>Add new fields, Combine fields</td>
                                        <td>Mechanical → electrical → quantum</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div class="solver-step" id="step-1">
                <h3><i class="fas fa-tasks"></i> Step 2: Define the Problem</h3>
                <div class="form-group"><label for="problem-system">System/Object to improve?</label><input type="text"
                        id="problem-system" placeholder="e.g., A coffee mug"></div>
                <div class="form-group"><label for="problem-function">Primary useful function?</label><input type="text"
                        id="problem-function" placeholder="e.g., To hold hot liquid"></div>
                <div class="form-group"><label for="problem-harm">Main drawback?</label><input type="text"
                        id="problem-harm" placeholder="e.g., Burns the hand"></div>
            </div>
            <div class="solver-step" id="step-2">
                <h3><i class="fas fa-rocket"></i> Step 3: Formulate Ideal Final Result (IFR)</h3>
                <div class="form-group"><label for="ifr-formulation">The system <strong>itself</strong> performs the
                        function without the drawback:</label><textarea id="ifr-formulation"
                        placeholder="e.g., The coffee mug itself holds hot liquid and protects the hand."></textarea>
                </div>
            </div>
            <div class="solver-step" id="step-3">
                <h3><i class="fas fa-exchange-alt"></i> Step 4: Identify the Core Contradiction</h3>

                <div class="form-group radio-group">
                    <label><input type="radio" name="contradiction-type" value="technical"
                            onchange="toggleContradictionForms()"> <strong>Technical Contradiction:</strong> Improving
                        one feature makes another worse.</label>
                    <label><input type="radio" name="contradiction-type" value="physical"
                            onchange="toggleContradictionForms()"> <strong>Physical Contradiction:</strong> One feature
                        needs opposite properties.</label>
                </div>

                <div id="matrix-version-selector-container" class="matrix-version-selector hidden">
                    <div class="form-group">
                        <label for="matrix-version">TRIZ Matrix Version:</label>
                        <div class="radio-group" style="display: flex; gap: 20px; flex-wrap: wrap;">
                            <label>
                                <input type="radio" name="matrix-version" value="classic" checked
                                    onchange="changeMatrixVersion()">
                                <strong>Classic Matrix</strong> (39 parameters, 40 principles)
                            </label>
                            <label>
                                <input type="radio" name="matrix-version" value="2003" onchange="changeMatrixVersion()">
                                <strong>2003 Matrix</strong> (48 parameters, 40 principles)
                            </label>
                        </div>
                        <div class="matrix-version-info" id="matrix-version-info">
                            Using Classic TRIZ Matrix - The original 39x39 matrix. Altshuller, G. S. (1950-1980). 40
                            Principles: TRIZ Keys to Technical Innovation o The Innovation Algorithm:
                            TRIZ, Systematic Innovation and Technical Creativity.
                        </div>
                    </div>
                </div>

                <div id="technical-solver-block" class="hidden">
                    <div class="matrix-toggle">
                        <button class="btn-success" onclick="toggleMatrixView()"><i class="fas fa-table"></i> Show/Hide
                            Contradiction Matrix</button>
                    </div>

                    <div id="dropdown-view">
                        <div class="form-group"><label for="improving-feature">Feature to Improve:</label><select
                                id="improving-feature"></select></div>
                        <div class="form-group"><label for="worsening-feature">Feature that Worsens:</label><select
                                id="worsening-feature"></select></div>
                    </div>

                    <div id="matrix-view" class="hidden">
                        <p><strong>Click on a cell to select improving (row) and worsening (column) features. Hover your
                                cursor over the cell to see more information</strong>
                        </p>
                        <div class="matrix-container">
                            <table class="matrix-table" id="contradiction-matrix">
                            </table>
                        </div>
                        <div style="margin-top: 10px;">
                            <strong>Selected:</strong>
                            <span id="selected-improving">None</span> →
                            <span id="selected-worsening">None</span>
                        </div>
                    </div>
                </div>

                <div id="physical-solver-block" class="hidden">
                    <div class="form-group">
                        <label for="conflicting-parameter">Parameter with conflicting requirements?</label>
                        <input type="text" id="conflicting-parameter" placeholder="e.g., Temperature, Size, Visibility">
                    </div>

                    <div class="solver-step" id="physical-step-1">
                        <h4><i class="fas fa-cogs"></i> Step 1: Analyze Functions & Define OZ/OT</h4>
                        <div class="form-group">
                            <label>Define Operational Zones/Times (OZ/OT):</label>
                            <div class="radio-group">
                                <label><input type="radio" name="oz-definition" value="spatial"
                                        onchange="updatePhysicalStrategy()"> Spatial Zones (different locations)</label>
                                <label><input type="radio" name="oz-definition" value="temporal"
                                        onchange="updatePhysicalStrategy()"> Temporal Zones (different times)</label>
                                <label><input type="radio" name="oz-definition" value="conditional"
                                        onchange="updatePhysicalStrategy()"> Conditional Zones (different
                                    conditions)</label>
                                <label><input type="radio" name="oz-definition" value="system"
                                        onchange="updatePhysicalStrategy()"> System Levels (different system
                                    hierarchies)</label>
                            </div>
                        </div>
                    </div>

                    <div class="solver-step hidden" id="physical-step-2">
                        <h4><i class="fas fa-exchange-alt"></i> Step 2: Determine OZ/OT Interaction</h4>
                        <div class="form-group">
                            <label>Do the Operational Zones/Times intersect?</label>
                            <div class="radio-group">
                                <label><input type="radio" name="oz-intersection" value="intersect"
                                        onchange="updatePhysicalStrategy()"> Yes, OZ/OT INTERSECT (Use Satisfy
                                    strategy)</label>
                                <label><input type="radio" name="oz-intersection" value="no-intersect"
                                        onchange="updatePhysicalStrategy()"> No, OZ/OT do NOT intersect (Use Bypass
                                    strategy)</label>
                            </div>
                        </div>
                    </div>

                    <div class="solver-step hidden" id="physical-step-3">
                        <h4><i class="fas fa-object-group"></i> Step 3: Choose Separation Method</h4>
                        <div class="form-group">
                            <label>Select separation method:</label>
                            <div class="radio-group" id="separation-methods">
                            </div>
                        </div>
                    </div>

                    <div class="form-group" id="principles-toggle-container"
                        style="display: none; text-align: center; margin: 1rem 0;">
                        <button type="button" class="btn-success" onclick="togglePrinciplesTable()">
                            <i class="fas fa-table"></i> Show/Hide Physical Contradiction Matrix
                        </button>
                    </div>

                    <div class="hidden" id="principles-table-container">
                        <div class="content-block">
                            <h4><i class="fas fa-lightbulb"></i> Complete Physical Contradiction Principles Reference
                            </h4>
                            <div id="principles-table-content">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="solver-step" id="step-4">
                <h3><i class="fas fa-atom"></i> Step 5: Su-Field Analysis</h3>
                <p>Model your problem as interactions between substances (S1, S2) and fields (F). Each system can have
                    its own problem type.</p>

                <div id="sufield-systems-container">
                </div>

                <div class="form-group" style="margin-top: 10px;">
                    <button type="button" class="btn-success" onclick="addSuFieldSystem()"><i class="fas fa-plus"></i>
                        Add Su-Field System</button>
                </div>

                <div class="form-group" style="margin-top: 20px; text-align: center;">
                    <button type="button" class="btn-success" onclick="toggleSolutionsMatrix()">
                        <i class="fas fa-table"></i> Show/Hide 76 Standard Solutions Matrix
                    </button>
                </div>

                <div id="solutions-matrix-container" class="hidden">
                    <div id="solutions-matrix-content">
                    </div>
                </div>
            </div>
            <button id="solve-button" onclick="solveProblem()"><i class="fas fa-calculator"></i> Solve Problem &
                Generate Report</button>
            <div id="results-container" class="hidden"></div>
        </div>
    </main>
    <footer>
        <div class="disclaimer-note">
            <p><strong>Disclaimer:</strong> This tool is an educational implementation of the TRIZ (Theory of Inventive
                Problem Solving) methodology, originally developed by Genrich Altshuller. It is not affiliated with,
                sponsored by, or endorsed by any official TRIZ organizations. The principles and solutions suggested are
                for informational purposes only. We make no warranties regarding the effectiveness or novelty of any
                ideas generated. The user assumes full responsibility for the application and validation of concepts
                derived from this tool. Sigma Exacta and its creators are not liable for any damages or losses resulting
                from its use.</p>
        </div>
    </footer>

    <script src="trizcontradiction.js"></script>
    <script src="trizcontradiction2003.js"></script>
    <script src="physicalcontradictionprinciples1993.js"></script>
    <script src="76principlestriz.js"></script>
    <script src="sufield-diagrams.js"></script>
    <script src="ldst.js"></script>
    <script src="trizconstants.js"></script>

    <script>
        // ===== CARGAR HEADER DINÁMICAMENTE =====
        document.addEventListener('DOMContentLoaded', function () {
            // Cargar el header desde header.html
            fetch('header.html')
                .then(response => response.text())
                .then(data => {
                    // Insertar el contenido del header en el contenedor
                    document.getElementById('header-container').innerHTML = data;

                    // Inicializar el menú después de cargar el header
                    initNavigationMenu();
                })
                .catch(error => console.error('Error loading header:', error));
        });

        // ===== INICIALIZAR EL MENÚ DE NAVEGACIÓN =====
        function initNavigationMenu() {
            const navToggle = document.getElementById('nav-toggle');
            const navMenu = document.getElementById('nav-menu');
            const toolsDropdownToggle = document.getElementById('tools-dropdown-toggle');
            const toolsDropdownMenu = document.getElementById('tools-dropdown-menu');
            const toolsDropdownContainer = document.getElementById('tools-dropdown-container');

            if (navToggle) {
                navToggle.addEventListener('click', () => {
                    navMenu.classList.toggle('show-menu');
                    const icon = navToggle.querySelector('i');
                    icon.classList.toggle('fa-bars');
                    icon.classList.toggle('fa-times');
                    if (!navMenu.classList.contains('show-menu')) {
                        toolsDropdownMenu.classList.remove('show-submenu');
                        toolsDropdownContainer.classList.remove('active');
                    }
                });
            }

            if (toolsDropdownToggle) {
                toolsDropdownToggle.addEventListener('click', (event) => {
                    if (window.innerWidth <= 992) {
                        event.preventDefault();
                        toolsDropdownMenu.classList.toggle('show-submenu');
                        toolsDropdownContainer.classList.toggle('active');
                    }
                });
            }
        }

        // ===== GESTIÓN DE VERSIONES DE MATRIZ TRIZ =====
        let currentMatrixVersion = 'classic'; // 'classic' or '2003'

        function changeMatrixVersion() {
            const selectedVersion = document.querySelector('input[name="matrix-version"]:checked').value;
            currentMatrixVersion = selectedVersion;

            // Actualizar la interfaz según la versión seleccionada
            populateDropdowns();
            createContradictionMatrix();

            // Limpiar selecciones anteriores
            improvingFeatureIndex = null;
            worseningFeatureIndex = null;
            updateMatrixDisplay();
            updateSelectedFeatures();
            clearResults();

            // Mostrar información sobre la versión seleccionada
            const versionInfo = document.getElementById('matrix-version-info');
            if (currentMatrixVersion === 'classic') {
                versionInfo.textContent = "Using Classic TRIZ Matrix - The original 39x39 matrix with 40 inventive principles. Altshuller, G. S. (1950-1980). 40 Principles: TRIZ Keys to Technical Innovation o The Innovation Algorithm: TRIZ, Systematic Innovation and Technical Creativity.";
            } else {
                versionInfo.textContent = "Using 2003 TRIZ Matrix 48x48 matrix- Mann, D., & Dewulf, S. (2003). Matrix 2003: Updating the TRIZ Contradiction Matrix. CREAX Press.";
            }
        }

        // CORRECCIÓN: Usar la matriz correcta según la versión seleccionada
        function getCurrentMatrix() {
            return currentMatrixVersion === 'classic' ? trizContradictionMatrix : trizContradictionMatrix2003;
        }

        function getCurrentFeatures() {
            return getCurrentMatrix().features;
        }

        function getCurrentPrinciples() {
            return getCurrentMatrix().principles;
        }

        // MODIFICAR: Función para obtener principios según la matriz seleccionada
        function getContradictionPrinciples(improvingFeature, worseningFeature) {
            const matrix = getCurrentMatrix().matrix;
            if (matrix[improvingFeature] && matrix[improvingFeature][worseningFeature]) {
                return matrix[improvingFeature][worseningFeature];
            }
            return [];
        }

        function getPrincipleName(principleNumber) {
            const principles = getCurrentPrinciples();
            if (principleNumber >= 1 && principleNumber <= principles.length) {
                return principles[principleNumber - 1];
            }
            return "Unknown Principle";
        }

        function getFeatureName(featureNumber) {
            const features = getCurrentFeatures();
            if (featureNumber >= 1 && featureNumber <= features.length) {
                return features[featureNumber - 1];
            }
            return "Unknown Feature";
        }

        let problemData = {};
        let exampleIndex = 0;
        let improvingFeatureIndex = null;
        let worseningFeatureIndex = null;

        // Variables para el flujo de contradicciones físicas
        let physicalStrategyFlow = {
            step1: false,
            step2: false,
            step3: false,
            selectedStrategy: null,
            selectedMethod: null
        };

        // Variables para LDST
        let currentRecommendedLaws = ['law4']; // Por defecto

        // MODIFICACIÓN: Función centralizada para limpiar resultados
        function clearResults() {
            const resultsDiv = document.getElementById('results-container');
            if (resultsDiv && !resultsDiv.classList.contains('hidden')) {
                resultsDiv.innerHTML = '';
                resultsDiv.classList.add('hidden');
            }
        }

        document.addEventListener('DOMContentLoaded', init);

        function init() {
            populateDropdowns();
            createContradictionMatrix();
            addSuFieldSystem(); // Add one empty Su-Field system by default

            // MODIFICACIÓN: Inicializar LDST después de que se carguen todos los scripts
            setTimeout(() => {
                updateLDSTRecommendations();
            }, 100);
        }

        // ===== FUNCIÓN ACTUALIZADA PARA RECOMENDACIONES LDST =====
        function updateLDSTRecommendations() {
            const lifecycleStage = document.getElementById('lifecycle-stage').value;
            currentRecommendedLaws = lifecycleToLdstMapping[lifecycleStage] || ["law4"];
            const recommendationText = lifecycleRecommendations[lifecycleStage] || "";

            // Buscar o crear el elemento de recomendación
            let recommendationElement = document.getElementById('ldst-recommendation-info');
            if (!recommendationElement) {
                // Si no existe, crearlo y añadirlo después del selector
                const lifecycleSelect = document.getElementById('lifecycle-stage');
                recommendationElement = document.createElement('div');
                recommendationElement.id = 'ldst-recommendation-info';
                recommendationElement.style.marginTop = '10px';
                recommendationElement.style.fontStyle = 'italic';
                recommendationElement.style.color = '#666';
                lifecycleSelect.parentNode.appendChild(recommendationElement);
            }

            recommendationElement.textContent =
                `Selected for ${document.getElementById('lifecycle-stage').options[document.getElementById('lifecycle-stage').selectedIndex].text}: ${recommendationText}`;

            updateLawsTable();
        }

        function updateLawsTable() {
            // Reset todas las filas - SOLO si existen
            for (let i = 1; i <= 8; i++) {
                const lawElement = document.getElementById(`law-${i}`);
                if (lawElement) {
                    lawElement.classList.remove('recommended-trend');
                }
            }

            // Resaltar las leyes recomendadas - SOLO si existen
            currentRecommendedLaws.forEach(lawId => {
                const lawNumber = lawId.replace('law', '');
                const selectedLawElement = document.getElementById(`law-${lawNumber}`);
                if (selectedLawElement) {
                    selectedLawElement.classList.add('recommended-trend');
                }
            });
        }

        function toggleLawsTable() {
            const container = document.getElementById('laws-table-container');
            container.classList.toggle('hidden');
        }

        function resetTool() {
            problemData = {};
            document.querySelectorAll('input[type="text"], textarea, select').forEach(el => {
                if (el.tagName === 'SELECT') el.selectedIndex = 0; else el.value = '';
            });
            document.querySelectorAll('input[type="radio"]').forEach(el => el.checked = false);
            document.getElementById('technical-solver-block').classList.add('hidden');
            document.getElementById('physical-solver-block').classList.add('hidden');
            document.getElementById('matrix-version-selector-container').classList.add('hidden');

            // Resetear el selector de fase de vida
            document.getElementById('lifecycle-stage').value = 'birth';

            // Restablecer la versión de matriz a clásica
            document.querySelector('input[name="matrix-version"][value="classic"]').checked = true;
            changeMatrixVersion();

            // Reset physical strategy flow
            physicalStrategyFlow = {
                step1: false,
                step2: false,
                step3: false,
                selectedStrategy: null,
                selectedMethod: null
            };

            // Reset physical steps UI
            document.getElementById('physical-step-2').classList.add('hidden');
            document.getElementById('physical-step-3').classList.add('hidden');
            document.getElementById('principles-toggle-container').style.display = 'none';
            document.getElementById('principles-table-container').classList.add('hidden');
            document.getElementById('separation-methods').innerHTML = '';

            clearResults(); // MODIFICACIÓN: Usar la función centralizada

            // Reset matrix selection
            improvingFeatureIndex = null;
            worseningFeatureIndex = null;
            document.getElementById('selected-improving').textContent = 'None';
            document.getElementById('selected-worsening').textContent = 'None';
            updateMatrixDisplay();

            // Reset Su-Field systems
            document.getElementById('sufield-systems-container').innerHTML = '';
            addSuFieldSystem(); // Add one empty system

            // Reset solutions matrix
            document.getElementById('solutions-matrix-container').classList.add('hidden');

            // Reset LDST
            updateLDSTRecommendations();
        }

        function loadExample() {
            // Limpiar solo los campos necesarios
            clearResults();
            document.getElementById('problem-system').value = '';
            document.getElementById('problem-function').value = '';
            document.getElementById('problem-harm').value = '';
            document.getElementById('ifr-formulation').value = '';
            document.getElementById('conflicting-parameter').value = '';

            // Limpiar selecciones de contradicciones físicas
            const physicalRadios = document.querySelectorAll('#physical-solver-block input[type="radio"]');
            physicalRadios.forEach(radio => {
                radio.checked = false;
            });

            // Reset physical strategy flow
            physicalStrategyFlow = {
                step1: false,
                step2: false,
                step3: false,
                selectedStrategy: null,
                selectedMethod: null
            };

            // Ocultar pasos físicos
            document.getElementById('physical-step-2').classList.add('hidden');
            document.getElementById('physical-step-3').classList.add('hidden');

            const currentExample = examples[exampleIndex];

            // Cargar valores del ejemplo actual
            document.getElementById('problem-system').value = currentExample.system;
            document.getElementById('problem-function').value = currentExample.function;
            document.getElementById('problem-harm').value = currentExample.harm;
            document.getElementById('ifr-formulation').value = currentExample.ifr;

            // Actualizar descripción del ejemplo
            document.getElementById('current-example-description').textContent = currentExample.description;

            const radio = document.querySelector(`input[name="contradiction-type"][value="${currentExample.contradictionType}"]`);
            if (radio) {
                radio.checked = true;
                radio.dispatchEvent(new Event('change'));
            }

            if (currentExample.contradictionType === 'technical') {
                document.getElementById('improving-feature').value = currentExample.improvingFeature;
                document.getElementById('worsening-feature').value = currentExample.worseningFeature;

                improvingFeatureIndex = currentExample.improvingFeature;
                worseningFeatureIndex = currentExample.worseningFeature;
                updateMatrixDisplay();
                updateSelectedFeatures();
            } else {
                document.getElementById('conflicting-parameter').value = currentExample.conflictingParameter;

                // Step 1: OZ Definition
                if (currentExample.ozDefinition) {
                    const ozDefinitionRadio = document.querySelector(`input[name="oz-definition"][value="${currentExample.ozDefinition}"]`);
                    if (ozDefinitionRadio) {
                        ozDefinitionRadio.checked = true;
                        updatePhysicalStrategy();
                    }
                }

                // Step 2: OZ Intersection
                if (currentExample.ozIntersection) {
                    const ozIntersectionRadio = document.querySelector(`input[name="oz-intersection"][value="${currentExample.ozIntersection}"]`);
                    if (ozIntersectionRadio) {
                        ozIntersectionRadio.checked = true;
                        updatePhysicalStrategy();
                    }
                }

                // Step 3: Separation Method - CORRECCIÓN AQUÍ
                if (currentExample.separationMethod) {
                    const separationMethodRadio = document.querySelector(`input[name="separation-method"][value="${currentExample.separationMethod}"]`);
                    if (separationMethodRadio) {
                        separationMethodRadio.checked = true;
                        // ANTES: updatePhysicalStrategy(); (Esto borraba la selección)
                        // AHORA: handleSeparationMethodChange(); (Esto guarda la selección sin borrar)
                        handleSeparationMethodChange();
                    }
                }
            }

            // Load Su-Field systems
            if (currentExample.sufield && currentExample.sufield.systems) {
                document.getElementById('sufield-systems-container').innerHTML = '';
                currentExample.sufield.systems.forEach((system, index) => {
                    addSuFieldSystem();
                    const systemContainer = document.getElementById('sufield-systems-container').lastElementChild;
                    systemContainer.querySelector('.sufield-object').value = system.object || '';
                    systemContainer.querySelector('.sufield-tool').value = system.tool || '';
                    systemContainer.querySelector('.sufield-field').value = system.field || '';
                    systemContainer.querySelector('.sufield-type').value = system.type || 'insufficient';

                    updateSuFieldDiagram(systemContainer);
                });
            }

            // Set LDST lifecycle stage
            if (currentExample.lifecycleStage) {
                document.getElementById('lifecycle-stage').value = currentExample.lifecycleStage;
                updateLDSTRecommendations();
            }

            // Incrementar el índice para el próximo ejemplo
            exampleIndex = (exampleIndex + 1) % examples.length;
        }

        // MODIFICACIÓN: Función actualizada para mostrar/ocultar elementos según el tipo de contradicción
        function toggleContradictionForms() {
            clearResults(); // MODIFICACIÓN: Limpiar al cambiar de tipo
            const type = document.querySelector('input[name="contradiction-type"]:checked')?.value;

            // Mostrar/ocultar elementos según el tipo de contradicción
            if (type === 'technical') {
                // Mostrar elementos para contradicciones técnicas
                document.getElementById('matrix-version-selector-container').classList.remove('hidden');
                document.getElementById('technical-solver-block').classList.remove('hidden');
                document.getElementById('physical-solver-block').classList.add('hidden');
                document.getElementById('principles-toggle-container').style.display = 'none';
            } else if (type === 'physical') {
                // Mostrar elementos para contradicciones físicas
                document.getElementById('matrix-version-selector-container').classList.add('hidden');
                document.getElementById('technical-solver-block').classList.add('hidden');
                document.getElementById('physical-solver-block').classList.remove('hidden');
                document.getElementById('principles-toggle-container').style.display = 'block';

                // Reset physical strategy flow when switching to physical
                physicalStrategyFlow = {
                    step1: false,
                    step2: false,
                    step3: false,
                    selectedStrategy: null,
                    selectedMethod: null
                };

                // Reset physical steps UI
                document.getElementById('physical-step-2').classList.add('hidden');
                document.getElementById('physical-step-3').classList.add('hidden');
                document.getElementById('principles-table-container').classList.add('hidden');
                document.getElementById('separation-methods').innerHTML = '';

                // Reset all radio buttons in physical section
                const physicalRadios = document.querySelectorAll('#physical-solver-block input[type="radio"]');
                physicalRadios.forEach(radio => {
                    radio.checked = false;
                });
            }
        }

        // CORRECCIÓN: Función mejorada para actualizar estrategias físicas
        function updatePhysicalStrategy() {
            clearResults();

            // Paso 1: Verificar definición de OZ/OT
            const ozDefinition = document.querySelector('input[name="oz-definition"]:checked');
            if (ozDefinition) {
                document.getElementById('physical-step-2').classList.remove('hidden');
                physicalStrategyFlow.step1 = true;

                // Paso 2: Verificar intersección OZ/OT
                const ozIntersection = document.querySelector('input[name="oz-intersection"]:checked');
                if (ozIntersection) {
                    document.getElementById('physical-step-3').classList.remove('hidden');
                    physicalStrategyFlow.step2 = true;

                    // Determinar estrategia general
                    if (ozIntersection.value === 'intersect') {
                        physicalStrategyFlow.selectedStrategy = 'satisfy';
                    } else {
                        physicalStrategyFlow.selectedStrategy = 'bypass';
                    }

                    // Generar opciones de separación según la estrategia
                    generateSeparationMethods(physicalStrategyFlow.selectedStrategy);

                    // Paso 3: Verificar método de separación seleccionado - CORREGIDO
                    // Usar un setTimeout para asegurar que los radio buttons se hayan renderizado
                    setTimeout(() => {
                        const separationMethod = document.querySelector('input[name="separation-method"]:checked');
                        if (separationMethod) {
                            physicalStrategyFlow.step3 = true;
                            physicalStrategyFlow.selectedMethod = separationMethod.value;
                        } else {
                            physicalStrategyFlow.step3 = false;
                        }
                    }, 50);
                } else {
                    document.getElementById('physical-step-3').classList.add('hidden');
                    physicalStrategyFlow.step2 = false;
                    physicalStrategyFlow.step3 = false;
                }
            } else {
                document.getElementById('physical-step-2').classList.add('hidden');
                document.getElementById('physical-step-3').classList.add('hidden');
                physicalStrategyFlow.step1 = false;
                physicalStrategyFlow.step2 = false;
                physicalStrategyFlow.step3 = false;
            }

            // CORRECCIÓN: El botón de la tabla de principios está SIEMPRE visible en contradicciones físicas
            document.getElementById('principles-toggle-container').style.display = 'block';
        }

        // CORRECCIÓN: Generar métodos de separación según la estrategia
        function generateSeparationMethods(strategy) {
            const container = document.getElementById('separation-methods');

            // Limpiar contenedor
            container.innerHTML = '';

            let methodsHTML = '';

            if (strategy === 'satisfy') {
                // Estrategia Satisfy - Métodos de separación
                methodsHTML = `
                <label><input type="radio" name="separation-method" value="separationInSpace" onchange="handleSeparationMethodChange()"> Separation in Space</label>
                <label><input type="radio" name="separation-method" value="separationInTime" onchange="handleSeparationMethodChange()"> Separation in Time</label>
                <label><input type="radio" name="separation-method" value="separationInRelation" onchange="handleSeparationMethodChange()"> Separation in Relation</label>
                <label><input type="radio" name="separation-method" value="separationInSystemLevel" onchange="handleSeparationMethodChange()"> Separation in System Level</label>
                <label><input type="radio" name="separation-method" value="satisfyContradictoryDemands" onchange="handleSeparationMethodChange()"> Satisfy Contradictory Demands</label>
            `;
            } else {
                // Estrategia Bypass
                methodsHTML = `
                <label><input type="radio" name="separation-method" value="bypassContradictoryDemands" onchange="handleSeparationMethodChange()"> Bypass Contradictory Demands</label>
            `;
            }

            container.innerHTML = methodsHTML;
        }

        // CORRECCIÓN: Nueva función para manejar cambios en los métodos de separación
        function handleSeparationMethodChange() {
            const separationMethod = document.querySelector('input[name="separation-method"]:checked');
            if (separationMethod) {
                physicalStrategyFlow.step3 = true;
                physicalStrategyFlow.selectedMethod = separationMethod.value;

                // Ocultar la tabla de principios si estaba visible
                document.getElementById('principles-table-container').classList.add('hidden');
            } else {
                physicalStrategyFlow.step3 = false;
            }
        }

        // CORRECCIÓN: Generar tabla completa con TODOS los principios de contradicciones físicas
        function generatePrinciplesTable() {
            const container = document.getElementById('principles-table-content');

            // MODIFICACIÓN: Se ha dividido la frase en dos párrafos para separar la fuente.
            let html = `
        <p style="margin-bottom: 0.5rem; font-style: italic;">
            This table shows all physical contradiction resolution strategies and their associated inventive principles.
        </p>
        <p style="margin-bottom: 1.5rem; font-style: italic; font-weight: bold;">
            Source: 1. Litvin, S. (1993). The TRIZ Contradiction Matrix: Principles for Solving Physical Contradictions. 2. Altshuller, G. S. (1984). Creativity as an Exact Science: The Theory of the Solution of Inventive Problems.
        </p>
    `;

            // Iterar sobre TODAS las estrategias del archivo JS
            for (const [method, strategy] of Object.entries(physicalContradictionPrinciples)) {
                html += `
        <div class="physical-strategy-guide">
            <div class="strategy-title">${strategy.strategy}</div>
            <div class="strategy-description">${strategy.description}</div>
            <div class="strategy-example">
                <strong>Example:</strong> ${getPhysicalContradictionExample(method)}
            </div>
        </div>
        <table class="matrix-table" style="margin-top: 1rem; margin-bottom: 2rem;">
            <thead>
                <tr>
                    <th>Principle #</th>
                    <th>Name</th>
                    <th>Description</th>
                    <th>Example</th>
                </tr>
            </thead>
            <tbody>
        `;

                strategy.principles.forEach(principle => {
                    html += `
            <tr>
                <td><strong>${principle.number}</strong></td>
                <td>${principle.name}</td>
                <td>${principle.description}</td>
                <td><em>${principle.example}</em></td>
            </tr>
        `;
                });

                html += `
            </tbody>
        </table>
    `;
            }

            container.innerHTML = html;
        }

        // CORRECCIÓN: Mostrar/ocultar tabla de principios
        function togglePrinciplesTable() {
            const tableContainer = document.getElementById('principles-table-container');
            const isVisible = !tableContainer.classList.contains('hidden');

            if (!isVisible) {
                // Generar la tabla si no está visible
                generatePrinciplesTable();
                tableContainer.classList.remove('hidden');
            } else {
                tableContainer.classList.add('hidden');
            }
        }

        // ===== NUEVAS FUNCIONES PARA LA MATRIZ DE SOLUCIONES ESTÁNDAR =====
        function toggleSolutionsMatrix() {
            const matrixContainer = document.getElementById('solutions-matrix-container');
            const isVisible = !matrixContainer.classList.contains('hidden');

            if (!isVisible) {
                // Generar la matriz si no está visible
                renderSolutionsMatrix();
                matrixContainer.classList.remove('hidden');
            } else {
                matrixContainer.classList.add('hidden');
            }
        }

        // Función para renderizar la matriz completa de soluciones
        function renderSolutionsMatrix() {
            const container = document.getElementById('solutions-matrix-content');

            // MODIFICACIÓN: Se ha separado el título, la descripción y la fuente en párrafos distintos.
            let html = `
        <div class="content-block">
            <h4><i class="fas fa-th-list"></i> Classic 76 Standard Solutions Matrix</h4>
            <p style="margin-bottom: 0.5rem;">This matrix shows all 76 Standard Solutions and their applicability to different Su-Field problem types.</p>
            <p style="margin-bottom: 1.5rem; font-style: italic; font-weight: bold;">
                Source: Domb, E., Terninko, J., Miller, J., & MacGran, E. (Classification of the 76 Standard Solutions).
            </p>
            <div style="overflow-x: auto;">
                <table class="matrix-table solutions-matrix">
                    <thead>
                        <tr>
                            <th>Solution ID</th>
                            <th>Title</th>
                            <th>Class</th>
                            <th>Insufficient</th>
                            <th>Harmful</th>
                            <th>Difficult</th>
                            <th>Missing</th>
                            <th>Excessive</th>
                            <th>Inefficient</th>
                        </tr>
                    </thead>
                    <tbody>
    `;

            // Recorrer todas las soluciones estándar
            for (const className in trizStandardSolutions) {
                const solutionClass = trizStandardSolutions[className];

                for (const solutionId in solutionClass.solutions) {
                    const solution = solutionClass.solutions[solutionId];

                    // Determinar para qué tipos de problemas se recomienda esta solución
                    const isInsufficient = solutionMap.insufficient.includes(solutionId);
                    const isHarmful = solutionMap.harmful.includes(solutionId);
                    const isDifficult = solutionMap.difficult.includes(solutionId);
                    const isMissing = solutionMap.missing.includes(solutionId);
                    const isExcessive = solutionMap.excessive.includes(solutionId);
                    const isInefficient = solutionMap.inefficient.includes(solutionId);

                    html += `
                <tr>
                    <td><strong>${solutionId}</strong></td>
                    <td>${solution.title}</td>
                    <td>${className.split(':')[0]}</td>
                    <td class="${isInsufficient ? 'matrix-applicable' : ''}">${isInsufficient ? '✓' : ''}</td>
                    <td class="${isHarmful ? 'matrix-applicable' : ''}">${isHarmful ? '✓' : ''}</td>
                    <td class="${isDifficult ? 'matrix-applicable' : ''}">${isDifficult ? '✓' : ''}</td>
                    <td class="${isMissing ? 'matrix-applicable' : ''}">${isMissing ? '✓' : ''}</td>
                    <td class="${isExcessive ? 'matrix-applicable' : ''}">${isExcessive ? '✓' : ''}</td>
                    <td class="${isInefficient ? 'matrix-applicable' : ''}">${isInefficient ? '✓' : ''}</td>
                </tr>
            `;
                }
            }

            html += `
                    </tbody>
                </table>
            </div>
            
            </div>
    `;

            container.innerHTML = html;
        }

        function toggleMatrixView() {
            const dropdownView = document.getElementById('dropdown-view');
            const matrixView = document.getElementById('matrix-view');

            if (matrixView.classList.contains('hidden')) {
                dropdownView.classList.add('hidden');
                matrixView.classList.remove('hidden');
            } else {
                dropdownView.classList.remove('hidden');
                matrixView.classList.add('hidden');
            }
        }

        function createContradictionMatrix() {
            const matrixTable = document.getElementById('contradiction-matrix');
            matrixTable.innerHTML = '';

            const features = getCurrentFeatures();

            // CORRECCIÓN 1: Cambiar el orden - Filas: Desired, Columnas: Worsening
            let headerRow = '<tr><th class="matrix-corner">Worsening →<br>Desired ↓</th>';
            for (let i = 0; i < features.length; i++) {
                headerRow += `<th title="${features[i]}">${i + 1}</th>`;
            }
            headerRow += '</tr>';
            matrixTable.innerHTML += headerRow;

            // CORRECCIÓN 1: Cambiar el orden - Filas: Desired, Columnas: Worsening
            for (let i = 0; i < features.length; i++) {
                let row = `<tr><th title="${features[i]}">${i + 1}</th>`;
                for (let j = 0; j < features.length; j++) {
                    const cellClass = getCellClass(i, j);
                    // CORRECCIÓN: Usar índices correctos (i+1, j+1) para la matriz
                    const principles = getContradictionPrinciples((i + 1).toString(), (j + 1).toString());
                    const principleNumbers = principles && principles.length > 0 ? principles.join(', ') : '-';

                    // CORRECCIÓN 2: Añadir tooltip con nombres de principios
                    const principleNames = principles && principles.length > 0
                        ? principles.map(p => getPrincipleName(p)).join(', ')
                        : 'No principles recommended';

                    row += `<td class="${cellClass}" onclick="selectMatrixCell(${i}, ${j})" 
                        title="Improving: ${features[i]}\nWorsening: ${features[j]}\nPrinciples: ${principleNames}">
                    <div class="principle-numbers">${principleNumbers}</div>
                </td>`;
                }
                row += '</tr>';
                matrixTable.innerHTML += row;
            }
        }

        function getCellClass(row, col) {
            if (row === improvingFeatureIndex && col === worseningFeatureIndex) {
                return 'selected';
            } else if (row === improvingFeatureIndex) {
                return 'improving';
            } else if (col === worseningFeatureIndex) {
                return 'worsening';
            }
            return '';
        }

        function selectMatrixCell(row, col) {
            clearResults(); // MODIFICACIÓN: Limpiar al seleccionar celda
            improvingFeatureIndex = row;
            worseningFeatureIndex = col;

            // CORRECCIÓN: Actualizar los dropdowns para mantener consistencia
            document.getElementById('improving-feature').value = row;
            document.getElementById('worsening-feature').value = col;

            updateMatrixDisplay();
            updateSelectedFeatures();
        }

        function updateMatrixDisplay() {
            const cells = document.querySelectorAll('#contradiction-matrix td');
            const features = getCurrentFeatures();
            cells.forEach((cell, index) => {
                const row = Math.floor(index / features.length);
                const col = index % features.length;
                cell.className = getCellClass(row, col);
            });
        }

        function updateSelectedFeatures() {
            const features = getCurrentFeatures();
            const improvingSpan = document.getElementById('selected-improving');
            const worseningSpan = document.getElementById('selected-worsening');

            if (improvingFeatureIndex !== null) {
                improvingSpan.textContent = `${improvingFeatureIndex + 1}: ${features[improvingFeatureIndex]}`;
                improvingSpan.title = features[improvingFeatureIndex]; // CORRECCIÓN 2: Añadir tooltip
            } else {
                improvingSpan.textContent = 'None';
            }

            if (worseningFeatureIndex !== null) {
                worseningSpan.textContent = `${worseningFeatureIndex + 1}: ${features[worseningFeatureIndex]}`;
                worseningSpan.title = features[worseningFeatureIndex]; // CORRECCIÓN 2: Añadir tooltip
            } else {
                worseningSpan.textContent = 'None';
            }
        }

        function solveProblem() {
            // MODIFICACIÓN: Limpiar los resultados anteriores al inicio de la función
            clearResults();

            problemData = {};
            problemData.system = document.getElementById('problem-system').value;
            problemData.function = document.getElementById('problem-function').value;
            problemData.harm = document.getElementById('problem-harm').value;
            problemData.ifr = document.getElementById('ifr-formulation').value;

            // Agregar datos LDST - MODIFICADO: Usar todas las leyes recomendadas
            const lifecycleStage = document.getElementById('lifecycle-stage').value;
            const recommendedLaws = lifecycleToLdstMapping[lifecycleStage] || ["law4"];

            problemData.ldst = {
                lifecycleStage: lifecycleStage,
                recommendedLaws: recommendedLaws.map(lawId => {
                    const law = getLdstData(lawId);
                    return {
                        id: lawId,
                        name: law.name,
                        principles: law.principles,
                        examples: law.examples
                    };
                })
            };

            const selectedType = document.querySelector('input[name="contradiction-type"]:checked');
            if (!selectedType) {
                alert('Please select a contradiction type in Step 4.');
                return;
            }
            problemData.contradictionType = selectedType.value;

            if (problemData.contradictionType === 'technical') {
                // CORRECCIÓN: Usar siempre los valores actuales de los dropdowns
                // ya que pueden haber cambiado después de una selección de matriz
                let improvingIndex = parseInt(document.getElementById('improving-feature').value);
                let worseningIndex = parseInt(document.getElementById('worsening-feature').value);

                // Si no hay selección en dropdowns, usar la selección de matriz
                if (isNaN(improvingIndex) || improvingIndex < 0) {
                    improvingIndex = improvingFeatureIndex;
                }
                if (isNaN(worseningIndex) || worseningIndex < 0) {
                    worseningIndex = worseningFeatureIndex;
                }

                // Validación final
                if (improvingIndex === null || worseningIndex === null ||
                    improvingIndex < 0 || worseningIndex < 0) {
                    alert('Please select an improving and a worsening feature.');
                    return;
                }

                if (improvingIndex === worseningIndex) {
                    alert('Please select two different features for the technical contradiction.');
                    return;
                }

                // CORRECCIÓN: Actualizar las variables globales con la selección actual
                improvingFeatureIndex = improvingIndex;
                worseningFeatureIndex = worseningIndex;

                const features = getCurrentFeatures();
                problemData.improvingFeature = features[improvingIndex];
                problemData.worseningFeature = features[worseningIndex];

                // CORRECCIÓN: Usar índices correctos (sumar 1) para la matriz
                const improvingKey = (improvingIndex + 1).toString();
                const worseningKey = (worseningIndex + 1).toString();
                const principlesList = getContradictionPrinciples(improvingKey, worseningKey);

                problemData.recommendedPrinciples = (principlesList || []).map(id => {
                    // Asegurarse de que el principio existe en nuestro objeto
                    return principles[id] ? { ...principles[id], id } : null;
                }).filter(p => p !== null); // Filtrar principios nulos

            } else {
                const parameter = document.getElementById('conflicting-parameter').value;
                if (!parameter) {
                    alert('Please specify the conflicting parameter for the Physical Contradiction.');
                    return;
                }
                problemData.conflictingParameter = parameter;

                // Verificar que se haya completado el flujo
                if (!physicalStrategyFlow.step3) {
                    alert('Please complete all steps for the Physical Contradiction analysis.');
                    return;
                }

                problemData.ozRelationship = physicalStrategyFlow.selectedMethod;
                problemData.strategy = physicalContradictionPrinciples[physicalStrategyFlow.selectedMethod].strategy;

                const strategy = physicalContradictionPrinciples[physicalStrategyFlow.selectedMethod];
                problemData.recommendedPrinciples = strategy.principles.map(p => ({
                    id: p.number,
                    name: p.name,
                    desc: p.description,
                    example: p.example
                }));
            }

            // Collect Su-Field systems
            problemData.sufield = { systems: [] };
            const systemElements = document.getElementsByClassName('sufield-system');
            for (let systemElement of systemElements) {
                const object = systemElement.querySelector('.sufield-object').value;
                const tool = systemElement.querySelector('.sufield-tool').value;
                const field = systemElement.querySelector('.sufield-field').value;
                const type = systemElement.querySelector('.sufield-type').value;

                // Get standard solutions for this problem type
                const standardSolutions = (typeof getRecommendedStandardSolutions === 'function')
                    ? getRecommendedStandardSolutions(type)
                    : [];

                problemData.sufield.systems.push({
                    object: object,
                    tool: tool,
                    field: field,
                    type: type,
                    suggestion: sufieldSolutions[type] || "No specific suggestion available.",
                    standardSolutions: standardSolutions
                });
            }

            displayResults();
        }

        // ===== FUNCIÓN displayResults CORREGIDA =====
        function displayResults() {
            const resultsDiv = document.getElementById('results-container');
            // MODIFICACIÓN: La limpieza ya se hizo al inicio de solveProblem()
            let html = '<h3><i class="fas fa-check-circle"></i> Solution Path Report</h3>';

            // Agregar información LDST - MODIFICADO: Mostrar todas las leyes recomendadas
            html += `<div class="solver-step"><h4><i class="fas fa-project-diagram"></i> LDST Analysis</h4>
        <p><strong>Life Cycle Stage:</strong> ${document.getElementById('lifecycle-stage').options[document.getElementById('lifecycle-stage').selectedIndex].text}</p>
        <p><strong>Recommended Laws of Technical Systems Development:</strong></p>`;

            // Mostrar todas las leyes recomendadas
            problemData.ldst.recommendedLaws.forEach(law => {
                html += `
            <div style="margin-bottom: 1.5rem; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
                <h5>${law.name}</h5>
                <p><strong>Related Principles:</strong> ${law.principles.join(', ')}</p>
                <div>${law.examples}</div>
            </div>
        `;
            });

            html += `
        <div class="tese-trends-icons">`;

            // Generar iconos para todas las leyes recomendadas
            problemData.ldst.recommendedLaws.forEach(law => {
                law.principles.forEach(principle => {
                    html += `
                <div class="tese-trend-item">
                    <div class="tese-trend-icon">
                        <i class="fas fa-lightbulb"></i>
                    </div>
                    <div class="tese-trend-name">${principle}</div>
                </div>
            `;
                });
            });

            html += `</div>
        <p style="margin-top: 1rem; font-style: italic; text-align: center;">
            Apply these principles according to the fundamental laws of technical systems development
        </p>
    </div>`;

            html += `<div class="solver-step"><h4><i class="fas fa-clipboard-list"></i> Problem Summary</h4><p><strong>System:</strong> ${problemData.system || 'N/A'}</p>`;

            if (problemData.contradictionType === 'technical') {
                html += `<div class="contradiction-visual">
            <div class="improving-side">
                <i class="fas fa-arrow-up improving-icon feature-icon"></i>
                <h4>Improving</h4>
                <p>${problemData.improvingFeature}</p>
            </div>
            <div class="contradiction-arrow">
                <i class="fas fa-exchange-alt"></i>
            </div>
            <div class="worsening-side">
                <i class="fas fa-arrow-down worsening-icon feature-icon"></i>
                <h4>Worsening</h4>
                <p>${problemData.worseningFeature}</p>
            </div>
        </div>`;
            } else {
                html += `<p><strong>Conflict:</strong> The parameter "<em>${problemData.conflictingParameter || 'N/A'}</em>" needs opposite states.</p>`;

                // MODIFICACIÓN 2: Mostrar estrategia y principios solo en resultados para contradicciones físicas
                const strategy = physicalContradictionPrinciples[problemData.ozRelationship];
                if (strategy) {
                    html += `<div class="physical-strategy-guide">
                <div class="strategy-title">Recommended Strategy: ${strategy.strategy}</div>
                <div class="strategy-description">${strategy.description}</div>
                <div class="strategy-example">
                    <strong>Example from Litvin:</strong> ${getPhysicalContradictionExample(problemData.ozRelationship)}
                </div>
            </div>`;
                }
            }
            html += `</div>`;

            // MODIFICACIÓN: Mover el mensaje de la versión de la matriz aquí
            html += `<div class="matrix-version-info" style="margin-bottom: 1rem; padding: 0.5rem; background: #e3f2fd; border-radius: 4px;">
        <strong>Matrix Version:</strong> ${currentMatrixVersion === 'classic' ? 'Classic TRIZ Matrix (39 parameters)' : '2003 TRIZ Matrix (48 parameters)'}
    </div>`;

            html += `<div class="solver-step"><h4><i class="fas fa-lightbulb"></i> Recommended Principles (from Contradiction)</h4>`;

            if (problemData.recommendedPrinciples && problemData.recommendedPrinciples.length > 0) {
                problemData.recommendedPrinciples.forEach(p => {
                    html += `
                <div class="principle-card">
                    <div class="principle-header">
                        <span class="physical-principle-icon"><i class="fas ${physicalPrincipleIcons[p.id] || 'fa-lightbulb'}"></i></span>
                        <strong>Principle ${p.id}: ${p.name}</strong>
                    </div>
                    <p>${p.desc}</p>
                    <div style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                        <strong>Example:</strong> ${p.example || 'Apply this principle to transform your system.'}
                    </div>
                </div>
            `;
                });
            } else {
                html += '<p>No specific principles are commonly recommended for this combination. Consider a different framing of the problem.</p>';
            }
            html += `</div>`;

            // Display Su-Field systems and solutions
            if (problemData.sufield.systems && problemData.sufield.systems.length > 0) {
                html += `<div class="solver-step"><h4><i class="fas fa-atom"></i> Su-Field Analysis & Standard Solutions</h4>`;

                problemData.sufield.systems.forEach((system, index) => {
                    // Solo mostrar sistemas que tengan al menos un campo rellenado
                    if (system.object || system.tool || system.field) {
                        html += `<div style="margin-bottom: 2rem; padding: 1.5rem; background: #f8f9fa; border-radius: 8px;">`;

                        // Mostrar el diagrama Su-Field usando la función centralizada - CORREGIDO
                        html += `<h5>System ${index + 1}: ${system.object || 'S1'} ← ${system.field || 'F'} → ${system.tool || 'S2'}</h5>`;

                        // Crear contenedores para los diagramas de problema y solución
                        const problemDiagramId = `problem-diagram-${index}`;
                        const solutionDiagramId = `solution-diagram-${index}`;

                        html += `
                    <div class="solution-transformation">
                        <div class="before-state">
                            <div id="${problemDiagramId}" class="sufield-diagram-container"></div>
                            <div class="state-label">Problem State</div>
                        </div>
                        
                        <div class="transition-arrow"><i class="fas fa-long-arrow-alt-right"></i></div>
                        
                        <div class="after-state">
                            <div id="${solutionDiagramId}" class="sufield-diagram-container"></div>
                            <div class="state-label">Solution State</div>
                        </div>
                    </div>
                `;

                        // Show problem type with visual indicator
                        html += `<div style="display: flex; align-items: center; margin-bottom: 1rem;">
                    <i class="fas ${problemTypeIcons[system.type]}" style="font-size: 1.5rem; color: ${problemTypeColors[system.type]}; margin-right: 10px;"></i>
                    <div>
                        <strong>Problem Type:</strong> ${system.type}
                        <p style="margin: 5px 0 0 0;">${system.suggestion}</p>
                    </div>
                </div>`;

                        if (system.standardSolutions && system.standardSolutions.length > 0) {
                            // Group solutions by class
                            const solutionsByClass = {};
                            system.standardSolutions.forEach(solution => {
                                if (!solutionsByClass[solution.class]) {
                                    solutionsByClass[solution.class] = [];
                                }
                                solutionsByClass[solution.class].push(solution);
                            });

                            // Display solutions by class with explanations
                            for (const [className, solutions] of Object.entries(solutionsByClass)) {
                                const classIcon = classIcons[className] || 'fa-cube';
                                html += `<div class="standard-solution-visual">`;
                                html += `
                            <div class="class-header">
                                <span class="class-icon"><i class="fas ${classIcon}"></i></span>
                                <h5>${className}</h5>
                            </div>
                        `;
                                html += `<p>${standardSolutionClasses[className] || 'Standard solutions for this class of problems.'}</p>`;

                                html += `<div class="solution-description">`;
                                html += `<h6>Recommended Standard Solutions:</h6>`;

                                solutions.forEach(solution => {
                                    // MODIFICACIÓN 4: Usar iconos específicos para soluciones estándar
                                    const solutionIcon = standardSolutionIcons[solution.id] || 'fa-cube';
                                    html += `
                                <div class="solution-card">
                                    <div class="solution-header">
                                        <span class="standard-solution-icon"><i class="fas ${solutionIcon}"></i></span>
                                        <strong>${solution.id}: ${solution.title}</strong>
                                    </div>
                                    <p>${solution.description}</p>
                                </div>
                            `;
                                });

                                html += `</div></div>`;
                            }
                        } else if (typeof getRecommendedStandardSolutions !== 'function') {
                            html += `<p><em>Error: 76principlestriz.js not loaded. Cannot display standard solutions.</em></p>`;
                        } else {
                            html += `<p><em>No standard solutions found for "${system.type}".</em></p>`;
                        }

                        html += `</div>`;
                    }
                });
                html += `</div>`;
            }

            html += `<div class="results-actions"><button class="btn-success" onclick="exportToExcel()"><i class="fas fa-file-excel"></i> Export to Excel</button></div>`;

            resultsDiv.innerHTML = html;
            resultsDiv.classList.remove('hidden');

            // DESPUÉS de insertar el HTML, llamar a las funciones para dibujar los diagramas
            problemData.sufield.systems.forEach((system, index) => {
                if (system.object || system.tool || system.field) {
                    const problemDiagramId = `problem-diagram-${index}`;
                    const solutionDiagramId = `solution-diagram-${index}`;

                    // Dibujar diagrama del problema usando la función centralizada
                    updateProblemDiagramInSolution(problemDiagramId, {
                        objectText: system.object,
                        toolText: system.tool,
                        fieldType: system.field,
                        problemType: system.type
                    });

                    // Dibujar diagrama de la solución usando la función centralizada
                    updateSolutionDiagram(
                        solutionDiagramId,
                        system.object,
                        system.tool,
                        system.field
                    );
                }
            });

            resultsDiv.scrollIntoView({ behavior: 'smooth' });
        }

        function exportToExcel() {
            if (Object.keys(problemData).length === 0) {
                alert("No data to export. Please solve a problem first.");
                return;
            }

            const wb = XLSX.utils.book_new();
            const ws_data = [];

            ws_data.push(["TRIZ Problem Solving Report"]);
            ws_data.push(["Company: Sigma Exacta"]);
            ws_data.push([`Date: ${new Date().toLocaleDateString()}`]);
            ws_data.push([`Matrix Version: ${currentMatrixVersion === 'classic' ? 'Classic (39 parameters)' : '2003 (48 parameters)'}`]);
            ws_data.push([]);

            // Agregar datos LDST
            ws_data.push(["Laws of Development of Technical Systems (LDST)"]);
            ws_data.push(["Life Cycle Stage", document.getElementById('lifecycle-stage').options[document.getElementById('lifecycle-stage').selectedIndex].text]);
            ws_data.push(["Recommended Laws"]);
            problemData.ldst.recommendedLaws.forEach(law => {
                ws_data.push(["", law.name]);
                ws_data.push(["", "Related Principles", law.principles.join(', ')]);
            });
            ws_data.push([]);

            ws_data.push(["Problem Definition"]);
            ws_data.push(["System/Object", problemData.system]);
            ws_data.push(["Primary Function", problemData.function]);
            ws_data.push(["Main Drawback", problemData.harm]);
            ws_data.push([]);
            ws_data.push(["Ideal Final Result (IFR)"]);
            ws_data.push([problemData.ifr]);
            ws_data.push([]);
            ws_data.push(["Contradiction Analysis"]);

            if (problemData.contradictionType === 'technical') {
                ws_data.push(["Type", "Technical Contradiction"]);
                ws_data.push(["Improving Feature", problemData.improvingFeature]);
                ws_data.push(["Worsening Feature", problemData.worseningFeature]);
            } else {
                ws_data.push(["Type", "Physical Contradiction"]);
                ws_data.push(["Conflicting Parameter", problemData.conflictingParameter]);
                ws_data.push(["Operational Zones Relationship", problemData.ozRelationship]);
                ws_data.push(["Recommended Strategy", physicalContradictionPrinciples[problemData.ozRelationship]?.strategy]);
            }

            ws_data.push([]);
            ws_data.push(["Recommended Inventive Principles (from Contradiction)"]);
            ws_data.push(["Principle ID", "Name", "Description"]);

            problemData.recommendedPrinciples.forEach(p => {
                ws_data.push([`Principle ${p.id}`, p.name, p.desc]);
            });

            ws_data.push([]);
            ws_data.push(["Su-Field Analysis"]);

            if (problemData.sufield.systems && problemData.sufield.systems.length > 0) {
                problemData.sufield.systems.forEach((system, index) => {
                    if (system.object || system.tool || system.field) { // Solo exportar sistemas con datos
                        ws_data.push([]);
                        ws_data.push([`System ${index + 1}`]);
                        ws_data.push(["Object (S1)", system.object]);
                        ws_data.push(["Tool (S2)", system.tool]);
                        ws_data.push(["Field (F)", system.field]);
                        ws_data.push(["Problem Type", system.type]);
                        ws_data.push(["Suggestion", system.suggestion.replace(/<[^>]*>?/gm, '')]);

                        if (system.standardSolutions && system.standardSolutions.length > 0) {
                            ws_data.push(["Recommended Standard Solutions"]);
                            ws_data.push(["Solution ID", "Title", "Description"]);
                            system.standardSolutions.forEach(solution => {
                                ws_data.push([solution.id, solution.title, solution.description]);
                            });
                        }
                    }
                });
            }

            const ws = XLSX.utils.aoa_to_sheet(ws_data);
            ws['!cols'] = [{ wch: 25 }, { wch: 60 }, { wch: 80 }];
            XLSX.utils.book_append_sheet(wb, ws, "TRIZ Report");
            const dateStr = new Date().toISOString().slice(0, 10);
            XLSX.writeFile(wb, `TRIZ_Report_Sigma_Exacta_${dateStr}.xlsx`);
        }

        function populateDropdowns() {
            const improvingSelect = document.getElementById('improving-feature');
            const worseningSelect = document.getElementById('worsening-feature');

            improvingSelect.innerHTML = '<option value="-1">Select a feature</option>';
            worseningSelect.innerHTML = '<option value="-1">Select a feature</option>';

            const features = getCurrentFeatures();

            features.forEach((param, index) => {
                // CORRECCIÓN 2: Añadir tooltips a las opciones del dropdown
                improvingSelect.innerHTML += `<option value="${index}" title="${param}">${index + 1}: ${param}</option>`;
                worseningSelect.innerHTML += `<option value="${index}" title="${param}">${index + 1}: ${param}</option>`;
            });

            // CORRECCIÓN: Resetear las selecciones globales
            improvingFeatureIndex = null;
            worseningFeatureIndex = null;
        }

        // Función auxiliar para ejemplos de contradicciones físicas
        function getPhysicalContradictionExample(relationship) {
            const examples = {
                separationInSpace: "A surgical scalpel needs to be sharp to cut tissue but blunt to not damage surrounding organs. Solution: Use a retractable scalpel that is sharp when extended and protected when retracted.",
                separationInTime: "An airplane wing needs to be large for takeoff/landing but small for cruising efficiency. Solution: Use retractable flaps and slats.",
                separationInRelation: "A coffee cup needs to be hot to keep coffee warm but cool to hold. Solution: Use a handle made of insulating material.",
                separationInSystemLevel: "Traffic light with segmented pole elements for easy repair, separating maintenance requirements at different system levels.",
                satisfyContradictoryDemands: "Heat packs using phase transition of gel to provide warmth without external heat source, satisfying both heating and portability demands.",
                bypassContradictoryDemands: "Digital clocks replacing mechanical clockwork, bypassing the need for mechanical timekeeping altogether."
            };
            return examples[relationship] || "Apply separation principles to resolve the contradiction.";
        }
    </script>
</body>

</html>